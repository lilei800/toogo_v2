# åˆ›å»ºæœºå™¨äººæ‰§è¡Œæµç¨‹åˆ†æ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†åˆ†æäº†åˆ›å»ºæœºå™¨äººæ—¶çš„å®Œæ•´æ‰§è¡Œæµç¨‹ï¼ŒåŒ…æ‹¬å‰ç«¯æ•°æ®æ”¶é›†ã€éªŒè¯ã€è¯·æ±‚å‘é€ï¼Œä»¥åŠåç«¯çš„æ•°æ®éªŒè¯ã€å¤„ç†å’Œæ•°æ®åº“ä¿å­˜ã€‚

---

## ğŸ¯ å‰ç«¯æ‰§è¡Œæµç¨‹ï¼ˆ`web/src/views/toogo/robot/create.vue`ï¼‰

### 1. é¡µé¢åˆå§‹åŒ–ï¼ˆ`onMounted`ï¼‰

#### 1.1 åŠ è½½åŸºç¡€æ•°æ®
```javascript
- loadApiConfigs()          // åŠ è½½APIé…ç½®åˆ—è¡¨
- loadUserStrategies()      // åŠ è½½ç”¨æˆ·ç­–ç•¥ï¼ˆå·²åºŸå¼ƒï¼‰
- loadWalletInfo()          // åŠ è½½é’±åŒ…ç®—åŠ›ä¿¡æ¯
- loadPowerConfig()         // åŠ è½½ç®—åŠ›æ¶ˆè€—æ¯”ä¾‹é…ç½®
- loadBtcPrice()           // åŠ è½½BTCä»·æ ¼ï¼ˆç”¨äºè®¡ç®—é¢„ä¼°ä¸‹å•é‡ï¼‰
- loadMyStrategyGroups()   // åŠ è½½æˆ‘çš„ç­–ç•¥ç»„åˆ—è¡¨
- loadOfficialStrategyGroups() // åŠ è½½å®˜æ–¹ç­–ç•¥ç»„åˆ—è¡¨
```

#### 1.2 å¤„ç†è·¯ç”±å‚æ•°
```javascript
- æ£€æŸ¥ route.query.strategyGroupId
- å¦‚æœå­˜åœ¨ï¼Œè‡ªåŠ¨é€‰æ‹©å¯¹åº”çš„ç­–ç•¥ç»„
```

---

### 2. è¡¨å•æ•°æ®æ”¶é›†

#### 2.1 åŸºç¡€è®¾ç½®
```javascript
formData = {
  robotName: '',              // æœºå™¨äººåç§°ï¼ˆå¿…å¡«ï¼‰
  apiConfigId: null,          // APIé…ç½®IDï¼ˆå¿…å¡«ï¼‰
  maxProfitTarget: 100,       // æœ€å¤§ç›ˆåˆ©ç›®æ ‡ï¼ˆUSDTï¼‰
  maxLossAmount: 50,         // æœ€å¤§äºæŸé¢ï¼ˆUSDTï¼‰
  symbol: 'BTCUSDT',         // äº¤æ˜“å¯¹ï¼ˆå¿…å¡«ï¼‰
  exchange: '',               // äº¤æ˜“æ‰€ï¼ˆè‡ªåŠ¨è·ŸéšAPIé…ç½®ï¼‰
}
```

#### 2.2 ç­–ç•¥æ¨¡æ¿é€‰æ‹©
```javascript
- strategySource: 'my' | 'official'  // ç­–ç•¥æ¥æº
- selectedStrategyGroupId: number | null  // æˆ‘çš„ç­–ç•¥ç»„ID
- selectedOfficialGroupId: number | null  // å®˜æ–¹ç­–ç•¥ç»„ID
```

#### 2.3 å¸‚åœºçŠ¶æ€ä¸é£é™©åå¥½æ˜ å°„
```javascript
marketRiskMapping: {
  trend: 'balanced',        // ğŸ“ˆ è¶‹åŠ¿å¸‚åœº â†’ å¹³è¡¡
  volatile: 'balanced',     // ğŸ“Š éœ‡è¡å¸‚åœº â†’ å¹³è¡¡
  high_vol: 'aggressive',   // âš¡ é«˜æ³¢åŠ¨å¸‚åœº â†’ æ¿€è¿›
  low_vol: 'conservative',  // ğŸ˜´ ä½æ³¢åŠ¨å¸‚åœº â†’ ä¿å®ˆ
}
```

#### 2.4 è‡ªåŠ¨åŒ–å¼€å…³
```javascript
autoMarketState: true,      // è‡ªåŠ¨åˆ†æå¸‚åœºçŠ¶æ€
useMonitorSignal: true,     // æ–¹å‘ä¿¡å·å¼€å…³
autoStartTakeProfit: true,  // è‡ªåŠ¨å¯åŠ¨æ­¢ç›ˆå›æ’¤å¼€å…³
autoTradeEnabled: true,     // å…¨è‡ªåŠ¨ä¸‹å•
autoCloseEnabled: true,     // å…¨è‡ªåŠ¨å¹³ä»“
```

#### 2.5 å®šæ—¶å¼€å…³è®¾ç½®
```javascript
scheduleStart: null,        // å®šæ—¶å¯åŠ¨æ—¶é—´ï¼ˆå¯é€‰ï¼‰
scheduleStop: null,         // å®šæ—¶åœæ­¢æ—¶é—´ï¼ˆå¯é€‰ï¼‰
```

#### 2.6 é»˜è®¤äº¤æ˜“å‚æ•°ï¼ˆè¿è¡Œæ—¶ä¼šè¢«ç­–ç•¥æ¨¡æ¿è¦†ç›–ï¼‰
```javascript
orderType: 'market',        // è®¢å•ç±»å‹
marginMode: 'isolated',     // ä¿è¯é‡‘æ¨¡å¼
leverage: 20,              // æ æ†å€æ•°ï¼ˆé»˜è®¤å€¼ï¼‰
marginPercent: 50,         // ä¿è¯é‡‘æ¯”ä¾‹ï¼ˆé»˜è®¤å€¼ï¼‰
stopLossPercent: 5,        // æ­¢æŸç™¾åˆ†æ¯”ï¼ˆé»˜è®¤å€¼ï¼‰
autoStartRetreatPercent: 3, // å¯åŠ¨æ­¢ç›ˆç™¾åˆ†æ¯”ï¼ˆé»˜è®¤å€¼ï¼‰
profitRetreatPercent: 30,  // æ­¢ç›ˆå›æ’¤ç™¾åˆ†æ¯”ï¼ˆé»˜è®¤å€¼ï¼‰
marketState: 'trend',      // å¸‚åœºçŠ¶æ€ï¼ˆé»˜è®¤å€¼ï¼‰
riskPreference: 'balanced', // é£é™©åå¥½ï¼ˆé»˜è®¤å€¼ï¼‰
```

---

### 3. è¡¨å•éªŒè¯ï¼ˆ`handleSubmit`ï¼‰

#### 3.1 å‰ç«¯éªŒè¯è§„åˆ™
```javascript
rules = {
  robotName: { required: true },
  apiConfigId: { required: true },
  maxProfitTarget: { required: true },
  maxLossAmount: { required: true },
  symbol: { required: true },
  // ... å…¶ä»–éªŒè¯è§„åˆ™
}
```

#### 3.2 è‡ªå®šä¹‰éªŒè¯
```javascript
- éªŒè¯ API é…ç½®æ˜¯å¦é€‰æ‹©
- éªŒè¯ç­–ç•¥ç»„æ˜¯å¦é€‰æ‹©ï¼ˆselectedStrategyGroupId æˆ– selectedOfficialGroupIdï¼‰
```

---

### 4. ç­–ç•¥ç»„å¤„ç†

#### 4.1 æˆ‘çš„ç­–ç•¥ç»„
```javascript
if (formData.strategySource === 'my' && selectedStrategyGroupId.value) {
  strategyGroupId = selectedStrategyGroupId.value;
}
```

#### 4.2 å®˜æ–¹ç­–ç•¥ç»„ï¼ˆéœ€è¦å…ˆå¤åˆ¶åˆ°æˆ‘çš„ç­–ç•¥ï¼‰
```javascript
if (formData.strategySource === 'official' && selectedOfficialGroupId.value) {
  // è°ƒç”¨å¤åˆ¶æ¥å£
  await http.request({
    url: '/strategy/group/copyFromOfficial',
    method: 'post',
    data: { officialGroupId: selectedOfficialGroupId.value },
  });
  
  // è·å–å¤åˆ¶åçš„ç­–ç•¥ç»„ID
  strategyGroupId = res?.id || 0;
  
  // å¦‚æœå·²å­˜åœ¨ï¼Œä»æˆ‘çš„ç­–ç•¥ä¸­æŸ¥æ‰¾
  if (errorMsg.includes('å·²å­˜åœ¨')) {
    const myGroup = myStrategyGroups.value.find(
      (g: any) => g.fromOfficialId === selectedOfficialGroupId.value
    );
    strategyGroupId = myGroup.id;
  }
}
```

#### 4.3 æœ€ç»ˆéªŒè¯
```javascript
if (strategyGroupId <= 0) {
  message.error('ç­–ç•¥ç»„é€‰æ‹©å¤±è´¥ï¼Œè¯·é‡æ–°é€‰æ‹©');
  return;
}
```

---

### 5. æ„å»ºè¯·æ±‚æ•°æ®

#### 5.1 æ ¸å¿ƒæ•°æ®
```javascript
const data = {
  robotName: formData.value.robotName,
  apiConfigId: formData.value.apiConfigId,
  maxProfitTarget: formData.value.maxProfitTarget,
  maxLossAmount: formData.value.maxLossAmount,
  maxRuntime: 0,  // æœ€å¤§è¿è¡Œæ—¶é•¿ï¼Œé»˜è®¤0è¡¨ç¤ºä¸é™åˆ¶
  
  // â­ å…³é”®ï¼šç­–ç•¥ç»„IDï¼ˆç”¨äºè¿è¡Œæ—¶åŠ è½½ç­–ç•¥æ¨¡æ¿ï¼‰
  strategyGroupId: strategyGroupId,
  
  // â­ å…³é”®ï¼šå¸‚åœºçŠ¶æ€ä¸é£é™©åå¥½æ˜ å°„ï¼ˆåˆ›å»ºæ—¶é™æ€é…ç½®ï¼Œè¿è¡Œæ—¶æ ¹æ®æ˜ å°„å…³ç³»åŒ¹é…ç­–ç•¥æ¨¡æ¿ï¼‰
  marketRiskMapping: formData.value.marketRiskMapping,
  
  // å…¨è‡ªåŠ¨äº¤æ˜“å¼€å…³
  autoTradeEnabled: formData.value.autoTradeEnabled ? 1 : 0,
  autoCloseEnabled: formData.value.autoCloseEnabled ? 1 : 0,
  
  // è‡ªåŠ¨åŒ–è®¾ç½®
  autoMarketState: formData.value.autoMarketState ? 1 : 0,
  useMonitorSignal: formData.value.useMonitorSignal ? 1 : 0,
  
  // å®šæ—¶å¼€å…³è®¾ç½®
  scheduleStart: formData.value.scheduleStart 
    ? new Date(formData.value.scheduleStart).toISOString() 
    : '',
  scheduleStop: formData.value.scheduleStop 
    ? new Date(formData.value.scheduleStop).toISOString() 
    : '',
  
  // äº¤æ˜“å‚æ•°é…ç½®ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼Œè¿è¡Œæ—¶ä¼šè¢«ç­–ç•¥æ¨¡æ¿è¦†ç›–ï¼‰
  exchange: formData.value.exchange,
  symbol: formData.value.symbol,
  orderType: formData.value.orderType || 'market',
  marginMode: formData.value.marginMode || 'isolated',
  leverage: formData.value.leverage || 10,
  marginPercent: formData.value.marginPercent || 10,
  stopLossPercent: formData.value.stopLossPercent || 10,
  autoStartRetreatPercent: formData.value.autoStartRetreatPercent || 5,
  profitRetreatPercent: formData.value.profitRetreatPercent || 10,
  marketState: backendMarketState,
  riskPreference: formData.value.riskPreference || 'balanced',
  
  remark: `ç­–ç•¥ç»„ID: ${strategyGroupId}`,
};
```

---

### 6. å‘é€è¯·æ±‚

```javascript
await http.request({
  url: '/trading/robot/create',
  method: 'post',
  data,
});

// æˆåŠŸåçš„å¤„ç†
message.success('æœºå™¨äººåˆ›å»ºæˆåŠŸï¼');
router.push('/toogo/robot');
```

---

## ğŸ”§ åç«¯æ‰§è¡Œæµç¨‹ï¼ˆ`server/internal/logic/trading/robot.go`ï¼‰

### 1. æ¥æ”¶è¯·æ±‚ï¼ˆ`Create` æ–¹æ³•ï¼‰

#### 1.1 ç”¨æˆ·èº«ä»½éªŒè¯
```go
memberId := contexts.GetUserId(ctx)
if memberId <= 0 {
    return 0, gerror.New("ç”¨æˆ·æœªç™»å½•")
}
```

---

### 2. APIé…ç½®éªŒè¯

#### 2.1 æŸ¥è¯¢APIé…ç½®
```go
var apiConfig *entity.TradingApiConfig
err = dao.TradingApiConfig.Ctx(ctx).
    Where(dao.TradingApiConfig.Columns().Id, in.ApiConfigId).
    Where(dao.TradingApiConfig.Columns().UserId, memberId).
    WhereNull(dao.TradingApiConfig.Columns().DeletedAt).
    Scan(&apiConfig)
```

#### 2.2 éªŒè¯ç»“æœ
```go
if apiConfig == nil {
    return 0, gerror.New("APIé…ç½®ä¸å­˜åœ¨æˆ–æ— æƒé™")
}
```

---

### 3. ç­–ç•¥ç»„IDéªŒè¯

```go
if in.StrategyGroupId == 0 {
    return 0, gerror.New("ç­–ç•¥ç»„IDä¸èƒ½ä¸ºç©ºï¼Œè¯·é€‰æ‹©ç­–ç•¥ç»„")
}
```

---

### 4. æ„å»ºç­–ç•¥é…ç½®JSON

#### 4.1 ç²¾ç®€çš„ç­–ç•¥é…ç½®ï¼ˆåªä¿å­˜å¿…éœ€æ•°æ®ï¼‰
```go
strategyConfig := map[string]interface{}{
    // â­ ç­–ç•¥ç»„IDï¼ˆå¿…éœ€ï¼šç”¨äºè¿è¡Œæ—¶æŸ¥è¯¢ç­–ç•¥æ¨¡æ¿ï¼‰
    "groupId": in.StrategyGroupId,
}

// â­ é£é™©é…ç½®ï¼ˆåŒ…å«æ˜ å°„å…³ç³»ï¼‰
if in.MarketRiskMapping != nil && len(in.MarketRiskMapping) > 0 {
    strategyConfig["riskConfig"] = map[string]interface{}{
        "marketRiskMapping": in.MarketRiskMapping,
    }
}
```

#### 4.2 è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²
```go
strategyJSON, err := json.Marshal(strategyConfig)
// ä¿å­˜åˆ° current_strategy å­—æ®µ
```

**ç”Ÿæˆçš„JSONç¤ºä¾‹ï¼š**
```json
{
  "groupId": 18,
  "riskConfig": {
    "marketRiskMapping": {
      "trend": "balanced",
      "volatile": "balanced",
      "high_vol": "aggressive",
      "low_vol": "conservative"
    }
  }
}
```

**è¯´æ˜ï¼š**
- `groupId`ï¼šç­–ç•¥ç»„IDï¼ˆè¿è¡Œæ—¶æ ¹æ®æ­¤IDæŸ¥è¯¢ç­–ç•¥æ¨¡æ¿ï¼‰
- `marketRiskMapping`ï¼šå¸‚åœºçŠ¶æ€æ˜ å°„å…³ç³»ï¼ˆåˆ›å»ºæ—¶é™æ€é…ç½®ï¼Œè¿è¡Œæ—¶æ ¹æ®æ­¤æ˜ å°„å…³ç³»åŒ¹é…é£é™©åå¥½ï¼‰

---

### 5. è®¾ç½®é»˜è®¤å€¼

```go
// ç¡®ä¿å¿…å¡«å­—æ®µä¸ä¸ºç©º
if in.RiskPreference == "" {
    in.RiskPreference = "balanced"
}
if in.MarketState == "" {
    in.MarketState = "trend"
}
if in.Exchange == "" {
    in.Exchange = "bitget"
}
if in.Symbol == "" {
    in.Symbol = "BTC_USDT"
}
if in.OrderType == "" {
    in.OrderType = "market"
}
if in.MarginMode == "" {
    in.MarginMode = "isolated"
}
if in.Leverage <= 0 {
    in.Leverage = 10
}
if in.MarginPercent <= 0 {
    in.MarginPercent = 10
}
if in.StopLossPercent <= 0 {
    in.StopLossPercent = 10
}
if in.ProfitRetreatPercent <= 0 {
    in.ProfitRetreatPercent = 10
}
if in.AutoStartRetreatPercent <= 0 {
    in.AutoStartRetreatPercent = 5
}
```

---

### 6. æ„å»ºæ•°æ®åº“æ’å…¥æ•°æ®

#### 6.1 åˆ›å»º DO å¯¹è±¡
```go
data := &do.TradingRobot{
    UserId:                  memberId,
    RobotName:               in.RobotName,
    ApiConfigId:             in.ApiConfigId,
    MaxProfitTarget:         in.MaxProfitTarget,
    MaxLossAmount:           in.MaxLossAmount,
    MaxRuntime:              in.MaxRuntime,
    RiskPreference:          in.RiskPreference,
    AutoRiskPreference:      in.AutoRiskPreference,
    MarketState:             in.MarketState,
    AutoMarketState:         in.AutoMarketState,
    Exchange:                in.Exchange,
    Symbol:                  in.Symbol,
    OrderType:               in.OrderType,
    MarginMode:              in.MarginMode,
    Leverage:                in.Leverage,
    MarginPercent:           in.MarginPercent,
    UseMonitorSignal:        in.UseMonitorSignal,
    StopLossPercent:         in.StopLossPercent,
    ProfitRetreatPercent:    in.ProfitRetreatPercent,
    AutoStartRetreatPercent: in.AutoStartRetreatPercent,
    CurrentStrategy:         string(strategyJSON),  // â­ ç­–ç•¥é…ç½®JSON
    Status:                  1,  // æœªå¯åŠ¨
    LongCount:               0,
    ShortCount:              0,
    TotalProfit:             0,
    RuntimeSeconds:          0,
    AutoTradeEnabled:        in.AutoTradeEnabled,
    AutoCloseEnabled:         in.AutoCloseEnabled,
    Remark:                   in.Remark,
}
```

#### 6.2 å¤„ç†é¢å¤–å­—æ®µï¼ˆç­–ç•¥ç»„IDã€å®šæ—¶å¼€å…³ï¼‰
```go
dataMap := g.Map{}

// â­ è®¾ç½®ç­–ç•¥ç»„IDï¼ˆå‰ç«¯å¿…é¡»ä¼ é€’ï¼‰
if in.StrategyGroupId > 0 {
    dataMap["strategy_group_id"] = in.StrategyGroupId
}

// å®šæ—¶å¯åŠ¨æ—¶é—´
if in.ScheduleStart != "" {
    scheduleStartTime, err := gtime.StrToTime(in.ScheduleStart)
    if err == nil {
        dataMap["schedule_start"] = scheduleStartTime
    }
}

// å®šæ—¶åœæ­¢æ—¶é—´
if in.ScheduleStop != "" {
    scheduleStopTime, err := gtime.StrToTime(in.ScheduleStop)
    if err == nil {
        dataMap["schedule_stop"] = scheduleStopTime
    }
}
```

---

### 7. åˆå¹¶æ•°æ®å¹¶æ’å…¥æ•°æ®åº“

#### 7.1 è½¬æ¢ä¸º g.Mapï¼ˆåªä¿å­˜å¿…éœ€å­—æ®µï¼‰
```go
insertData := g.Map{
    "user_id":             data.UserId,
    "robot_name":          data.RobotName,
    "api_config_id":      data.ApiConfigId,
    "max_profit_target":  data.MaxProfitTarget,
    "max_loss_amount":    data.MaxLossAmount,
    "max_runtime":        data.MaxRuntime,
    "auto_market_state":  data.AutoMarketState,
    "exchange":           data.Exchange, // å¿…éœ€å­—æ®µ
    "symbol":             data.Symbol,   // å¿…éœ€å­—æ®µ
    "use_monitor_signal": data.UseMonitorSignal,
    "current_strategy":   data.CurrentStrategy, // â­ åŒ…å«groupIdå’ŒmarketRiskMapping
    "status":             data.Status,
    "long_count":         data.LongCount,
    "short_count":        data.ShortCount,
    "total_profit":       data.TotalProfit,
    "runtime_seconds":    data.RuntimeSeconds,
    "auto_trade_enabled": data.AutoTradeEnabled,
    "auto_close_enabled": data.AutoCloseEnabled,
    "remark":             data.Remark,
    // âŒ ä»¥ä¸‹å­—æ®µè¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼Œä¸éœ€è¦ä¿å­˜ï¼š
    // - risk_preference, market_state (è¿è¡Œæ—¶æ ¹æ®æ˜ å°„å…³ç³»åŠ¨æ€è·å–)
    // - order_type, margin_mode (è¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½)
    // - leverage, margin_percent (è¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½)
    // - stop_loss_percent, profit_retreat_percent, auto_start_retreat_percent (è¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½)
}

// åˆå¹¶é¢å¤–çš„å­—æ®µï¼ˆç­–ç•¥ç»„IDã€å®šæ—¶å¼€å…³ç­‰ï¼‰
for k, v := range dataMap {
    insertData[k] = v
}
```

#### 7.2 æ’å…¥æ•°æ®åº“
```go
id, err = dao.TradingRobot.Ctx(ctx).Data(insertData).InsertAndGetId()
return id, err
```

---

## ğŸ“Š æ•°æ®åº“ä¿å­˜çš„æ•°æ®

### 1. æ ¸å¿ƒå­—æ®µ

| å­—æ®µå | è¯´æ˜ | æ¥æº |
|--------|------|------|
| `user_id` | ç”¨æˆ·ID | ä»ä¸Šä¸‹æ–‡è·å– |
| `robot_name` | æœºå™¨äººåç§° | å‰ç«¯è¡¨å• |
| `api_config_id` | APIé…ç½®ID | å‰ç«¯è¡¨å• |
| `strategy_group_id` | â­ ç­–ç•¥ç»„ID | å‰ç«¯è¡¨å•ï¼ˆå¿…éœ€ï¼‰ |
| `current_strategy` | â­ ç­–ç•¥é…ç½®JSON | åç«¯æ„å»ºï¼ˆåŒ…å«groupIdå’ŒmarketRiskMappingï¼‰ |
| `status` | çŠ¶æ€ | å›ºå®šä¸º1ï¼ˆæœªå¯åŠ¨ï¼‰ |

### 2. äº¤æ˜“åŸºç¡€é…ç½®ï¼ˆå¿…éœ€å­—æ®µï¼‰

| å­—æ®µå | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `exchange` | äº¤æ˜“æ‰€ | bitgetï¼ˆå¦‚æœå‰ç«¯æœªä¼ é€’ï¼‰ |
| `symbol` | äº¤æ˜“å¯¹ | BTCUSDTï¼ˆå¦‚æœå‰ç«¯æœªä¼ é€’ï¼‰ |

**æ³¨æ„ï¼š** ä»¥ä¸‹äº¤æ˜“å‚æ•°è¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼Œåˆ›å»ºæ—¶ä¸ä¿å­˜ï¼š
- `order_type`ã€`margin_mode`ï¼ˆè¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼‰
- `leverage`ã€`margin_percent`ï¼ˆè¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼‰
- `stop_loss_percent`ã€`profit_retreat_percent`ã€`auto_start_retreat_percent`ï¼ˆè¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼‰
- `risk_preference`ã€`market_state`ï¼ˆè¿è¡Œæ—¶æ ¹æ®æ˜ å°„å…³ç³»åŠ¨æ€è·å–ï¼‰

### 3. è‡ªåŠ¨åŒ–å¼€å…³

| å­—æ®µå | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `auto_market_state` | è‡ªåŠ¨åˆ†æå¸‚åœºçŠ¶æ€ | 1ï¼ˆå¼€å¯ï¼‰ |
| `use_monitor_signal` | æ–¹å‘ä¿¡å·å¼€å…³ | 1ï¼ˆå¼€å¯ï¼‰ |
| `auto_trade_enabled` | å…¨è‡ªåŠ¨ä¸‹å• | 1ï¼ˆå¼€å¯ï¼‰ |
| `auto_close_enabled` | å…¨è‡ªåŠ¨å¹³ä»“ | 1ï¼ˆå¼€å¯ï¼‰ |

### 4. å®šæ—¶å¼€å…³

| å­—æ®µå | è¯´æ˜ | å¯é€‰ |
|--------|------|------|
| `schedule_start` | å®šæ—¶å¯åŠ¨æ—¶é—´ | æ˜¯ |
| `schedule_stop` | å®šæ—¶åœæ­¢æ—¶é—´ | æ˜¯ |

---

## ğŸ”‘ å…³é”®ç‚¹æ€»ç»“

### 1. ç­–ç•¥ç»„IDï¼ˆå¿…éœ€ï¼‰
- **å‰ç«¯**ï¼šå¿…é¡»é€‰æ‹©ç­–ç•¥ç»„ï¼ˆæˆ‘çš„ç­–ç•¥æˆ–å®˜æ–¹ç­–ç•¥ï¼‰
- **åç«¯**ï¼šéªŒè¯ç­–ç•¥ç»„IDä¸èƒ½ä¸ºç©º
- **æ•°æ®åº“**ï¼šä¿å­˜åˆ° `strategy_group_id` å­—æ®µ

### 2. ç­–ç•¥é…ç½®JSONï¼ˆç²¾ç®€ç‰ˆï¼‰
- **åªä¿å­˜å¿…éœ€æ•°æ®**ï¼š
  - `groupId`ï¼šç­–ç•¥ç»„ID
  - `marketRiskMapping`ï¼šå¸‚åœºçŠ¶æ€ä¸é£é™©åå¥½æ˜ å°„
- **ä¸ä¿å­˜**ï¼šå…·ä½“çš„ç­–ç•¥å‚æ•°ï¼ˆè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼‰

### 3. äº¤æ˜“å‚æ•°ï¼ˆè¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼‰
- **åˆ›å»ºæ—¶ä¸ä¿å­˜äº¤æ˜“å‚æ•°**
- è¿è¡Œæ—¶å¼•æ“ä»ç­–ç•¥æ¨¡æ¿åŠ è½½å‚æ•°
- ç­–ç•¥æ¨¡æ¿æ ¹æ®å¸‚åœºçŠ¶æ€å’Œæ˜ å°„å…³ç³»åŠ¨æ€åŒ¹é…

### 4. å¸‚åœºçŠ¶æ€æ˜ å°„
- å‰ç«¯é…ç½®ï¼š`trend/volatile/high_vol/low_vol` â†’ `conservative/balanced/aggressive`
- ä¿å­˜åˆ°ï¼š`current_strategy` JSON çš„ `riskConfig.marketRiskMapping`
- **æ˜ å°„å…³ç³»æ˜¯é™æ€çš„**ï¼šåˆ›å»ºæ—¶é…ç½®ï¼Œè¿è¡Œæ—¶ä¸å˜
- **è¿è¡Œæ—¶é€»è¾‘**ï¼š
  1. å®æ—¶åˆ†æå¸‚åœºçŠ¶æ€ï¼ˆåŠ¨æ€ï¼‰
  2. æ ¹æ®æ˜ å°„å…³ç³»è·å–å¯¹åº”çš„é£é™©åå¥½ï¼ˆé™æ€æ˜ å°„ï¼‰
  3. æ ¹æ® `groupId` + å¸‚åœºçŠ¶æ€ + é£é™©åå¥½ï¼ŒæŸ¥è¯¢ç­–ç•¥æ¨¡æ¿
  4. åŠ è½½ç­–ç•¥æ¨¡æ¿å‚æ•°

---

## ğŸš€ è¿è¡Œæ—¶è¡Œä¸º

### 1. å¯åŠ¨æœºå™¨äººæ—¶
1. ä» `current_strategy` JSON ä¸­è¯»å– `groupId` å’Œ `marketRiskMapping`
2. æ ¹æ®å®æ—¶å¸‚åœºçŠ¶æ€ï¼Œä» `marketRiskMapping` ä¸­è·å–å¯¹åº”çš„é£é™©åå¥½
3. æ ¹æ® `groupId`ã€å¸‚åœºçŠ¶æ€ã€é£é™©åå¥½ï¼ŒæŸ¥è¯¢ç­–ç•¥æ¨¡æ¿
4. åŠ è½½ç­–ç•¥æ¨¡æ¿çš„å‚æ•°ï¼ˆæ æ†ã€ä¿è¯é‡‘ã€æ­¢æŸã€æ­¢ç›ˆç­‰ï¼‰
5. ä½¿ç”¨ç­–ç•¥æ¨¡æ¿å‚æ•°è¦†ç›–æ•°æ®åº“ä¸­çš„é»˜è®¤å€¼

### 2. å¸‚åœºçŠ¶æ€å˜åŒ–æ—¶
1. å®æ—¶åˆ†æå¸‚åœºçŠ¶æ€ï¼ˆè¶‹åŠ¿/éœ‡è¡/é«˜æ³¢åŠ¨/ä½æ³¢åŠ¨ï¼‰
2. æ ¹æ® `marketRiskMapping` è·å–å¯¹åº”çš„é£é™©åå¥½
3. é‡æ–°æŸ¥è¯¢ç­–ç•¥æ¨¡æ¿
4. æ›´æ–°ç­–ç•¥å‚æ•°

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç­–ç•¥ç»„IDæ˜¯å¿…éœ€çš„**ï¼šåˆ›å»ºæ—¶å¿…é¡»é€‰æ‹©ç­–ç•¥ç»„ï¼Œå¦åˆ™ä¼šæŠ¥é”™
2. **å®˜æ–¹ç­–ç•¥éœ€è¦å¤åˆ¶**ï¼šé€‰æ‹©å®˜æ–¹ç­–ç•¥æ—¶ï¼Œä¼šå…ˆå¤åˆ¶åˆ°æˆ‘çš„ç­–ç•¥
3. **äº¤æ˜“å‚æ•°æ˜¯é»˜è®¤å€¼**ï¼šåˆ›å»ºæ—¶ä¿å­˜çš„å‚æ•°åªæ˜¯é»˜è®¤å€¼ï¼Œè¿è¡Œæ—¶ä¼šè¢«ç­–ç•¥æ¨¡æ¿è¦†ç›–
4. **ç­–ç•¥é…ç½®JSONæ˜¯ç²¾ç®€ç‰ˆ**ï¼šåªä¿å­˜ `groupId` å’Œ `marketRiskMapping`ï¼Œä¸ä¿å­˜å…·ä½“å‚æ•°
5. **æ˜ å°„å…³ç³»æ˜¯é™æ€çš„**ï¼šåˆ›å»ºæ—¶é…ç½®ï¼Œè¿è¡Œæ—¶æ ¹æ®æ˜ å°„å…³ç³»åŒ¹é…ç­–ç•¥æ¨¡æ¿

---

## ğŸ” è°ƒè¯•å»ºè®®

1. **æ£€æŸ¥ç­–ç•¥ç»„ID**ï¼šç¡®ä¿å‰ç«¯ä¼ é€’äº†æ­£ç¡®çš„ç­–ç•¥ç»„ID
2. **æ£€æŸ¥ç­–ç•¥é…ç½®JSON**ï¼šæŸ¥çœ‹ `current_strategy` å­—æ®µçš„JSONæ ¼å¼æ˜¯å¦æ­£ç¡®
3. **æ£€æŸ¥å¸‚åœºçŠ¶æ€æ˜ å°„**ï¼šç¡®è®¤ `marketRiskMapping` çš„é”®å€¼å¯¹æ˜¯å¦æ­£ç¡®
4. **æ£€æŸ¥é»˜è®¤å€¼**ï¼šç¡®è®¤æ•°æ®åº“ä¸­çš„é»˜è®¤å€¼æ˜¯å¦ç¬¦åˆé¢„æœŸ
5. **æ£€æŸ¥è¿è¡Œæ—¶åŠ è½½**ï¼šå¯åŠ¨æœºå™¨äººåï¼Œæ£€æŸ¥ç­–ç•¥æ¨¡æ¿æ˜¯å¦æ­£ç¡®åŠ è½½

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- **å‰ç«¯**ï¼š`web/src/views/toogo/robot/create.vue`
- **åç«¯é€»è¾‘**ï¼š`server/internal/logic/trading/robot.go`
- **APIå®šä¹‰**ï¼š`server/api/admin/trading/robot.go`
- **è¾“å…¥æ¨¡å‹**ï¼š`server/internal/model/input/trading_robot.go`
- **å®ä½“æ¨¡å‹**ï¼š`server/internal/model/entity/trading_robot.go`

