# å…¨å±€å¼•æ“è¯Šæ–­è¯´æ˜

## ğŸ¯ é—®é¢˜ç¡®è®¤

ä½ è¯´å¾—å¯¹ï¼ç³»ç»Ÿåº”è¯¥æœ‰**ä¸¤ä¸ªç‹¬ç«‹çš„WebSocketç³»ç»Ÿ**ï¼š

### 1. å…¨å±€å¼•æ“çš„å…¬å…±WebSocketï¼ˆè¡Œæƒ…æ•°æ®ï¼‰
- **ç®¡ç†å™¨**ï¼š`MarketServiceManager`
- **ç”¨é€”**ï¼šè·å–å…¬å…±è¡Œæƒ…æ•°æ®ï¼ˆTickerã€Kçº¿ï¼‰
- **ç‰¹ç‚¹**ï¼š
  - âœ… ä¸éœ€è¦API Key
  - âœ… æ‰€æœ‰æœºå™¨äººå…±äº«
  - âœ… è¿æ¥å…¬å…±WebSocketç«¯ç‚¹
- **çŠ¶æ€**ï¼šâŒ **æ²¡æœ‰å¯åŠ¨**ï¼ˆè¿™æ˜¯æ ¸å¿ƒé—®é¢˜ï¼‰

### 2. æœºå™¨äººçš„ç§æœ‰WebSocketï¼ˆè®¢å•/æŒä»“ï¼‰
- **ç®¡ç†å™¨**ï¼š`PrivateStreamManager`
- **ç”¨é€”**ï¼šè·å–è®¢å•ã€æŒä»“æ›´æ–°
- **ç‰¹ç‚¹**ï¼š
  - âœ… éœ€è¦API Key
  - âœ… æ¯ä¸ªè´¦æˆ·ä¸€ä¸ªè¿æ¥
  - âœ… è¿æ¥ç§æœ‰WebSocketç«¯ç‚¹
- **çŠ¶æ€**ï¼šâœ… æ­£åœ¨å·¥ä½œï¼ˆæ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ï¼‰

## ğŸ” å·²å®Œæˆçš„è¯Šæ–­

### 1. é…ç½®æ£€æŸ¥ âœ…
```yaml
toogo:
  websocketEnabled: true  # âœ… å·²æ­£ç¡®é…ç½®
```

### 2. ä»£ç æ£€æŸ¥ âœ…
- `RobotTaskManager.Start()` åº”è¯¥è°ƒç”¨ `MarketServiceManager.Start()`
- `MarketServiceManager.Start()` åº”è¯¥è°ƒç”¨ `startWebSocketServices()`
- `startWebSocketServices()` åº”è¯¥å¯åŠ¨4ä¸ªäº¤æ˜“æ‰€çš„WebSocket

### 3. æ—¥å¿—çº§åˆ«é—®é¢˜ âš ï¸
```yaml
logger:
  level: "warning"  # INFOæ—¥å¿—è¢«è¿‡æ»¤äº†
```

## ğŸ”§ å·²å®æ–½çš„ä¿®å¤

### 1. Symbolæ ¼å¼ç»Ÿä¸€ âœ…
- åˆ›å»ºäº† `symbol_formatter.go`
- ç»Ÿä¸€äº†æ‰€æœ‰äº¤æ˜“æ‰€çš„Symbolæ ¼å¼åŒ–é€»è¾‘
- ä¿®å¤äº†Bitgetç§æœ‰WSçš„ `_UMCBL` åç¼€é—®é¢˜

### 2. å¢å¼ºæ—¥å¿—è¾“å‡º âœ…
ä¸ºäº†è¯Šæ–­å…¨å±€å¼•æ“å¯åŠ¨é—®é¢˜ï¼Œæ·»åŠ äº†WARNINGçº§åˆ«çš„æ—¥å¿—ï¼š

```go
// MarketServiceManager.Start()
g.Log().Warning(ctx, "[MarketServiceManager] ğŸš€ å¼€å§‹å¯åŠ¨å…¨å±€è¡Œæƒ…æœåŠ¡ç®¡ç†å™¨...")
g.Log().Warning(ctx, "[MarketServiceManager] âœ… å…¨å±€è¡Œæƒ…æœåŠ¡ç®¡ç†å™¨å¯åŠ¨å®Œæˆ")

// startWebSocketServices()
g.Log().Warningf(ctx, "[MarketServiceManager] æ£€æŸ¥WebSocketé…ç½®: wsEnabled=%v...")
g.Log().Warning(ctx, "[MarketServiceManager] å‡†å¤‡å¯åŠ¨WebSocketæœåŠ¡...")
g.Log().Warning(ctx, "[MarketServiceManager] âœ… Bitget WebSocketå·²å¯åŠ¨")
g.Log().Warning(ctx, "[MarketServiceManager] âœ… Binance WebSocketå·²å¯åŠ¨")
g.Log().Warning(ctx, "[MarketServiceManager] âœ… OKX WebSocketå·²å¯åŠ¨")
g.Log().Warning(ctx, "[MarketServiceManager] âœ… Gate WebSocketå·²å¯åŠ¨")
g.Log().Warning(ctx, "[MarketServiceManager] WebSocketæœåŠ¡å¯åŠ¨æµç¨‹å®Œæˆ")
```

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. åœæ­¢å½“å‰æœåŠ¡
åœ¨terminal 7ä¸­æŒ‰ `Ctrl+C`

### 2. å¯åŠ¨æ–°æœåŠ¡
```powershell
.\main.exe http
```

### 3. è§‚å¯Ÿå¯åŠ¨æ—¥å¿—

**åº”è¯¥çœ‹åˆ°çš„æ—¥å¿—**ï¼ˆæŒ‰é¡ºåºï¼‰ï¼š
```
[WARN] [MarketServiceManager] ğŸš€ å¼€å§‹å¯åŠ¨å…¨å±€è¡Œæƒ…æœåŠ¡ç®¡ç†å™¨...
[WARN] [MarketServiceManager] æ£€æŸ¥WebSocketé…ç½®: wsEnabled=true, IsEmpty=false, Bool=true
[WARN] [MarketServiceManager] å‡†å¤‡å¯åŠ¨WebSocketæœåŠ¡...
[WARN] [MarketServiceManager] âœ… Bitget WebSocketå·²å¯åŠ¨
[WARN] [MarketServiceManager] âœ… Binance WebSocketå·²å¯åŠ¨
[WARN] [MarketServiceManager] âœ… OKX WebSocketå·²å¯åŠ¨
[WARN] [MarketServiceManager] âœ… Gate WebSocketå·²å¯åŠ¨
[WARN] [MarketServiceManager] WebSocketæœåŠ¡å¯åŠ¨æµç¨‹å®Œæˆ
[WARN] [MarketServiceManager] âœ… å…¨å±€è¡Œæƒ…æœåŠ¡ç®¡ç†å™¨å¯åŠ¨å®Œæˆ
```

**å¦‚æœä»ç„¶æ²¡æœ‰è¿™äº›æ—¥å¿—**ï¼Œè¯´æ˜ï¼š
- `RobotTaskManager.Start()` æ²¡æœ‰è¢«è°ƒç”¨
- æˆ–è€… `MarketServiceManager.Start()` æå‰è¿”å›äº†

### 4. é¢„æœŸæ•ˆæœ

å¯åŠ¨æˆåŠŸåï¼š
- âœ… å…¨å±€å¼•æ“çš„å…¬å…±WebSocketè¿æ¥åˆ°4ä¸ªäº¤æ˜“æ‰€
- âœ… æœºå™¨äººçš„ç§æœ‰WebSocketè¿æ¥åˆ°å„è‡ªçš„è´¦æˆ·
- âœ… ä¸å†å‡ºç°"å…¨å±€å¸‚åœºåˆ†æå™¨æœªè¿”å›å¸‚åœºçŠ¶æ€æ•°æ®"
- âœ… å‰ç«¯æ˜¾ç¤ºæ­£å¸¸çš„æœºå™¨äººçŠ¶æ€

## ğŸ“Š WebSocketæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å…¨å±€å¼•æ“ (MarketServiceManager)          â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Binance  â”‚  â”‚   OKX    â”‚  â”‚  Gate    â”‚ ... â”‚
â”‚  â”‚ Public WSâ”‚  â”‚ Public WSâ”‚  â”‚ Public WSâ”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚       â†“              â†“              â†“          â”‚
â”‚  Ticker/Kline   Ticker/Kline   Ticker/Kline   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
              æ‰€æœ‰æœºå™¨äººå…±äº«
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æœºå™¨äººç§æœ‰WS (PrivateStreamManager)         â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Account1 â”‚  â”‚ Account2 â”‚  â”‚ Account3 â”‚ ... â”‚
â”‚  â”‚Private WSâ”‚  â”‚Private WSâ”‚  â”‚Private WSâ”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚       â†“              â†“              â†“          â”‚
â”‚  Orders/Pos    Orders/Pos    Orders/Pos       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
              å„æœºå™¨äººç‹¬äº«
```

## ğŸ“ æ€»ç»“

1. **ä¸¤ä¸ªWebSocketç³»ç»Ÿä¸å†²çª**ï¼šä½ è¯´å¾—å®Œå…¨æ­£ç¡®ï¼
2. **å…¨å±€å¼•æ“è´Ÿè´£è¡Œæƒ…**ï¼šå…¬å…±æ•°æ®ï¼Œæ‰€æœ‰æœºå™¨äººå…±äº«
3. **ç§æœ‰WSè´Ÿè´£äº¤æ˜“**ï¼šè®¢å•/æŒä»“ï¼Œæ¯ä¸ªè´¦æˆ·ç‹¬ç«‹
4. **å½“å‰é—®é¢˜**ï¼šå…¨å±€å¼•æ“çš„WebSocketæ²¡æœ‰å¯åŠ¨
5. **è§£å†³æ–¹æ¡ˆ**ï¼šæ·»åŠ äº†è¯¦ç»†æ—¥å¿—ï¼Œé‡å¯åå¯ä»¥çœ‹åˆ°å¯åŠ¨è¿‡ç¨‹

---

**ç°åœ¨è¯·é‡å¯æœåŠ¡ï¼Œè§‚å¯Ÿæ—¥å¿—ï¼** ğŸš€

