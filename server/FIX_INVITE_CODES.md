# ä¿®æ­£æ°¸ä¹…é‚€è¯·ç å·¥å…·

## ğŸ“‹ é—®é¢˜è¯´æ˜

ç³»ç»Ÿå‘ç°éƒ¨åˆ†ç”¨æˆ·çš„æ°¸ä¹…é‚€è¯·ç æ ¼å¼ä¸ç¬¦åˆè§„èŒƒã€‚

### ç¬¦åˆè§„èŒƒçš„æ ¼å¼
- **æ€»é•¿åº¦**ï¼š8ä½
- **å‰4ä½**ï¼šå¤§å†™å­—æ¯ï¼ˆA-Zï¼‰
- **å4ä½**ï¼šæ•°å­—ï¼ˆ0-9ï¼Œä½†ä¸å«æ•°å­—4ï¼‰
- **ç¤ºä¾‹**ï¼š`ABCD1235`ã€`XYZW0678`

### ä¸ç¬¦åˆè§„èŒƒçš„ç¤ºä¾‹
- `3krWX8gIBPJy` - 12ä½ï¼ŒåŒ…å«å°å†™å­—æ¯
- `ABCD1234` - åŒ…å«æ•°å­—4
- `abcd1235` - åŒ…å«å°å†™å­—æ¯

## ğŸ› ï¸ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1ï¼šä½¿ç”¨è‡ªåŠ¨ä¿®æ­£å·¥å…·ï¼ˆæ¨èï¼‰

1. **æ‰“å¼€å‘½ä»¤æç¤ºç¬¦**ï¼Œè¿›å…¥æœåŠ¡å™¨ç›®å½•ï¼š
   ```bash
   cd D:\go\src\hotgo_v2\server
   ```

2. **æ‰§è¡Œä¿®æ­£è„šæœ¬**ï¼š
   ```bash
   fix_invite_codes.bat
   ```

3. **å·¥å…·ä¼šè‡ªåŠ¨ï¼š**
   - æ‰«ææ‰€æœ‰ç”¨æˆ·çš„é‚€è¯·ç 
   - è¯†åˆ«ä¸ç¬¦åˆè§„èŒƒçš„é‚€è¯·ç 
   - ä¸ºè¿™äº›ç”¨æˆ·é‡æ–°ç”Ÿæˆç¬¦åˆè§„èŒƒçš„é‚€è¯·ç 
   - ç¡®ä¿æ–°é‚€è¯·ç ä¸é‡å¤
   - æ›´æ–°æ•°æ®åº“
   - è¾“å‡ºä¿®æ­£æ¸…å•

### æ–¹æ³•2ï¼šä½¿ç”¨SQLè„šæœ¬ï¼ˆæŸ¥è¯¢ï¼‰

1. **æ‰“å¼€æ•°æ®åº“ç®¡ç†å·¥å…·**ï¼ˆå¦‚Navicatã€phpMyAdminï¼‰

2. **æ‰§è¡ŒæŸ¥è¯¢è„šæœ¬**ï¼š
   ```bash
   æ‰“å¼€ fix_invite_codes.sql
   æ‰§è¡Œå…¶ä¸­çš„æŸ¥è¯¢è¯­å¥
   ```

3. **æŸ¥çœ‹ç»“æœï¼š**
   - æŸ¥çœ‹å“ªäº›ç”¨æˆ·çš„é‚€è¯·ç éœ€è¦ä¿®æ­£
   - ç»Ÿè®¡éœ€è¦ä¿®æ­£çš„æ•°é‡
   - éªŒè¯ä¿®æ­£åçš„ç»“æœ

## ğŸ“Š æ‰§è¡Œç»“æœç¤ºä¾‹

```
===== å¼€å§‹ä¿®æ­£æ°¸ä¹…é‚€è¯·ç  =====
æ­£åœ¨æŸ¥æ‰¾ä¸ç¬¦åˆè§„èŒƒçš„é‚€è¯·ç ...
âœ… å·²ä¿®æ­£ - ç”¨æˆ·: dong (ID: 123), åŸé‚€è¯·ç : 3krWX8gIBPJy -> æ–°é‚€è¯·ç : ABCD1235

===== ä¿®æ­£å®Œæˆ =====
æ€»ç”¨æˆ·æ•°: 100
éœ€è¦ä¿®æ­£: 1
ä¿®æ­£æˆåŠŸ: 1
ä¿®æ­£å¤±è´¥: 0

===== ä¿®æ­£æ¸…å• =====
ç”¨æˆ·: dong (ID: 123)
  åŸé‚€è¯·ç : 3krWX8gIBPJy
  æ–°é‚€è¯·ç : ABCD1235

===== å¤„ç†å®Œæ¯• =====
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ‰§è¡Œå‰å¤‡ä»½**ï¼šå»ºè®®å…ˆå¤‡ä»½ `hg_admin_member` è¡¨çš„é‚€è¯·ç æ•°æ®

2. **é€šçŸ¥ç”¨æˆ·**ï¼šä¿®æ­£åï¼Œéœ€è¦é€šçŸ¥ç›¸å…³ç”¨æˆ·æ–°çš„é‚€è¯·ç 

3. **æµ‹è¯•ç¯å¢ƒ**ï¼šå»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒæ‰§è¡Œï¼Œç¡®è®¤æ— è¯¯åå†åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œ

4. **é‚€è¯·å…³ç³»**ï¼šä¿®æ­£é‚€è¯·ç ä¸ä¼šå½±å“å·²æœ‰çš„é‚€è¯·å…³ç³»ï¼ˆé€šè¿‡ `toogo_user.inviter_id` ç»´æŠ¤ï¼‰

5. **åŠ¨æ€é‚€è¯·ç **ï¼šæ­¤å·¥å…·åªä¿®æ­£æ°¸ä¹…é‚€è¯·ç ï¼ˆ`admin_member.invite_code`ï¼‰ï¼Œä¸å½±å“åŠ¨æ€é‚€è¯·ç ï¼ˆ`toogo_user.invite_code`ï¼‰

## ğŸ” éªŒè¯æ–¹æ³•

### 1. æŸ¥çœ‹ç”¨æˆ·é‚€è¯·ç 
```sql
SELECT id, username, invite_code 
FROM hg_admin_member 
WHERE username = 'dong';
```

### 2. éªŒè¯æ ¼å¼è§„èŒƒ
```sql
SELECT 
    id,
    username,
    invite_code,
    CASE 
        WHEN LENGTH(invite_code) = 8 
            AND SUBSTRING(invite_code, 1, 4) REGEXP '^[A-Z]{4}$'
            AND SUBSTRING(invite_code, 5, 4) REGEXP '^[0-9]{4}$'
            AND invite_code NOT LIKE '%4%'
        THEN 'âœ… ç¬¦åˆè§„èŒƒ'
        ELSE 'âŒ ä¸ç¬¦åˆè§„èŒƒ'
    END as status
FROM hg_admin_member 
WHERE invite_code IS NOT NULL;
```

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `cmd/fix_invite_codes/main.go` - ä¿®æ­£å·¥å…·æºä»£ç 
- `fix_invite_codes.bat` - Windowsæ‰§è¡Œè„šæœ¬
- `fix_invite_codes.sql` - SQLæŸ¥è¯¢è„šæœ¬
- `FIX_INVITE_CODES.md` - æœ¬è¯´æ˜æ–‡æ¡£

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### é‚€è¯·ç ç”Ÿæˆé€»è¾‘

```go
func generatePermanentInviteCode() string {
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    const digits = "012356789" // ä¸å«4
    
    // ç”Ÿæˆ4ä½å­—æ¯
    letter1 := letters[rand(0, 25)]
    letter2 := letters[rand(0, 25)]
    letter3 := letters[rand(0, 25)]
    letter4 := letters[rand(0, 25)]
    
    // ç”Ÿæˆ4ä½æ•°å­—ï¼ˆä¸å«4ï¼‰
    digit1 := digits[rand(0, 8)]
    digit2 := digits[rand(0, 8)]
    digit3 := digits[rand(0, 8)]
    digit4 := digits[rand(0, 8)]
    
    return string([]byte{letter1, letter2, letter3, letter4, digit1, digit2, digit3, digit4})
}
```

### æ ¼å¼éªŒè¯é€»è¾‘

```go
func isValidInviteCode(code string) bool {
    if len(code) != 8 {
        return false
    }
    
    // æ£€æŸ¥å‰4ä½æ˜¯å¦éƒ½æ˜¯å¤§å†™å­—æ¯
    for i := 0; i < 4; i++ {
        if code[i] < 'A' || code[i] > 'Z' {
            return false
        }
    }
    
    // æ£€æŸ¥å4ä½æ˜¯å¦éƒ½æ˜¯æ•°å­—ä¸”ä¸å«4
    validDigits := "012356789"
    for i := 4; i < 8; i++ {
        if !strings.Contains(validDigits, string(code[i])) {
            return false
        }
    }
    
    return true
}
```

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒå›¢é˜Ÿã€‚

