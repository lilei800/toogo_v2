# è®¢å•è·å–æµç¨‹æ¶æ„å›¾ï¼ˆç®€åŒ–ç‰ˆï¼‰

## ğŸ¯ æ ¸å¿ƒæ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         HotGo V2 è®¢å•ç³»ç»Ÿ                        â”‚
â”‚                    å¤šå±‚ç¼“å­˜ + æ™ºèƒ½åŒæ­¥æ¶æ„                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            ã€å‰ç«¯è¯·æ±‚ã€‘è®¢å•å†å²åˆ—è¡¨
                      â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  APIå±‚: wallet.OrderHistoryList()  â”‚
    â”‚  - æŸ¥è¯¢æ•°æ®åº“ï¼ˆ10mså“åº”ï¼‰            â”‚
    â”‚  - æ™ºèƒ½åˆ¤æ–­æ˜¯å¦éœ€è¦å¢å¼º              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â”€â†’ ã€è€è®¢å•/å®Œæ•´æ•°æ®ã€‘ç›´æ¥è¿”å› âœ…
               â”‚
               â””â”€â”€â†’ ã€è¿‘14å¤©+ç¼ºå¤±å­—æ®µã€‘å¢å¼ºæ•°æ® â†“
                     
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    orderHistoryTradeCache           â”‚
    â”‚    TTL: 5åˆ†é’Ÿ                        â”‚
    â”‚    å‘½ä¸­ç‡: 80%+                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ç¼“å­˜æœªå‘½ä¸­ â†“
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  å¼•æ“ç¼“å­˜: RobotEngine              â”‚
    â”‚  OrderHistory []*Order              â”‚
    â”‚  TTL: 120ç§’                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ç¼“å­˜è¿‡æœŸ â†“
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  äº¤æ˜“æ‰€API: GetTradeHistory()       â”‚
    â”‚  Binance/Bitget/OKX/Gate            â”‚
    â”‚  é™æµä¿æŠ¤ + é™çº§ç­–ç•¥                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ•°æ®åŒæ­¥åŒé€šé“

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ã€å®æ—¶é€šé“ã€‘WebSocketæ¨é€                     â”‚
â”‚  äº¤æ˜“æ‰€ WebSocket â†’ PrivateEvent â†’ äº‹å®è¡¨                 â”‚
â”‚  å»¶è¿Ÿ: <100ms                                             â”‚
â”‚  ç”¨é€”: æŒ‚å•åˆ—è¡¨å®æ—¶æ›´æ–°                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          +
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ã€å…œåº•é€šé“ã€‘RESTå®šæœŸåŒæ­¥                      â”‚
â”‚  OrderStatusSyncService (æ¯1ç§’æ‰«æ)                       â”‚
â”‚  â”œâ”€ è·å–è®¢å•å†å² (120ç§’èŠ‚æµ)                              â”‚
â”‚  â”œâ”€ åŒæ­¥åˆ°æ•°æ®åº“ SyncOrderHistoryToDB()                   â”‚
â”‚  â”œâ”€ æŒä»“çŠ¶æ€å¯¹è´¦ syncPositionsWithCache()                 â”‚
â”‚  â””â”€ è¡¥å…¨è®¢å•å­—æ®µ syncLocalOrders()                        â”‚
â”‚                                                            â”‚
â”‚  åŠŸèƒ½:                                                     â”‚
â”‚  âœ… æ£€æµ‹æ‰‹åŠ¨å¹³ä»“                                           â”‚
â”‚  âœ… æ£€æµ‹å¤–éƒ¨æŒä»“                                           â”‚
â”‚  âœ… æ›´æ–°æœªå®ç°ç›ˆäº                                         â”‚
â”‚  âœ… è¡¥å…¨è®¢å•å­—æ®µï¼ˆä»·æ ¼/æ•°é‡/æ—¶é—´ç­‰ï¼‰                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ è®¢å•åŒæ­¥æµç¨‹ï¼ˆè¯¦ç»†ï¼‰

```
ã€OrderStatusSyncServiceã€‘æ¯ç§’æ‰§è¡Œ

1ï¸âƒ£ æ‰«ææ‰€æœ‰è¿è¡Œä¸­æœºå™¨äºº
   â†“
2ï¸âƒ£ æ£€æŸ¥å¼•æ“ç¼“å­˜æ—¶é—´
   â”œâ”€ 120ç§’å†… â†’ ä½¿ç”¨ç¼“å­˜ âœ…
   â””â”€ è¶…è¿‡120ç§’ â†’ è°ƒç”¨API â†“
   
3ï¸âƒ£ engine.GetOrderHistorySmart()
   â”œâ”€ è°ƒç”¨äº¤æ˜“æ‰€ GetOrderHistory(symbol, 50)
   â””â”€ æ›´æ–°å¼•æ“ç¼“å­˜ (OrderHistory, LastOrderHistoryUpdate)
   
4ï¸âƒ£ SyncOrderHistoryToDB()
   éå†è®¢å•åˆ—è¡¨:
   â”œâ”€ å·²å­˜åœ¨? â†’ UPDATE (è¡¥å…¨ä»·æ ¼/æ•°é‡/çŠ¶æ€)
   â””â”€ ä¸å­˜åœ¨? â†’ INSERT (åˆ›å»ºæ–°è®¢å•è®°å½•)
   
5ï¸âƒ£ syncPositionsWithCache() - æŒä»“å¯¹è´¦
   A. æ£€æµ‹æ‰‹åŠ¨å¹³ä»“:
      æœ¬åœ°OPEN + äº¤æ˜“æ‰€æ— æŒä»“ â†’ æ›´æ–°ä¸ºCLOSED
      â””â”€ ä»TradeHistoryæ¨æ–­å¹³ä»“ä¿¡æ¯
   
   B. æ£€æµ‹å¤–éƒ¨æŒä»“:
      äº¤æ˜“æ‰€æœ‰æŒä»“ + æœ¬åœ°æ— è®¢å• â†’ åˆ›å»ºè¡¥å•
   
   C. æ›´æ–°æœªå®ç°ç›ˆäº:
      æŒä»“ä¸­è®¢å• â†’ åŒæ­¥ unrealized_profit
   
6ï¸âƒ£ syncLocalOrders() - å­—æ®µè¡¥å…¨
   åŒ¹é…äº¤æ˜“æ‰€è®¢å•:
   â”œâ”€ è¡¥å…¨ open_price (å¼€ä»“ä»·æ ¼)
   â”œâ”€ è¡¥å…¨ quantity (æˆäº¤æ•°é‡)
   â”œâ”€ è¡¥å…¨ exchange_order_id
   â””â”€ è¡¥å…¨ open_time (å¼€ä»“æ—¶é—´)
```

---

## ğŸ—‚ï¸ æ ¸å¿ƒæ•°æ®è¡¨å…³ç³»

```
hg_trading_order (è®¢å•ä¸»è¡¨)
â”œâ”€ å­—æ®µ:
â”‚  â”œâ”€ id (ä¸»é”®)
â”‚  â”œâ”€ exchange_order_id (äº¤æ˜“æ‰€è®¢å•ID) ğŸ”‘
â”‚  â”œâ”€ open_price, close_price (ä»·æ ¼)
â”‚  â”œâ”€ quantity (æ•°é‡)
â”‚  â”œâ”€ realized_profit (å·²å®ç°ç›ˆäº)
â”‚  â”œâ”€ status (1=æŒä»“ä¸­, 2=å·²å¹³ä»“, 3=å·²å–æ¶ˆ)
â”‚  â”œâ”€ open_time, close_time (æ—¶é—´)
â”‚  â””â”€ ...
â”‚
â”œâ”€ å…³è”è¡¨:
â”‚  â”œâ”€ hg_trading_trade_fill (æˆäº¤æµæ°´)
â”‚  â”‚  â””â”€ ç”¨é€”: ç²¾ç¡®çš„ç›ˆäº/æ‰‹ç»­è´¹æ•°æ®
â”‚  â”‚
â”‚  â”œâ”€ hg_trading_order_status_history (çŠ¶æ€å†å²)
â”‚  â”‚  â””â”€ ç”¨é€”: å®¡è®¡è¿½è¸ª
â”‚  â”‚
â”‚  â””â”€ hg_trading_exchange_order (äº¤æ˜“æ‰€äº‹å®è¡¨)
â”‚     â””â”€ ç”¨é€”: å‰ç«¯æŒ‚å•åˆ—è¡¨
â”‚
â””â”€ æ ¸å¿ƒç´¢å¼•:
   â”œâ”€ idx_user_status_closetime (ç”¨æˆ·+çŠ¶æ€+å¹³ä»“æ—¶é—´)
   â”œâ”€ idx_robot_status (æœºå™¨äºº+çŠ¶æ€)
   â””â”€ idx_exchange_order_id (äº¤æ˜“æ‰€è®¢å•ID)
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–å…³é”®ç‚¹

### 1ï¸âƒ£ å¤šå±‚ç¼“å­˜å‡å°‘APIè°ƒç”¨

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|--------|--------|--------|------|
| APIè°ƒç”¨é¢‘ç‡ | æ¯æ¬¡è¯·æ±‚ | 120ç§’/æ¬¡ | **å‡å°‘95%** |
| TradeHistoryè°ƒç”¨ | 100%è®¢å• | 10-20%è®¢å• | **å‡å°‘80-90%** |
| æŸ¥è¯¢å“åº”æ—¶é—´ | 200ms | 10ms | **20å€** |
| å¹¶å‘æ”¯æŒ | 10 QPS | 100+ QPS | **10å€+** |

### 2ï¸âƒ£ æ™ºèƒ½æ•°æ®å¢å¼ºç­–ç•¥

```go
åªå¯¹æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„è®¢å•è°ƒç”¨äº¤æ˜“æ‰€API:

âœ… status == 2 (å·²å¹³ä»“)
âœ… close_time åœ¨14å¤©å†…
âœ… å…³é”®å­—æ®µç¼ºå¤±:
   - realized_profit == 0
   - close_fee == 0
   - close_time æ— æ•ˆ

âŒ è€è®¢å•/å­—æ®µå®Œæ•´ â†’ ç›´æ¥ç”¨æ•°æ®åº“æ•°æ®
```

### 3ï¸âƒ£ ç¼“å­˜å±‚çº§ä¸TTL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¼•æ“ç¼“å­˜ (RobotEngine)                â”‚
â”‚  TTL: 120ç§’                             â”‚
â”‚  ä½œç”¨åŸŸ: å•ä¸ªæœºå™¨äºº                     â”‚
â”‚  æ›´æ–°: å®šæ—¶ + è§¦å‘                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ å‘½ä¸­ç‡ 90%+
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APIç¼“å­˜ (orderHistoryTradeCache)      â”‚
â”‚  TTL: 5åˆ†é’Ÿ                             â”‚
â”‚  ä½œç”¨åŸŸ: apiId + symbol + limit        â”‚
â”‚  æ›´æ–°: é¦–æ¬¡æŸ¥è¯¢æ—¶                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ å‘½ä¸­ç‡ 80%+
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®åº“ (PostgreSQL)                    â”‚
â”‚  æŒä¹…åŒ–å­˜å‚¨                             â”‚
â”‚  ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” è®¢å•çŠ¶æ€æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è®¢å•ç”Ÿå‘½å‘¨æœŸ                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€æ–°è®¢å•åˆ›å»ºã€‘
  â†“
[status=1] æŒä»“ä¸­ (OPEN)
  â”‚
  â”œâ”€ æœªå®ç°ç›ˆäºå®æ—¶æ›´æ–° (unrealized_profit)
  â”‚
  â”œâ”€ æ‰‹åŠ¨å¹³ä»“æ£€æµ‹:
  â”‚  äº¤æ˜“æ‰€æ— æŒä»“ â†’ æŸ¥è¯¢TradeHistory â†’ æ›´æ–°çŠ¶æ€
  â”‚
  â””â”€ æ­£å¸¸å¹³ä»“:
     â”œâ”€ æ­¢ç›ˆæ­¢æŸè§¦å‘
     â”œâ”€ åå‘ä¿¡å·å¹³ä»“
     â””â”€ æ‰‹åŠ¨å¹³ä»“æ“ä½œ
     â†“
[status=2] å·²å¹³ä»“ (CLOSED)
  â”‚
  â””â”€ å­—æ®µè¡¥å…¨:
     â”œâ”€ close_price (å¹³ä»“ä»·æ ¼)
     â”œâ”€ close_time (å¹³ä»“æ—¶é—´)
     â”œâ”€ realized_profit (å·²å®ç°ç›ˆäº)
     â”œâ”€ close_fee (å¹³ä»“æ‰‹ç»­è´¹)
     â””â”€ close_reason (å¹³ä»“åŸå› )

ã€ç‰¹æ®ŠçŠ¶æ€ã€‘
[status=3] å·²å–æ¶ˆ (CANCELED)
[status=4] å¤±è´¥ (FAILED)
```

---

## ğŸ¯ äº¤æ˜“æ‰€æ¥å£å¯¹æ¯”

| äº¤æ˜“æ‰€ | GetOrderHistory æ¥å£ | ç‰¹ç‚¹ | é™åˆ¶ |
|--------|---------------------|------|------|
| **Binance** | `/fapi/v1/allOrders` | âœ… æ”¯æŒå…¨é‡æŸ¥è¯¢<br>âœ… å¯é€‰symbolç­›é€‰ | limitâ‰¤1000 |
| **Bitget** | `/api/v2/mix/order/fills` | âœ… V2 APIæ›´ç¨³å®š<br>âš ï¸ å¿…é¡»æä¾›symbol | limitâ‰¤100 |
| **OKX** | `/api/v5/trade/orders-history` | âœ… æ”¯æŒåˆçº¦ç±»å‹ç­›é€‰<br>âœ… æ”¯æŒå…¨é‡æŸ¥è¯¢ | limitâ‰¤100 |
| **Gate** | `/futures/usdt/orders` | âœ… æ˜ç¡®æŸ¥è¯¢finishedçŠ¶æ€<br>âš ï¸ å¿…é¡»æä¾›contract | æœªæ˜ç¡® |

**ç»Ÿä¸€Orderæ¨¡å‹**:
```go
type Order struct {
    OrderId      string  // äº¤æ˜“æ‰€è®¢å•ID
    ClientId     string  // å®¢æˆ·ç«¯è®¢å•ID
    Symbol       string  // äº¤æ˜“å¯¹
    Side         string  // BUY/SELL
    PositionSide string  // LONG/SHORT
    Type         string  // MARKET/LIMIT/å¼€ä»“/å¹³ä»“
    Price        float64 // å§”æ‰˜ä»·æ ¼
    Quantity     float64 // å§”æ‰˜æ•°é‡
    FilledQty    float64 // å·²æˆäº¤æ•°é‡
    AvgPrice     float64 // æˆäº¤å‡ä»·
    Status       string  // NEW/FILLED/CANCELED
    CreateTime   int64   // åˆ›å»ºæ—¶é—´(æ¯«ç§’)
    UpdateTime   int64   // æ›´æ–°æ—¶é—´(æ¯«ç§’)
}
```

---

## ğŸ›¡ï¸ å®¹é”™ä¸é™çº§ç­–ç•¥

```
ã€APIè°ƒç”¨å¤±è´¥ã€‘
  â†“
æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
  â”œâ”€ æœ‰ç¼“å­˜ â†’ è¿”å›ç¼“å­˜æ•°æ® (é™çº§) âœ…
  â””â”€ æ— ç¼“å­˜ â†’ è¿”å›æ•°æ®åº“æ•°æ® (é™çº§) âœ…

ã€æ•°æ®åº“æŸ¥è¯¢å¤±è´¥ã€‘
  â†“
è¿”å›é”™è¯¯ä¿¡æ¯
å‰ç«¯å±•ç¤ºå‹å¥½æç¤º

ã€WebSocketæ–­è¿ã€‘
  â†“
RESTè½®è¯¢å…œåº• (120ç§’åŒæ­¥)
æœ€å¤§å»¶è¿Ÿ: 120ç§’

ã€äº¤æ˜“æ‰€é™æµã€‘
  â†“
ä½ä¼˜å…ˆçº§è¯·æ±‚ç›´æ¥è·³è¿‡
é«˜ä¼˜å…ˆçº§è¯·æ±‚(ä¸‹å•/å¹³ä»“)ä¼˜å…ˆä¿éšœ
```

---

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡å»ºè®®

```go
// 1. APIè°ƒç”¨ç›‘æ§
exchange_api_calls_total{exchange, method, result}

// 2. ç¼“å­˜å‘½ä¸­ç‡
order_cache_hit_rate{cache_type}

// 3. åŒæ­¥è€—æ—¶
order_sync_duration_seconds{robot_id, result}

// 4. æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
order_query_duration_seconds{query_type}

// 5. è®¢å•çŠ¶æ€åˆ†å¸ƒ
order_status_count{status}
```

---

## ğŸš€ æ ¸å¿ƒæ–‡ä»¶ç´¢å¼•

| åŠŸèƒ½æ¨¡å— | æ–‡ä»¶è·¯å¾„ | æ ¸å¿ƒå‡½æ•° |
|---------|---------|---------|
| **è®¢å•æŸ¥è¯¢API** | `internal/logic/toogo/wallet.go` | `OrderHistoryList()` |
| **æ™ºèƒ½è®¢å•è·å–** | `internal/logic/toogo/robot_engine_order_history_smart.go` | `GetOrderHistorySmart()` |
| **è®¢å•åŒæ­¥åˆ°DB** | `internal/logic/toogo/robot.go` | `SyncOrderHistoryToDB()` |
| **è®¢å•çŠ¶æ€åŒæ­¥** | `internal/logic/toogo/order_status_sync.go` | `syncRobotOrders()`<br>`syncPositionsWithCache()` |
| **WSè®¢å•å­˜å‚¨** | `internal/logic/toogo/exchange_order_store.go` | `UpsertExchangeOrdersFromPrivateEvent()` |
| **å¼•æ“ç¼“å­˜ç®¡ç†** | `internal/logic/toogo/robot_engine.go` | `GetCachedOrderHistory()`<br>`refreshRemoteDataCacheTask()` |
| **äº¤æ˜“æ‰€æ¥å£** | `internal/library/exchange/` | `binance.go`<br>`bitget.go`<br>`okx.go`<br>`gate.go` |

---

## âœ¨ æ€»ç»“

### è®¾è®¡äº®ç‚¹

1. **ä¸‰å±‚ç¼“å­˜æ¶æ„** - å¼•æ“(120s) â†’ API(5min) â†’ æ•°æ®åº“
2. **æ™ºèƒ½APIè°ƒç”¨** - åªå¯¹è¿‘æœŸ+ç¼ºå¤±å­—æ®µçš„è®¢å•è¯·æ±‚äº¤æ˜“æ‰€
3. **åŒé€šé“åŒæ­¥** - WebSocketå®æ—¶ + RESTå…œåº•
4. **è‡ªåŠ¨é™çº§** - APIå¤±è´¥æ—¶å›é€€åˆ°ç¼“å­˜/æ•°æ®åº“
5. **æ€§èƒ½ä¼˜åŒ–** - ç´¢å¼•ä¼˜åŒ– + é™æµä¿æŠ¤ + æ‰¹é‡å¤„ç†

### å…³é”®æ•°æ®

- ğŸš€ **APIè°ƒç”¨å‡å°‘95%**
- âš¡ **æŸ¥è¯¢å“åº”10ms**ï¼ˆä¼˜åŒ–åï¼‰
- ğŸ“Š **ç¼“å­˜å‘½ä¸­ç‡80%+**
- ğŸ’ª **æ”¯æŒ100+ QPS**
- âœ… **æœ€ç»ˆä¸€è‡´æ€§**ï¼ˆæœ€å¤§å»¶è¿Ÿ120ç§’ï¼‰

---

**å¿«é€Ÿå‚è€ƒ**: 
- è¯¦ç»†åˆ†ææŠ¥å‘Š: `è®¢å•è·å–é€»è¾‘å’Œä¸šåŠ¡æµç¨‹åˆ†ææŠ¥å‘Š.md`
- è‡ªåŠ¨äº¤æ˜“æ£€æŸ¥: `è‡ªåŠ¨äº¤æ˜“é€»è¾‘æ£€æŸ¥æŠ¥å‘Š.md`

