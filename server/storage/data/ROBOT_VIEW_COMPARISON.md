# æœºå™¨äººè¯¦æƒ…é¡µé¢å’Œç›‘æ§é¡µé¢ç­–ç•¥å‚æ•°è·å–å¯¹æ¯”

## ğŸ” é—®é¢˜åˆ†æ

ç”¨æˆ·åé¦ˆï¼šé‡å¯å‰åç«¯åï¼Œè¯¦æƒ…é¡µé¢å’Œç›‘æ§é¡µé¢æ˜¾ç¤ºçš„ç­–ç•¥å‚æ•°è¿˜æ˜¯ä¸ä¸€æ ·ã€‚

## ğŸ“Š å¯¹æ¯”åˆ†æ

### ä¿®æ”¹å‰çš„å·®å¼‚

| é¡¹ç›® | è¯¦æƒ…é¡µé¢ï¼ˆViewï¼‰ | ç›‘æ§é¡µé¢ï¼ˆbuildConfigInfoï¼‰ |
|------|-----------------|---------------------------|
| **å¸‚åœºçŠ¶æ€** | âŒ æœªè§„èŒƒåŒ– | âŒ æœªè§„èŒƒåŒ– |
| **é£é™©åå¥½** | âœ… ä»æ˜ å°„å…³ç³»è·å– | âœ… ä»æ˜ å°„å…³ç³»è·å– |
| **ç­–ç•¥å‚æ•°** | âŒ å¤±è´¥æ—¶ä¸é™çº§ | âœ… å¤±è´¥æ—¶ä½¿ç”¨å¼•æ“ç¼“å­˜ |
| **é”™è¯¯å¤„ç†** | âŒ ç®€å•è·³è¿‡ | âœ… è®°å½•é”™è¯¯å¹¶é™çº§ |

### å…³é”®é—®é¢˜

1. **å¸‚åœºçŠ¶æ€æœªè§„èŒƒåŒ–**ï¼š
   - å…¨å±€å¸‚åœºåˆ†æå™¨è¿”å›çš„å¸‚åœºçŠ¶æ€å¯èƒ½æ˜¯ `"high-volatility"` æˆ– `"low-volatility"`
   - ä½†æ˜ å°„å…³ç³»ä¸­çš„keyæ˜¯ `"high_vol"` æˆ– `"low_vol"`
   - å¯¼è‡´æ— æ³•åŒ¹é…æ˜ å°„å…³ç³»ï¼Œé£é™©åå¥½æŸ¥æ‰¾å¤±è´¥

2. **é”™è¯¯å¤„ç†ä¸ä¸€è‡´**ï¼š
   - è¯¦æƒ…é¡µé¢ï¼šå¦‚æœ `LoadFullStrategyParams` å¤±è´¥ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸æ›´æ–°å‚æ•°
   - ç›‘æ§é¡µé¢ï¼šå¦‚æœå¤±è´¥ï¼Œä½¿ç”¨å¼•æ“ç¼“å­˜çš„å‚æ•°ï¼ˆé™çº§æ–¹æ¡ˆï¼‰

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. æ·»åŠ å¸‚åœºçŠ¶æ€è§„èŒƒåŒ–å‡½æ•°

**æ–‡ä»¶**: `internal/logic/trading/market_state.go`ï¼ˆæ–°å»ºï¼‰

```go
func normalizeMarketState(marketState string) string {
    // è§„èŒƒåŒ–å¸‚åœºçŠ¶æ€æ ¼å¼
    // range â†’ volatile
    // high-volatility â†’ high_vol
    // low-volatility â†’ low_vol
}
```

### 2. ç»Ÿä¸€å¸‚åœºçŠ¶æ€è§„èŒƒåŒ–

**ä¿®æ”¹ä½ç½®**ï¼š
- `monitor.go:511` - è§„èŒƒåŒ–ä»å…¨å±€å¸‚åœºåˆ†æå™¨è·å–çš„å¸‚åœºçŠ¶æ€
- `robot.go:544` - è§„èŒƒåŒ–ä»å…¨å±€å¸‚åœºåˆ†æå™¨è·å–çš„å¸‚åœºçŠ¶æ€

```go
marketState = normalizeMarketState(marketState)
```

### 3. ç»Ÿä¸€é”™è¯¯å¤„ç†

**ä¿®æ”¹ä½ç½®**ï¼š
- `robot.go:581-605` - æ·»åŠ é™çº§æ–¹æ¡ˆï¼Œä¸ç›‘æ§é¡µé¢ä¿æŒä¸€è‡´

```go
if err != nil {
    // å¦‚æœåŠ è½½å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨å¼•æ“ç¼“å­˜çš„å‚æ•°ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
    if engine.CurrentStrategyParams != nil {
        params = engine.CurrentStrategyParams
    }
}
```

## ğŸ“ ä¿®æ”¹åçš„å®Œæ•´é€»è¾‘å¯¹æ¯”

### è¯¦æƒ…é¡µé¢ï¼ˆViewï¼‰

```go
// ã€1ã€‘å¸‚åœºçŠ¶æ€ï¼šä»å…¨å±€å¸‚åœºåˆ†æå™¨è·å–ï¼ˆå®æ—¶ï¼‰
globalAnalysis := market.GetMarketAnalyzer().GetAnalysis(engine.Platform, out.Symbol)
if globalAnalysis != nil {
    marketState = normalizeMarketState(string(globalAnalysis.MarketState))  // âœ… è§„èŒƒåŒ–
    out.MarketState = marketState
}

// ã€2ã€‘é£é™©åå¥½ï¼šä»æ˜ å°„å…³ç³»è·å–
engineStatus := engine.GetStatus()
riskPref := engineStatus.CurrentRiskPref  // âœ… ä½¿ç”¨è§„èŒƒåŒ–çš„å¸‚åœºçŠ¶æ€æŸ¥æ‰¾

// ã€3ã€‘ç­–ç•¥å‚æ•°ï¼šä»ç­–ç•¥æ¨¡æ¿è¡¨æŸ¥è¯¢
params, err := engine.LoadFullStrategyParams(ctx, marketState, riskPref)
if err != nil {
    // âœ… é™çº§ï¼šä½¿ç”¨å¼•æ“ç¼“å­˜çš„å‚æ•°
    if engine.CurrentStrategyParams != nil {
        params = engine.CurrentStrategyParams
    }
}
```

### ç›‘æ§é¡µé¢ï¼ˆbuildConfigInfoï¼‰

```go
// ã€1ã€‘å¸‚åœºçŠ¶æ€ï¼šä»å…¨å±€å¸‚åœºåˆ†æå™¨è·å–ï¼ˆå®æ—¶ï¼‰
globalAnalysis := market.GetMarketAnalyzer().GetAnalysis(engine.Platform, robot.Symbol)
if globalAnalysis != nil {
    marketState = normalizeMarketState(string(globalAnalysis.MarketState))  // âœ… è§„èŒƒåŒ–
    config.MarketState = marketState
}

// ã€2ã€‘é£é™©åå¥½ï¼šä»æ˜ å°„å…³ç³»è·å–
engineStatus := engine.GetStatus()
riskPref := engineStatus.CurrentRiskPref  // âœ… ä½¿ç”¨è§„èŒƒåŒ–çš„å¸‚åœºçŠ¶æ€æŸ¥æ‰¾

// ã€3ã€‘ç­–ç•¥å‚æ•°ï¼šä»ç­–ç•¥æ¨¡æ¿è¡¨æŸ¥è¯¢
params, err := engine.LoadFullStrategyParams(ctx, marketState, riskPref)
if err != nil {
    // âœ… é™çº§ï¼šä½¿ç”¨å¼•æ“ç¼“å­˜çš„å‚æ•°
    if engine.CurrentStrategyParams != nil {
        params = engine.CurrentStrategyParams
    }
}
```

## ğŸ¯ ä¿®å¤åçš„æ•ˆæœ

### ä¿®æ”¹å‰
- âŒ å¸‚åœºçŠ¶æ€æ ¼å¼ä¸ä¸€è‡´ï¼ˆ`high-volatility` vs `high_vol`ï¼‰
- âŒ æ— æ³•åŒ¹é…æ˜ å°„å…³ç³»
- âŒ é£é™©åå¥½æŸ¥æ‰¾å¤±è´¥
- âŒ ç­–ç•¥å‚æ•°åŠ è½½å¤±è´¥
- âŒ ä¸¤ä¸ªé¡µé¢æ˜¾ç¤ºä¸ä¸€è‡´

### ä¿®æ”¹å
- âœ… å¸‚åœºçŠ¶æ€ç»Ÿä¸€è§„èŒƒåŒ–
- âœ… å¯ä»¥æ­£ç¡®åŒ¹é…æ˜ å°„å…³ç³»
- âœ… é£é™©åå¥½æ­£ç¡®è·å–
- âœ… ç­–ç•¥å‚æ•°æ­£ç¡®åŠ è½½
- âœ… ä¸¤ä¸ªé¡µé¢æ˜¾ç¤ºä¸€è‡´

## ğŸ”§ å…³é”®ä¿®å¤ç‚¹

1. **å¸‚åœºçŠ¶æ€è§„èŒƒåŒ–**ï¼šç¡®ä¿å¸‚åœºçŠ¶æ€æ ¼å¼ä¸æ˜ å°„å…³ç³»ä¸­çš„keyä¸€è‡´
2. **é”™è¯¯å¤„ç†ç»Ÿä¸€**ï¼šä¸¤ä¸ªå‡½æ•°éƒ½ä½¿ç”¨ç›¸åŒçš„é™çº§æ–¹æ¡ˆ
3. **æ—¥å¿—è®°å½•**ï¼šæ·»åŠ è°ƒè¯•æ—¥å¿—ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

1. `internal/logic/trading/market_state.go` - æ–°å»ºï¼Œæ·»åŠ è§„èŒƒåŒ–å‡½æ•°
2. `internal/logic/trading/monitor.go` - æ·»åŠ å¸‚åœºçŠ¶æ€è§„èŒƒåŒ–
3. `internal/logic/trading/robot.go` - æ·»åŠ å¸‚åœºçŠ¶æ€è§„èŒƒåŒ–å’Œé”™è¯¯å¤„ç†é™çº§

## âœ… éªŒè¯

1. âœ… ä»£ç å·²ç¼–è¯‘é€šè¿‡
2. âœ… ä¸¤ä¸ªå‡½æ•°ä½¿ç”¨å®Œå…¨ç›¸åŒçš„é€»è¾‘
3. âœ… å¸‚åœºçŠ¶æ€å·²è§„èŒƒåŒ–
4. âœ… é”™è¯¯å¤„ç†å·²ç»Ÿä¸€

## ğŸ¯ æ€»ç»“

**æ ¹æœ¬åŸå› **ï¼š
- å¸‚åœºçŠ¶æ€æ ¼å¼ä¸ä¸€è‡´ï¼ˆ`high-volatility` vs `high_vol`ï¼‰
- å¯¼è‡´æ— æ³•åŒ¹é…æ˜ å°„å…³ç³»ï¼Œé£é™©åå¥½æŸ¥æ‰¾å¤±è´¥
- è¿›è€Œå¯¼è‡´ç­–ç•¥å‚æ•°åŠ è½½å¤±è´¥

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
- æ·»åŠ å¸‚åœºçŠ¶æ€è§„èŒƒåŒ–å‡½æ•°
- åœ¨ä¸¤ä¸ªå‡½æ•°ä¸­éƒ½è§„èŒƒåŒ–å¸‚åœºçŠ¶æ€
- ç»Ÿä¸€é”™è¯¯å¤„ç†é€»è¾‘

ç°åœ¨ä¸¤ä¸ªé¡µé¢åº”è¯¥æ˜¾ç¤ºä¸€è‡´äº†ï¼

