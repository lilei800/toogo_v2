# å®˜æ–¹ç­–ç•¥æ¨¡æ¿ç”Ÿæˆè¯´æ˜

## ğŸ“š å®˜æ–¹ç­–ç•¥æ¨¡æ¿çš„ä¸¤ç§ç”Ÿæˆæ–¹å¼

### æ–¹å¼ä¸€ï¼šé€šè¿‡ SQL æ–‡ä»¶ç›´æ¥å¯¼å…¥ï¼ˆæ¨èï¼‰

#### ğŸ“ ç›¸å…³æ–‡ä»¶

1. **`official_btc_usdt_v5.sql`** - å®˜æ–¹ç­–ç•¥ V5.0 å®Œæ•´ç‰ˆ
   - åŒ…å«ç­–ç•¥ç»„ + 12ç§ç­–ç•¥æ¨¡æ¿
   - åŒ…å«è¯¦ç»†çš„ config_json é…ç½®
   - é€‚åˆï¼šç”Ÿäº§ç¯å¢ƒåˆå§‹åŒ–

2. **`official_btc_usdt_v5_simple.sql`** - å®˜æ–¹ç­–ç•¥ V5.0 ç®€åŒ–ç‰ˆ
   - åªæœ‰åŸºæœ¬å‚æ•°ï¼Œconfig_json ä¸ºç©º
   - é€‚åˆï¼šæµ‹è¯•ç¯å¢ƒæˆ–å¿«é€Ÿéƒ¨ç½²

3. **`official_btc_usdt_v2_strategies.sql`** - æ—§ç‰ˆæœ¬ç­–ç•¥
   - V2.0 ç‰ˆæœ¬çš„ç­–ç•¥æ¨¡æ¿
   - ä¿ç•™ç”¨äºå…¼å®¹æ€§

#### ğŸš€ å¯¼å…¥æ­¥éª¤

```bash
# è¿›å…¥SQLæ–‡ä»¶ç›®å½•
cd D:\go\src\hotgo_v2\server\storage\data

# å¯¼å…¥å®˜æ–¹ç­–ç•¥ V5.0
mysql -h 127.0.0.1 -P 3306 -u root -proot hotgo < official_btc_usdt_v5.sql

# æˆ–è€…ç®€åŒ–ç‰ˆ
mysql -h 127.0.0.1 -P 3306 -u root -proot hotgo < official_btc_usdt_v5_simple.sql
```

#### ğŸ“Š SQLæ–‡ä»¶ç»“æ„

```sql
-- 1. æ¸…ç†æ—§æ•°æ®
DELETE FROM `hg_trading_strategy_template` WHERE `group_id` IN (...);
DELETE FROM `hg_trading_strategy_group` WHERE `group_key` = 'official_btc_usdt_v5';

-- 2. æ’å…¥å®˜æ–¹ç­–ç•¥ç»„
INSERT INTO `hg_trading_strategy_group` (...) VALUES (
  'ğŸ”¥ BTC-USDT å®˜æ–¹ç­–ç•¥ V5.0',
  'official_btc_usdt_v5',
  'bitget',
  'BTCUSDT',
  ...
);

SET @group_id = LAST_INSERT_ID();

-- 3. æ’å…¥12ç§ç­–ç•¥æ¨¡æ¿
-- ã€ä¿å®ˆå‹ - 4ç§ã€‘
INSERT INTO `hg_trading_strategy_template` (...) VALUES (
  @group_id, 'v5_conservative_trend', 'ğŸ›¡ï¸ ä¿å®ˆ-è¶‹åŠ¿è·Ÿè¸ª',
  'conservative', 'trend', ...
);
-- ã€å¹³è¡¡å‹ - 4ç§ã€‘
INSERT INTO `hg_trading_strategy_template` (...) VALUES (
  @group_id, 'v5_balanced_trend', 'âš–ï¸ å¹³è¡¡-è¶‹åŠ¿è·Ÿè¸ª â­æ¨è',
  'balanced', 'trend', ...
);
-- ã€æ¿€è¿›å‹ - 4ç§ã€‘
INSERT INTO `hg_trading_strategy_template` (...) VALUES (
  @group_id, 'v5_aggressive_trend', 'ğŸš€ æ¿€è¿›-è¶‹åŠ¿è¿½è¸ª',
  'aggressive', 'trend', ...
);
```

---

### æ–¹å¼äºŒï¼šé€šè¿‡åç«¯ä»£ç åŠ¨æ€ç”Ÿæˆ

#### ğŸ“‚ ç›¸å…³ä»£ç 

**æ–‡ä»¶**: `server/internal/logic/toogo/strategy_group.go`

**æ–¹æ³•**: `StrategyGroupService.Init()`

#### ğŸ”§ åŠŸèƒ½è¯´æ˜

```go
// Init åˆå§‹åŒ–12ç§ç­–ç•¥
func (s *StrategyGroupService) Init(ctx context.Context, in *toogoin.StrategyGroupInitInp) error {
    // 1. è·å–ç­–ç•¥ç»„ä¿¡æ¯
    var group entity.TradingStrategyGroup
    err := g.DB().Model("hg_trading_strategy_group").Where("id", in.GroupId).Scan(&group)
    
    // 2. å®šä¹‰å¸‚åœºçŠ¶æ€å’Œé£é™©åå¥½çŸ©é˜µ
    marketStates := []struct{
        Key  string
        Name string
        Window int
        Threshold float64
    }{
        {Key: "trend", Name: "è¶‹åŠ¿", Window: 240, Threshold: 100.00},
        {Key: "range", Name: "éœ‡è¡", Window: 180, Threshold: 50.00},
        {Key: "high_vol", Name: "é«˜æ³¢åŠ¨", Window: 120, Threshold: 150.00},
        {Key: "low_vol", Name: "ä½æ³¢åŠ¨", Window: 600, Threshold: 30.00},
    }
    
    riskPreferences := []struct{
        Key  string
        Name string
        LeverageMin/Max int
        MarginMin/Max float64
        StopLoss float64
        ProfitRetreat float64
    }{
        {Key: "conservative", Name: "ä¿å®ˆ", ...},
        {Key: "balanced", Name: "å¹³è¡¡", ...},
        {Key: "aggressive", Name: "æ¿€è¿›", ...},
    }
    
    // 3. å¾ªç¯ç”Ÿæˆ 4Ã—3=12 ç§ç­–ç•¥
    for _, market := range marketStates {
        for _, risk := range riskPreferences {
            // æ’å…¥ç­–ç•¥æ¨¡æ¿
            INSERT INTO hg_trading_strategy_template ...
        }
    }
}
```

#### ğŸŒ å‰ç«¯è°ƒç”¨

**æ–‡ä»¶**: `web/src/views/toogo/strategy/group.vue`

**åŠŸèƒ½**: "æ‰¹é‡åˆå§‹åŒ–"æŒ‰é’®

```typescript
// æ‰“å¼€åˆå§‹åŒ–å¼¹çª—
function openInitModal(row: any) {
  initGroup.value = row;
  initOptions.value.useDefault = true;
  showInitModal.value = true;
}

// æ‰§è¡Œåˆå§‹åŒ–
async function handleInitStrategies() {
  try {
    await http.request({
      url: '/trading/strategy/group/init',
      method: 'post',
      data: {
        groupId: initGroup.value.id,
        useDefault: initOptions.value.useDefault,
      },
    });
    message.success('ç­–ç•¥åˆå§‹åŒ–æˆåŠŸ');
    loadGroups();
  } catch (error: any) {
    message.error(error.message || 'åˆå§‹åŒ–å¤±è´¥');
  }
}
```

---

## ğŸ¯ 12ç§å®˜æ–¹ç­–ç•¥çŸ©é˜µ

### å¸‚åœºçŠ¶æ€ Ã— é£é™©åå¥½

|  | ğŸ›¡ï¸ ä¿å®ˆå‹ | âš–ï¸ å¹³è¡¡å‹ | ğŸš€ æ¿€è¿›å‹ |
|--|---------|---------|---------|
| **ğŸ“ˆ è¶‹åŠ¿å¸‚åœº** | ä½æ æ†é¡ºåŠ¿<br>æ—¥æ”¶ç›Š: 0.5-2% | å¤šå‘¨æœŸç¡®è®¤â­<br>æ—¥æ”¶ç›Š: 1-5% | é«˜æ æ†è¿½è¸ª<br>æ—¥æ”¶ç›Š: 3-10% |
| **ğŸ“Š éœ‡è¡å¸‚åœº** | å¸ƒæ—å¸¦+RSI<br>æ—¥æ”¶ç›Š: 0.5-1.5% | æ”¯æ’‘é˜»åŠ›å¥—åˆ©<br>æ—¥æ”¶ç›Š: 1-3% | åŒå‘é«˜é¢‘<br>æ—¥æ”¶ç›Š: 2-8% |
| **âš¡ é«˜æ³¢åŠ¨** | æœ€å°ä»“ä½é˜²å®ˆ<br>æ—¥æ”¶ç›Š: 1-3% | å¿«è¿›å¿«å‡º<br>æ—¥æ”¶ç›Š: 2-6% | åŒå‘æ•æ‰<br>æ—¥æ”¶ç›Š: 5-15% |
| **ğŸ˜´ ä½æ³¢åŠ¨** | ç­‰å¾…çªç ´è“„åŠ›<br>æ—¥æ”¶ç›Š: 0.3-1% | é‡‘å­—å¡”åŠ ä»“<br>æ—¥æ”¶ç›Š: 0.5-2% | çªç ´è¿½å•<br>æ—¥æ”¶ç›Š: 1-5% |

---

## ğŸ“‹ ç­–ç•¥æ¨¡æ¿æ•°æ®ç»“æ„

### ç­–ç•¥ç»„è¡¨ (hg_trading_strategy_group)

```sql
CREATE TABLE `hg_trading_strategy_group` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `group_name` varchar(100) NOT NULL COMMENT 'ç­–ç•¥ç»„åç§°',
  `group_key` varchar(100) NOT NULL COMMENT 'ç­–ç•¥ç»„KEY',
  `exchange` varchar(50) DEFAULT NULL COMMENT 'äº¤æ˜“æ‰€',
  `symbol` varchar(50) DEFAULT NULL COMMENT 'äº¤æ˜“å¯¹',
  `order_type` varchar(20) DEFAULT 'market' COMMENT 'ä¸‹å•ç±»å‹',
  `margin_mode` varchar(20) DEFAULT 'isolated' COMMENT 'ä¿è¯é‡‘æ¨¡å¼',
  `is_official` tinyint(1) DEFAULT '0' COMMENT 'æ˜¯å¦å®˜æ–¹',
  `user_id` bigint(20) DEFAULT '0' COMMENT 'ç”¨æˆ·ID',
  `description` text COMMENT 'æè¿°',
  `is_active` tinyint(1) DEFAULT '1' COMMENT 'æ˜¯å¦æ¿€æ´»',
  `sort` int(11) DEFAULT '0' COMMENT 'æ’åº',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_group_key` (`group_key`)
);
```

### ç­–ç•¥æ¨¡æ¿è¡¨ (hg_trading_strategy_template)

```sql
CREATE TABLE `hg_trading_strategy_template` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `group_id` bigint(20) NOT NULL COMMENT 'ç­–ç•¥ç»„ID',
  `strategy_key` varchar(100) NOT NULL COMMENT 'ç­–ç•¥KEY',
  `strategy_name` varchar(100) NOT NULL COMMENT 'ç­–ç•¥åç§°',
  `risk_preference` varchar(20) NOT NULL COMMENT 'é£é™©åå¥½',
  `market_state` varchar(20) NOT NULL COMMENT 'å¸‚åœºçŠ¶æ€',
  `monitor_window` int(11) DEFAULT '60' COMMENT 'ç›‘æ§çª—å£(ç§’)',
  `volatility_threshold` decimal(10,2) DEFAULT NULL COMMENT 'æ³¢åŠ¨é˜ˆå€¼',
  `leverage_min` int(11) DEFAULT '1' COMMENT 'æ æ†æœ€å°å€¼',
  `leverage_max` int(11) DEFAULT '10' COMMENT 'æ æ†æœ€å¤§å€¼',
  `margin_percent_min` decimal(5,2) DEFAULT NULL COMMENT 'ä¿è¯é‡‘%æœ€å°',
  `margin_percent_max` decimal(5,2) DEFAULT NULL COMMENT 'ä¿è¯é‡‘%æœ€å¤§',
  `stop_loss_percent` decimal(5,2) DEFAULT NULL COMMENT 'æ­¢æŸ%',
  `profit_retreat_percent` decimal(5,2) DEFAULT NULL COMMENT 'æ­¢ç›ˆå›æ’¤%',
  `auto_start_retreat_percent` decimal(5,2) DEFAULT NULL COMMENT 'å¯åŠ¨å›æ’¤%',
  `config_json` text COMMENT 'æ‰©å±•é…ç½®JSON',
  `description` text COMMENT 'æè¿°',
  `is_active` tinyint(1) DEFAULT '1' COMMENT 'æ˜¯å¦æ¿€æ´»',
  `sort` int(11) DEFAULT '0' COMMENT 'æ’åº',
  PRIMARY KEY (`id`),
  KEY `idx_group_id` (`group_id`),
  KEY `idx_risk_market` (`risk_preference`,`market_state`)
);
```

---

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### é‡ç½®å®˜æ–¹ç­–ç•¥

```bash
# ä½¿ç”¨é‡ç½®è„šæœ¬
mysql -h 127.0.0.1 -P 3306 -u root -proot hotgo < reset_official_strategies.sql

# ç„¶åé‡æ–°å¯¼å…¥
mysql -h 127.0.0.1 -P 3306 -u root -proot hotgo < official_btc_usdt_v5.sql
```

### æŸ¥çœ‹å½“å‰å®˜æ–¹ç­–ç•¥

```sql
-- æŸ¥çœ‹å®˜æ–¹ç­–ç•¥ç»„
SELECT * FROM hg_trading_strategy_group WHERE is_official = 1;

-- æŸ¥çœ‹æŸä¸ªç»„çš„ç­–ç•¥è¯¦æƒ…
SELECT 
    strategy_name,
    risk_preference,
    market_state,
    leverage_min,
    leverage_max,
    stop_loss_percent
FROM hg_trading_strategy_template 
WHERE group_id = (
    SELECT id FROM hg_trading_strategy_group 
    WHERE group_key = 'official_btc_usdt_v5'
)
ORDER BY sort;
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **åˆæ¬¡éƒ¨ç½²**: ä½¿ç”¨ `official_btc_usdt_v5.sql` å®Œæ•´ç‰ˆ
2. **æµ‹è¯•ç¯å¢ƒ**: ä½¿ç”¨ `official_btc_usdt_v5_simple.sql` ç®€åŒ–ç‰ˆ
3. **ç”¨æˆ·è‡ªå®šä¹‰**: é€šè¿‡å‰ç«¯"æ‰¹é‡åˆå§‹åŒ–"åŠŸèƒ½ï¼ˆè°ƒç”¨åç«¯ `Init` æ–¹æ³•ï¼‰
4. **ç‰ˆæœ¬å‡çº§**: å…ˆæ‰§è¡Œ `reset_official_strategies.sql` æ¸…ç†ï¼Œå†å¯¼å…¥æ–°ç‰ˆæœ¬

---

**æ€»ç»“**: å®˜æ–¹ç­–ç•¥æ¨¡æ¿ä¸»è¦é€šè¿‡ SQL æ–‡ä»¶é¢„å…ˆå®šä¹‰å¥½ï¼ŒåŒ…å«å®Œæ•´çš„12ç§ç­–ç•¥é…ç½®ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡å‰ç«¯ç•Œé¢è°ƒç”¨åç«¯æ¥å£åŠ¨æ€ç”Ÿæˆè‡ªå·±çš„ç­–ç•¥ç»„ã€‚

