# å®šæ—¶å¼€å…³å€’è®¡æ—¶æ˜¾ç¤ºå®ç°æŒ‡å—

## ğŸ“‹ éœ€æ±‚è¯´æ˜

åœ¨æœºå™¨äººåˆ—è¡¨é¢æ¿ä¸­ï¼š
- **å¯åŠ¨æŒ‰é’®å** - æ˜¾ç¤ºå®šæ—¶å¼€å¯çš„å€’è®¡æ—¶
- **åœæ­¢æŒ‰é’®å** - æ˜¾ç¤ºå®šæ—¶å…³é—­çš„å€’è®¡æ—¶

---

## âœ… åç«¯æ•°æ®å‡†å¤‡

### å·²æœ‰å­—æ®µ

åç«¯ `TradingRobot` å®ä½“å·²åŒ…å«å®šæ—¶å­—æ®µï¼š

```go
type TradingRobot struct {
    // ... å…¶ä»–å­—æ®µ
    ScheduleStart *gtime.Time `json:"scheduleStart"` // å®šæ—¶å¯åŠ¨æ—¶é—´
    ScheduleStop  *gtime.Time `json:"scheduleStop"`  // å®šæ—¶åœæ­¢æ—¶é—´
    // ... å…¶ä»–å­—æ®µ
}
```

### APIè¿”å›æ•°æ®

æœºå™¨äººåˆ—è¡¨æ¥å£å·²è¿”å›è¿™äº›å­—æ®µï¼š

```json
{
    "id": 1,
    "robotName": "æµ‹è¯•æœºå™¨äºº",
    "status": 1,
    "scheduleStart": "2025-12-24 10:00:00",
    "scheduleStop": "2025-12-24 18:00:00",
    // ... å…¶ä»–å­—æ®µ
}
```

---

## ğŸ¨ å‰ç«¯å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: Vue3 + Element Plus (æ¨è)

#### 1. åˆ›å»ºå€’è®¡æ—¶ç»„ä»¶

```vue
<template>
  <div class="countdown-wrapper">
    <!-- å¯åŠ¨æŒ‰é’® + å®šæ—¶å¼€å¯å€’è®¡æ—¶ -->
    <div class="action-group">
      <el-button 
        type="primary" 
        size="small"
        @click="handleStart"
        :disabled="robot.status === 2">
        å¯åŠ¨è¿è¡Œ
      </el-button>
      <span v-if="startCountdown" class="countdown-text">
        <el-icon><Clock /></el-icon>
        {{ startCountdown }}åè‡ªåŠ¨å¯åŠ¨
      </span>
    </div>

    <!-- åœæ­¢æŒ‰é’® + å®šæ—¶å…³é—­å€’è®¡æ—¶ -->
    <div class="action-group">
      <el-button 
        type="danger" 
        size="small"
        @click="handleStop"
        :disabled="robot.status !== 2">
        åœæ­¢è¿è¡Œ
      </el-button>
      <span v-if="stopCountdown" class="countdown-text warning">
        <el-icon><AlarmClock /></el-icon>
        {{ stopCountdown }}åè‡ªåŠ¨åœæ­¢
      </span>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted, onUnmounted } from 'vue'
import { Clock, AlarmClock } from '@element-plus/icons-vue'

const props = defineProps({
  robot: {
    type: Object,
    required: true
  }
})

// å®šæ—¶å™¨
let timer = null

// å¯åŠ¨å€’è®¡æ—¶æ–‡æœ¬
const startCountdown = ref('')

// åœæ­¢å€’è®¡æ—¶æ–‡æœ¬
const stopCountdown = ref('')

// è®¡ç®—å€’è®¡æ—¶
const calculateCountdown = () => {
  const now = Date.now()
  
  // è®¡ç®—å¯åŠ¨å€’è®¡æ—¶
  if (props.robot.scheduleStart && props.robot.status !== 2) {
    const startTime = new Date(props.robot.scheduleStart).getTime()
    const diff = startTime - now
    
    if (diff > 0) {
      startCountdown.value = formatTime(diff)
    } else {
      startCountdown.value = ''
    }
  } else {
    startCountdown.value = ''
  }
  
  // è®¡ç®—åœæ­¢å€’è®¡æ—¶
  if (props.robot.scheduleStop && props.robot.status === 2) {
    const stopTime = new Date(props.robot.scheduleStop).getTime()
    const diff = stopTime - now
    
    if (diff > 0) {
      stopCountdown.value = formatTime(diff)
    } else {
      stopCountdown.value = ''
    }
  } else {
    stopCountdown.value = ''
  }
}

// æ ¼å¼åŒ–æ—¶é—´
const formatTime = (milliseconds) => {
  const seconds = Math.floor(milliseconds / 1000)
  const minutes = Math.floor(seconds / 60)
  const hours = Math.floor(minutes / 60)
  const days = Math.floor(hours / 24)
  
  if (days > 0) {
    return `${days}å¤©${hours % 24}å°æ—¶`
  } else if (hours > 0) {
    return `${hours}å°æ—¶${minutes % 60}åˆ†é’Ÿ`
  } else if (minutes > 0) {
    return `${minutes}åˆ†é’Ÿ${seconds % 60}ç§’`
  } else {
    return `${seconds}ç§’`
  }
}

// å¯åŠ¨
onMounted(() => {
  calculateCountdown()
  timer = setInterval(calculateCountdown, 1000) // æ¯ç§’æ›´æ–°
})

// æ¸…ç†
onUnmounted(() => {
  if (timer) {
    clearInterval(timer)
  }
})
</script>

<style scoped>
.countdown-wrapper {
  display: flex;
  gap: 16px;
  align-items: center;
}

.action-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

.countdown-text {
  font-size: 12px;
  color: #67C23A;
  display: flex;
  align-items: center;
  gap: 4px;
}

.countdown-text.warning {
  color: #E6A23C;
}
</style>
```

---

### æ–¹æ¡ˆ2: React + Ant Design

```tsx
import React, { useState, useEffect } from 'react';
import { Button, Space, Tag } from 'antd';
import { ClockCircleOutlined, AlertOutlined } from '@ant-design/icons';

interface RobotActionsProps {
  robot: {
    id: number;
    status: number;
    scheduleStart?: string;
    scheduleStop?: string;
  };
  onStart: () => void;
  onStop: () => void;
}

const RobotActions: React.FC<RobotActionsProps> = ({ robot, onStart, onStop }) => {
  const [startCountdown, setStartCountdown] = useState<string>('');
  const [stopCountdown, setStopCountdown] = useState<string>('');

  // æ ¼å¼åŒ–æ—¶é—´
  const formatTime = (milliseconds: number): string => {
    const seconds = Math.floor(milliseconds / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);
    
    if (days > 0) {
      return `${days}å¤©${hours % 24}å°æ—¶`;
    } else if (hours > 0) {
      return `${hours}å°æ—¶${minutes % 60}åˆ†é’Ÿ`;
    } else if (minutes > 0) {
      return `${minutes}åˆ†é’Ÿ${seconds % 60}ç§’`;
    } else {
      return `${seconds}ç§’`;
    }
  };

  // è®¡ç®—å€’è®¡æ—¶
  useEffect(() => {
    const calculateCountdown = () => {
      const now = Date.now();
      
      // è®¡ç®—å¯åŠ¨å€’è®¡æ—¶
      if (robot.scheduleStart && robot.status !== 2) {
        const startTime = new Date(robot.scheduleStart).getTime();
        const diff = startTime - now;
        
        if (diff > 0) {
          setStartCountdown(formatTime(diff));
        } else {
          setStartCountdown('');
        }
      } else {
        setStartCountdown('');
      }
      
      // è®¡ç®—åœæ­¢å€’è®¡æ—¶
      if (robot.scheduleStop && robot.status === 2) {
        const stopTime = new Date(robot.scheduleStop).getTime();
        const diff = stopTime - now;
        
        if (diff > 0) {
          setStopCountdown(formatTime(diff));
        } else {
          setStopCountdown('');
        }
      } else {
        setStopCountdown('');
      }
    };
    
    calculateCountdown();
    const timer = setInterval(calculateCountdown, 1000);
    
    return () => clearInterval(timer);
  }, [robot.scheduleStart, robot.scheduleStop, robot.status]);

  return (
    <Space size="middle">
      {/* å¯åŠ¨æŒ‰é’®ç»„ */}
      <Space>
        <Button 
          type="primary" 
          size="small"
          onClick={onStart}
          disabled={robot.status === 2}>
          å¯åŠ¨è¿è¡Œ
        </Button>
        {startCountdown && (
          <Tag icon={<ClockCircleOutlined />} color="success">
            {startCountdown}åè‡ªåŠ¨å¯åŠ¨
          </Tag>
        )}
      </Space>

      {/* åœæ­¢æŒ‰é’®ç»„ */}
      <Space>
        <Button 
          danger 
          size="small"
          onClick={onStop}
          disabled={robot.status !== 2}>
          åœæ­¢è¿è¡Œ
        </Button>
        {stopCountdown && (
          <Tag icon={<AlertOutlined />} color="warning">
            {stopCountdown}åè‡ªåŠ¨åœæ­¢
          </Tag>
        )}
      </Space>
    </Space>
  );
};

export default RobotActions;
```

---

### æ–¹æ¡ˆ3: åŸç”Ÿ JavaScript

```javascript
class RobotCountdown {
  constructor(containerId, robot) {
    this.container = document.getElementById(containerId);
    this.robot = robot;
    this.timer = null;
    this.init();
  }

  init() {
    this.render();
    this.startTimer();
  }

  calculateCountdown() {
    const now = Date.now();
    let html = '';

    // å¯åŠ¨æŒ‰é’®
    const startDisabled = this.robot.status === 2 ? 'disabled' : '';
    html += `
      <div class="action-group">
        <button class="btn btn-primary" ${startDisabled}>å¯åŠ¨è¿è¡Œ</button>
    `;

    // å¯åŠ¨å€’è®¡æ—¶
    if (this.robot.scheduleStart && this.robot.status !== 2) {
      const startTime = new Date(this.robot.scheduleStart).getTime();
      const diff = startTime - now;
      
      if (diff > 0) {
        const countdown = this.formatTime(diff);
        html += `<span class="countdown success">â° ${countdown}åè‡ªåŠ¨å¯åŠ¨</span>`;
      }
    }
    html += '</div>';

    // åœæ­¢æŒ‰é’®
    const stopDisabled = this.robot.status !== 2 ? 'disabled' : '';
    html += `
      <div class="action-group">
        <button class="btn btn-danger" ${stopDisabled}>åœæ­¢è¿è¡Œ</button>
    `;

    // åœæ­¢å€’è®¡æ—¶
    if (this.robot.scheduleStop && this.robot.status === 2) {
      const stopTime = new Date(this.robot.scheduleStop).getTime();
      const diff = stopTime - now;
      
      if (diff > 0) {
        const countdown = this.formatTime(diff);
        html += `<span class="countdown warning">âš ï¸ ${countdown}åè‡ªåŠ¨åœæ­¢</span>`;
      }
    }
    html += '</div>';

    this.container.innerHTML = html;
  }

  formatTime(milliseconds) {
    const seconds = Math.floor(milliseconds / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);
    
    if (days > 0) {
      return `${days}å¤©${hours % 24}å°æ—¶`;
    } else if (hours > 0) {
      return `${hours}å°æ—¶${minutes % 60}åˆ†é’Ÿ`;
    } else if (minutes > 0) {
      return `${minutes}åˆ†é’Ÿ${seconds % 60}ç§’`;
    } else {
      return `${seconds}ç§’`;
    }
  }

  render() {
    this.calculateCountdown();
  }

  startTimer() {
    this.timer = setInterval(() => {
      this.calculateCountdown();
    }, 1000);
  }

  destroy() {
    if (this.timer) {
      clearInterval(this.timer);
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const countdown = new RobotCountdown('robot-actions', {
  id: 1,
  status: 1,
  scheduleStart: '2025-12-24 10:00:00',
  scheduleStop: '2025-12-24 18:00:00'
});
```

---

## ğŸ¯ æ˜¾ç¤ºæ•ˆæœç¤ºä¾‹

### æœªå¯åŠ¨çŠ¶æ€ + æœ‰å®šæ—¶å¯åŠ¨

```
[å¯åŠ¨è¿è¡Œ] â° 2å°æ—¶30åˆ†é’Ÿåè‡ªåŠ¨å¯åŠ¨    [åœæ­¢è¿è¡Œ]
```

### è¿è¡Œä¸­çŠ¶æ€ + æœ‰å®šæ—¶åœæ­¢

```
[å¯åŠ¨è¿è¡Œ(å·²ç¦ç”¨)]    [åœæ­¢è¿è¡Œ] âš ï¸ 5å°æ—¶45åˆ†é’Ÿåè‡ªåŠ¨åœæ­¢
```

### æ— å®šæ—¶è®¾ç½®

```
[å¯åŠ¨è¿è¡Œ]    [åœæ­¢è¿è¡Œ]
```

---

## ğŸ’¡ å®ç°è¦ç‚¹

### 1. å€’è®¡æ—¶æ›´æ–°é¢‘ç‡

```javascript
// æ¨èï¼šæ¯ç§’æ›´æ–°ä¸€æ¬¡
setInterval(calculateCountdown, 1000)

// å¯é€‰ï¼šå¦‚æœè·ç¦»å¾ˆè¿œï¼ˆå¤§äº1å°æ—¶ï¼‰ï¼Œå¯ä»¥æ¯åˆ†é’Ÿæ›´æ–°
if (diffMilliseconds > 3600000) {
  setInterval(calculateCountdown, 60000) // æ¯åˆ†é’Ÿ
} else {
  setInterval(calculateCountdown, 1000) // æ¯ç§’
}
```

### 2. æ—¶é—´æ˜¾ç¤ºç²¾åº¦

```javascript
// æ¨èçš„æ˜¾ç¤ºè§„åˆ™
if (days > 0) {
  return `${days}å¤©${hours}å°æ—¶`  // å¤§äº1å¤©ï¼šæ˜¾ç¤ºå¤©+å°æ—¶
} else if (hours > 0) {
  return `${hours}å°æ—¶${minutes}åˆ†é’Ÿ`  // å¤§äº1å°æ—¶ï¼šæ˜¾ç¤ºå°æ—¶+åˆ†é’Ÿ
} else if (minutes > 0) {
  return `${minutes}åˆ†é’Ÿ${seconds}ç§’`  // å¤§äº1åˆ†é’Ÿï¼šæ˜¾ç¤ºåˆ†é’Ÿ+ç§’
} else {
  return `${seconds}ç§’`  // å°äº1åˆ†é’Ÿï¼šåªæ˜¾ç¤ºç§’
}
```

### 3. æ¡ä»¶åˆ¤æ–­

```javascript
// æ˜¾ç¤ºå¯åŠ¨å€’è®¡æ—¶çš„æ¡ä»¶
if (robot.scheduleStart && robot.status !== 2) {
  // 1. æœ‰å®šæ—¶å¯åŠ¨æ—¶é—´
  // 2. æœºå™¨äººæœªè¿è¡Œ
  // 3. å®šæ—¶æ—¶é—´æœªåˆ°
}

// æ˜¾ç¤ºåœæ­¢å€’è®¡æ—¶çš„æ¡ä»¶
if (robot.scheduleStop && robot.status === 2) {
  // 1. æœ‰å®šæ—¶åœæ­¢æ—¶é—´
  // 2. æœºå™¨äººæ­£åœ¨è¿è¡Œ
  // 3. å®šæ—¶æ—¶é—´æœªåˆ°
}
```

### 4. æ€§èƒ½ä¼˜åŒ–

```javascript
// ç»„ä»¶é”€æ¯æ—¶æ¸…ç†å®šæ—¶å™¨
onUnmounted(() => {
  if (timer) {
    clearInterval(timer)
  }
})

// æˆ–ä½¿ç”¨ watchEffect è‡ªåŠ¨æ¸…ç†
watchEffect((onCleanup) => {
  const timer = setInterval(calculateCountdown, 1000)
  onCleanup(() => clearInterval(timer))
})
```

---

## ğŸ¨ æ ·å¼å»ºè®®

```css
/* å€’è®¡æ—¶å®¹å™¨ */
.countdown-text {
  font-size: 12px;
  font-weight: 500;
  padding: 4px 12px;
  border-radius: 4px;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

/* å¯åŠ¨å€’è®¡æ—¶ - ç»¿è‰² */
.countdown-text.success {
  color: #67C23A;
  background: #f0f9ff;
  border: 1px solid #67C23A;
}

/* åœæ­¢å€’è®¡æ—¶ - æ©™è‰² */
.countdown-text.warning {
  color: #E6A23C;
  background: #fdf6ec;
  border: 1px solid #E6A23C;
}

/* åŠ¨ç”»æ•ˆæœ */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

.countdown-text {
  animation: pulse 2s ease-in-out infinite;
}
```

---

## ğŸ“Š æ•°æ®æµ

```
åç«¯æ•°æ®åº“
    â†“
API è¿”å› scheduleStart/scheduleStop
    â†“
å‰ç«¯æ¥æ”¶æ•°æ®
    â†“
è®¡ç®—å€’è®¡æ—¶
    â†“
æ¯ç§’æ›´æ–°æ˜¾ç¤º
    â†“
å€’è®¡æ—¶å½’é›¶ â†’ è‡ªåŠ¨åˆ·æ–°åˆ—è¡¨
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ—¶åŒºå¤„ç†**
   - åç«¯è¿”å›çš„æ—¶é—´æ ¼å¼è¦ç»Ÿä¸€
   - å‰ç«¯éœ€è¦æ­£ç¡®è§£ææ—¶åŒº

2. **å€’è®¡æ—¶å½’é›¶**
   - å€’è®¡æ—¶ç»“æŸåï¼Œå»ºè®®åˆ·æ–°æœºå™¨äººåˆ—è¡¨
   - æˆ–é€šè¿‡WebSocketå®æ—¶æ›´æ–°çŠ¶æ€

3. **æ€§èƒ½ä¼˜åŒ–**
   - å¦‚æœåˆ—è¡¨ä¸­æœ‰å¾ˆå¤šæœºå™¨äººï¼Œè€ƒè™‘åªä¸ºå¯è§çš„æœºå™¨äººè®¡ç®—å€’è®¡æ—¶
   - ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–å¤§åˆ—è¡¨æ€§èƒ½

4. **ç”¨æˆ·ä½“éªŒ**
   - å€’è®¡æ—¶æ–‡å­—è¦æ¸…æ™°æ˜“è¯»
   - é¢œè‰²åŒºåˆ†å¯åŠ¨/åœæ­¢
   - æ·»åŠ å›¾æ ‡æå‡è¯†åˆ«åº¦

---

## ğŸ‰ æ€»ç»“

### âœ… åç«¯å·²å‡†å¤‡

- âœ… æ•°æ®åº“å­—æ®µå·²å­˜åœ¨
- âœ… APIå·²è¿”å›æ•°æ®
- âœ… æ— éœ€åç«¯ä¿®æ”¹

### ğŸ“ å‰ç«¯éœ€å®ç°

- [ ] åˆ›å»ºå€’è®¡æ—¶ç»„ä»¶
- [ ] å®ç°å€’è®¡æ—¶è®¡ç®—é€»è¾‘
- [ ] æ¯ç§’æ›´æ–°æ˜¾ç¤º
- [ ] æ·»åŠ æ ·å¼å’Œå›¾æ ‡
- [ ] å¤„ç†è¾¹ç•Œæƒ…å†µ

### ğŸ¯ é¢„æœŸæ•ˆæœ

ç”¨æˆ·å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°ï¼š
- æœºå™¨äººå°†åœ¨å¤šä¹…åè‡ªåŠ¨å¯åŠ¨
- æœºå™¨äººå°†åœ¨å¤šä¹…åè‡ªåŠ¨åœæ­¢
- å®æ—¶å€’è®¡æ—¶æ›´æ–°

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-12-23  
**åç«¯çŠ¶æ€**: âœ… å·²å°±ç»ª  
**å‰ç«¯çŠ¶æ€**: â³ å¾…å®ç°

