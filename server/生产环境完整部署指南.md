# ç”Ÿäº§ç¯å¢ƒå®Œæ•´éƒ¨ç½²æŒ‡å—

> **é€‚ç”¨äºï¼š** hotgo_v2 é‡åŒ–äº¤æ˜“ç³»ç»Ÿ  
> **æœåŠ¡å™¨ï¼š** Vultr Tokyo (Ubuntu 22.04 LTS)  
> **é¢„è®¡æ—¶é—´ï¼š** 60-90åˆ†é’Ÿ  
> **éš¾åº¦ï¼š** â­â­â­ ä¸­ç­‰

---

## ğŸ“‹ éƒ¨ç½²æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Vultr Tokyo Server                    â”‚
â”‚  OS: Ubuntu 22.04 LTS, 4æ ¸8G128G NVMe           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Internet (80, 443)                             â”‚
â”‚       â†“                                         â”‚
â”‚  Nginx (åå‘ä»£ç† + SSL)                         â”‚
â”‚       â†“                                         â”‚
â”‚  Go Backend :8000                               â”‚
â”‚  â”œâ”€ HTTP API æœåŠ¡                               â”‚
â”‚  â”œâ”€ WebSocket æœåŠ¡                              â”‚
â”‚  â”œâ”€ ç­–ç•¥å¼•æ“                                    â”‚
â”‚  â””â”€ å®šæ—¶ä»»åŠ¡                                    â”‚
â”‚       â†“                                         â”‚
â”‚  PostgreSQL :5432 (æ•°æ®åº“)                      â”‚
â”‚  Redis :6379 (ç¼“å­˜)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“ (é€šè¿‡ä»£ç†)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  äº¤æ˜“æ‰€ API    â”‚
    â”‚ Binance/Bitget â”‚
    â”‚ OKX/Gate.io    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¬¬ä¸€æ­¥ï¼šæœåŠ¡å™¨å‡†å¤‡ (10åˆ†é’Ÿ)

### 1.1 è´­ä¹° Vultr æœåŠ¡å™¨

```yaml
é…ç½®é€‰æ‹©:
  Location: Tokyo, Japan
  Server Type: Cloud Compute - High Frequency
  CPU: 4 vCPU
  RAM: 8 GB
  Storage: 128 GB NVMe SSD
  OS: Ubuntu 22.04 x64
  
å¯é€‰:
  âœ… Enable Auto Backups (+$4.8/æœˆ)
  âœ… Enable IPv6
  âœ… è®¾ç½® SSH Keysï¼ˆæ¨èï¼‰
```

### 1.2 é¦–æ¬¡è¿æ¥æœåŠ¡å™¨

```bash
# ä» Vultr æ§åˆ¶é¢æ¿è·å– IP å’Œå¯†ç 
# æœ¬åœ°ç»ˆç«¯æ‰§è¡Œï¼š
ssh root@YOUR_SERVER_IP

# é¦–æ¬¡ç™»å½•ä¼šæç¤ºä¿®æ”¹å¯†ç 
```

### 1.3 åˆ›å»ºéƒ¨ç½²ç”¨æˆ·ï¼ˆå®‰å…¨æœ€ä½³å®è·µï¼‰

```bash
# åˆ›å»ºæ™®é€šç”¨æˆ·
adduser hotgo
# è¾“å…¥å¯†ç å¹¶æŒ‰æç¤ºå®Œæˆ

# æ·»åŠ åˆ° sudo ç»„
usermod -aG sudo hotgo

# é…ç½® SSH å¯†é’¥ç™»å½•ï¼ˆæ¨èï¼‰
mkdir -p /home/hotgo/.ssh
cp ~/.ssh/authorized_keys /home/hotgo/.ssh/
chown -R hotgo:hotgo /home/hotgo/.ssh
chmod 700 /home/hotgo/.ssh
chmod 600 /home/hotgo/.ssh/authorized_keys

# æµ‹è¯•æ–°ç”¨æˆ·ç™»å½•
# æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£ï¼š
ssh hotgo@YOUR_SERVER_IP
```

---

## ç¬¬äºŒæ­¥ï¼šç³»ç»Ÿåˆå§‹åŒ– (15åˆ†é’Ÿ)

### 2.1 æ›´æ–°ç³»ç»Ÿ

```bash
# ä»¥ hotgo ç”¨æˆ·ç™»å½•åæ‰§è¡Œ
sudo apt update
sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y \
    curl \
    wget \
    git \
    vim \
    htop \
    net-tools \
    unzip \
    build-essential \
    software-properties-common \
    apt-transport-https \
    ca-certificates \
    gnupg \
    lsb-release
```

### 2.2 é…ç½®æ—¶åŒº

```bash
# è®¾ç½®ä¸ºä¸­å›½æ—¶åŒº
sudo timedatectl set-timezone Asia/Shanghai

# éªŒè¯
date
# è¾“å‡ºåº”è¯¥æ˜¾ç¤ºæ­£ç¡®çš„åŒ—äº¬æ—¶é—´
```

### 2.3 é…ç½®é˜²ç«å¢™

```bash
# å®‰è£… UFW
sudo apt install -y ufw

# é…ç½®è§„åˆ™
sudo ufw allow 22/tcp      # SSH
sudo ufw allow 80/tcp      # HTTP
sudo ufw allow 443/tcp     # HTTPS
# 8000ç«¯å£ä¸å¯¹å¤–å¼€æ”¾ï¼Œåªå…è®¸ Nginx å†…éƒ¨è®¿é—®

# å¯ç”¨é˜²ç«å¢™
sudo ufw --force enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status verbose
```

### 2.4 ä¼˜åŒ–ç³»ç»Ÿå‚æ•°

```bash
# ç¼–è¾‘ç³»ç»Ÿé…ç½®
sudo tee -a /etc/sysctl.conf > /dev/null <<EOF

# ç½‘ç»œä¼˜åŒ–
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 1200
net.core.somaxconn = 4096
net.ipv4.tcp_max_syn_backlog = 8192

# æ–‡ä»¶æè¿°ç¬¦
fs.file-max = 2097152

# TCP BBR æ‹¥å¡æ§åˆ¶
net.core.default_qdisc = fq
net.ipv4.tcp_congestion_control = bbr
EOF

# åº”ç”¨é…ç½®
sudo sysctl -p

# éªŒè¯ BBR å¯ç”¨
sysctl net.ipv4.tcp_congestion_control
# è¾“å‡ºåº”è¯¥æ˜¯: net.ipv4.tcp_congestion_control = bbr
```

---

## ç¬¬ä¸‰æ­¥ï¼šå®‰è£…ä¾èµ–è½¯ä»¶ (20åˆ†é’Ÿ)

### 3.1 å®‰è£… Go 1.21+

```bash
# ä¸‹è½½ Goï¼ˆæ£€æŸ¥æœ€æ–°ç‰ˆæœ¬ï¼šhttps://go.dev/dl/ï¼‰
cd /tmp
wget https://go.dev/dl/go1.21.5.linux-amd64.tar.gz

# è§£å‹åˆ° /usr/local
sudo rm -rf /usr/local/go
sudo tar -C /usr/local -xzf go1.21.5.linux-amd64.tar.gz

# é…ç½®ç¯å¢ƒå˜é‡
echo 'export PATH=$PATH:/usr/local/go/bin' | sudo tee -a /etc/profile
echo 'export GOPATH=$HOME/go' | sudo tee -a /etc/profile
echo 'export PATH=$PATH:$GOPATH/bin' | sudo tee -a /etc/profile

# ä½¿é…ç½®ç”Ÿæ•ˆ
source /etc/profile

# éªŒè¯å®‰è£…
go version
# è¾“å‡º: go version go1.21.5 linux/amd64

# é…ç½® Go ä»£ç†ï¼ˆå›½å†…åŠ é€Ÿï¼‰
go env -w GOPROXY=https://goproxy.cn,direct
go env -w GO111MODULE=on
```

### 3.2 å®‰è£… PostgreSQL 14+

```bash
# æ·»åŠ å®˜æ–¹ä»“åº“
sudo sh -c 'echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/pgdg.list'
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -

# å®‰è£… PostgreSQL
sudo apt update
sudo apt install -y postgresql-14 postgresql-contrib-14

# å¯åŠ¨æœåŠ¡
sudo systemctl start postgresql
sudo systemctl enable postgresql

# éªŒè¯çŠ¶æ€
sudo systemctl status postgresql
```

### 3.3 é…ç½® PostgreSQL

```bash
# åˆ‡æ¢åˆ° postgres ç”¨æˆ·
sudo -u postgres psql

-- åœ¨ PostgreSQL å‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE hotgo;

-- åˆ›å»ºç”¨æˆ·
CREATE USER hotgo_user WITH PASSWORD 'YOUR_STRONG_PASSWORD_HERE';

-- æˆäºˆæƒé™
GRANT ALL PRIVILEGES ON DATABASE hotgo TO hotgo_user;

-- é€€å‡º
\q
```

**ä¿®æ”¹ PostgreSQL é…ç½®**

```bash
# ç¼–è¾‘ä¸»é…ç½®æ–‡ä»¶
sudo vim /etc/postgresql/14/main/postgresql.conf

# æ‰¾åˆ°å¹¶ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼ˆé€‚åˆ8GBå†…å­˜æœåŠ¡å™¨ï¼‰ï¼š
shared_buffers = 2GB
effective_cache_size = 6GB
maintenance_work_mem = 512MB
work_mem = 32MB
max_connections = 100
random_page_cost = 1.1
effective_io_concurrency = 200

# ä¿å­˜åé‡å¯ PostgreSQL
sudo systemctl restart postgresql
```

### 3.4 å®‰è£… Redis

```bash
# å®‰è£… Redis
sudo apt install -y redis-server

# é…ç½® Redis
sudo vim /etc/redis/redis.conf

# ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š
# 1. ç›‘å¬åœ°å€ï¼ˆåªç›‘å¬æœ¬åœ°ï¼‰
bind 127.0.0.1

# 2. å¯†ç ä¿æŠ¤ï¼ˆå–æ¶ˆæ³¨é‡Šå¹¶è®¾ç½®å¯†ç ï¼‰
requirepass YOUR_REDIS_PASSWORD_HERE

# 3. å†…å­˜é™åˆ¶
maxmemory 2gb
maxmemory-policy allkeys-lru

# 4. æŒä¹…åŒ–
save 900 1
save 300 10
save 60 10000

# é‡å¯ Redis
sudo systemctl restart redis-server
sudo systemctl enable redis-server

# éªŒè¯
redis-cli
# åœ¨ redis-cli ä¸­æµ‹è¯•ï¼š
AUTH YOUR_REDIS_PASSWORD_HERE
PING
# åº”è¯¥è¿”å› PONG
exit
```

### 3.5 å®‰è£… Nginx

```bash
# å®‰è£… Nginx
sudo apt install -y nginx

# å¯åŠ¨æœåŠ¡
sudo systemctl start nginx
sudo systemctl enable nginx

# éªŒè¯
sudo systemctl status nginx

# æµ‹è¯•è®¿é—®ï¼ˆåœ¨æµè§ˆå™¨ä¸­è®¿é—®ä½ çš„æœåŠ¡å™¨IPï¼‰
# http://YOUR_SERVER_IP
# åº”è¯¥çœ‹åˆ° Nginx æ¬¢è¿é¡µé¢
```

---

## ç¬¬å››æ­¥ï¼šéƒ¨ç½²åº”ç”¨ä»£ç  (15åˆ†é’Ÿ)

### 4.1 åˆ›å»ºé¡¹ç›®ç›®å½•

```bash
# åˆ›å»ºåº”ç”¨ç›®å½•
sudo mkdir -p /opt/hotgo
sudo chown -R hotgo:hotgo /opt/hotgo

# åˆ›å»ºå¤‡ä»½ç›®å½•
sudo mkdir -p /opt/hotgo/backups
```

### 4.2 å…‹éš†ä»£ç 

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/hotgo

# å…‹éš†ä»£ç ï¼ˆæ›¿æ¢ä¸ºä½ çš„ä»“åº“åœ°å€ï¼‰
git clone https://github.com/YOUR_USERNAME/hotgo_v2.git
# æˆ–è€…ä½¿ç”¨ç§æœ‰ä»“åº“ï¼š
# git clone git@github.com:YOUR_USERNAME/hotgo_v2.git

# è¿›å…¥æœåŠ¡ç«¯ç›®å½•
cd /opt/hotgo/hotgo_v2/server
```

### 4.3 å®‰è£… Go ä¾èµ–

```bash
# ä¸‹è½½ä¾èµ–
go mod download
go mod verify

# å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼Œç­‰å¾…å®Œæˆ...
```

### 4.4 é…ç½®åº”ç”¨

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿
cp manifest/config/config.example.yaml manifest/config/config.yaml

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim manifest/config/config.yaml
```

**å…³é”®é…ç½®é¡¹ï¼ˆconfig.yamlï¼‰ï¼š**

```yaml
server:
  address: "127.0.0.1:8000"  # åªç›‘å¬æœ¬åœ°ï¼Œé€šè¿‡ Nginx ä»£ç†
  serverRoot: "resource/public"
  openapiPath: "/api.json"
  swaggerPath: "/swagger"
  
database:
  default:
    host: "127.0.0.1"
    port: "5432"
    user: "hotgo_user"
    pass: "YOUR_STRONG_PASSWORD_HERE"  # PostgreSQL å¯†ç 
    name: "hotgo"
    type: "pgsql"
    role: "master"
    debug: false
    maxIdle: 10
    maxOpen: 50
    maxLifetime: 3600

redis:
  default:
    address: "127.0.0.1:6379"
    db: 0
    pass: "YOUR_REDIS_PASSWORD_HERE"  # Redis å¯†ç 
    
# å…¶ä»–é…ç½®æ ¹æ®éœ€è¦è°ƒæ•´...
```

### 4.5 åˆå§‹åŒ–æ•°æ®åº“

```bash
# å¯¼å…¥æ•°æ®åº“ç»“æ„
psql -h 127.0.0.1 -U hotgo_user -d hotgo -f storage/data/trading_system.sql

# å¦‚æœæœ‰å…¶ä»–åˆå§‹åŒ–è„šæœ¬ï¼Œä¾æ¬¡æ‰§è¡Œ
# psql -h 127.0.0.1 -U hotgo_user -d hotgo -f storage/data/xxx.sql
```

### 4.6 ç¼–è¯‘åº”ç”¨

```bash
# è¿›å…¥æœåŠ¡ç«¯ç›®å½•
cd /opt/hotgo/hotgo_v2/server

# ç¼–è¯‘
go build -o main main.go

# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x main

# æµ‹è¯•è¿è¡Œï¼ˆæŒ‰ Ctrl+C åœæ­¢ï¼‰
./main http

# å¦‚æœèƒ½æ­£å¸¸å¯åŠ¨ä¸”æ²¡æœ‰é”™è¯¯ï¼Œè¯´æ˜é…ç½®æ­£ç¡®
```

---

## ç¬¬äº”æ­¥ï¼šé…ç½® Systemd æœåŠ¡ (10åˆ†é’Ÿ)

### 5.1 åˆ›å»ºæœåŠ¡æ–‡ä»¶

```bash
sudo vim /etc/systemd/system/hotgo.service
```

**æœåŠ¡æ–‡ä»¶å†…å®¹ï¼š**

```ini
[Unit]
Description=HotGo Trading System
Documentation=https://github.com/your/repo
After=network.target postgresql.service redis.service
Wants=postgresql.service redis.service

[Service]
Type=simple
User=hotgo
Group=hotgo
WorkingDirectory=/opt/hotgo/hotgo_v2/server

ExecStart=/opt/hotgo/hotgo_v2/server/main http
ExecReload=/bin/kill -HUP $MAINPID

# ä¼˜é›…å…³é—­
KillMode=mixed
KillSignal=SIGTERM
TimeoutStopSec=30
Restart=on-failure
RestartSec=5s

# ç¯å¢ƒå˜é‡
Environment="GF_GCFG_PATH=/opt/hotgo/hotgo_v2/server/manifest/config"
Environment="GF_GLOG_PATH=/opt/hotgo/hotgo_v2/server/logs"

# èµ„æºé™åˆ¶
LimitNOFILE=65536
LimitNPROC=4096

# æ—¥å¿—
StandardOutput=journal
StandardError=journal
SyslogIdentifier=hotgo

[Install]
WantedBy=multi-user.target
```

### 5.2 å¯åŠ¨æœåŠ¡

```bash
# é‡æ–°åŠ è½½ systemd
sudo systemctl daemon-reload

# å¯ç”¨å¼€æœºè‡ªå¯
sudo systemctl enable hotgo

# å¯åŠ¨æœåŠ¡
sudo systemctl start hotgo

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status hotgo

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u hotgo -f
# æŒ‰ Ctrl+C é€€å‡ºæ—¥å¿—æŸ¥çœ‹
```

---

## ç¬¬å…­æ­¥ï¼šé…ç½® Nginx åå‘ä»£ç† (15åˆ†é’Ÿ)

### 6.1 åˆ›å»º Nginx é…ç½®

```bash
sudo vim /etc/nginx/sites-available/hotgo
```

**Nginx é…ç½®å†…å®¹ï¼š**

```nginx
# HTTP é…ç½®ï¼ˆç¨åä¼šå‡çº§åˆ° HTTPSï¼‰
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;
    
    # æ—¥å¿—
    access_log /var/log/nginx/hotgo_access.log;
    error_log /var/log/nginx/hotgo_error.log;
    
    # å®¢æˆ·ç«¯ä¸Šä¼ å¤§å°é™åˆ¶
    client_max_body_size 50M;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /opt/hotgo/hotgo_v2/web/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }
    
    # API ä»£ç†
    location /admin/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # WebSocket ä»£ç†
    location /socket {
        proxy_pass http://127.0.0.1:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # WebSocket è¶…æ—¶
        proxy_read_timeout 3600s;
        proxy_send_timeout 3600s;
    }
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$ {
        root /opt/hotgo/hotgo_v2/web/dist;
        expires 7d;
        add_header Cache-Control "public, immutable";
    }
}
```

### 6.2 å¯ç”¨é…ç½®

```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/hotgo /etc/nginx/sites-enabled/

# åˆ é™¤é»˜è®¤é…ç½®
sudo rm /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

### 6.3 éƒ¨ç½²å‰ç«¯ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# åœ¨æœ¬åœ°å¼€å‘æœºå™¨ä¸Šç¼–è¯‘å‰ç«¯
cd /path/to/hotgo_v2/web
npm install
npm run build
# ä¼šç”Ÿæˆ dist ç›®å½•

# å°† dist ç›®å½•ä¸Šä¼ åˆ°æœåŠ¡å™¨
# æ–¹æ³•1: ä½¿ç”¨ scp
scp -r dist/* hotgo@YOUR_SERVER_IP:/opt/hotgo/hotgo_v2/web/dist/

# æ–¹æ³•2: ä½¿ç”¨ rsyncï¼ˆæ¨èï¼‰
rsync -avz --delete dist/ hotgo@YOUR_SERVER_IP:/opt/hotgo/hotgo_v2/web/dist/
```

---

## ç¬¬ä¸ƒæ­¥ï¼šé…ç½®åŸŸåå’Œ SSL (10åˆ†é’Ÿ)

### 7.1 é…ç½®åŸŸå DNS

åœ¨ä½ çš„åŸŸåæä¾›å•†ï¼ˆå¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€Cloudflareï¼‰æ·»åŠ  A è®°å½•ï¼š

```
ç±»å‹: A
ä¸»æœºè®°å½•: @
è®°å½•å€¼: YOUR_SERVER_IP
TTL: 600

ç±»å‹: A
ä¸»æœºè®°å½•: www
è®°å½•å€¼: YOUR_SERVER_IP
TTL: 600
```

### 7.2 å®‰è£… Let's Encrypt SSL è¯ä¹¦

```bash
# å®‰è£… Certbot
sudo apt install -y certbot python3-certbot-nginx

# è·å–è¯ä¹¦ï¼ˆä¼šè‡ªåŠ¨é…ç½® Nginxï¼‰
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# æŒ‰ç…§æç¤ºè¾“å…¥é‚®ç®±å’ŒåŒæ„æ¡æ¬¾

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run

# è‡ªåŠ¨ç»­æœŸå·²é…ç½®ï¼Œè¯ä¹¦ä¼šè‡ªåŠ¨æ›´æ–°
```

**Certbot ä¼šè‡ªåŠ¨ä¿®æ”¹ Nginx é…ç½®ï¼Œæ·»åŠ  HTTPS æ”¯æŒ**

---

## ç¬¬å…«æ­¥ï¼šå®‰å…¨åŠ å›º (10åˆ†é’Ÿ)

### 8.1 é…ç½® SSH å®‰å…¨

```bash
sudo vim /etc/ssh/sshd_config
```

**ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š**

```ini
# ç¦æ­¢ root ç™»å½•
PermitRootLogin no

# ç¦æ­¢å¯†ç ç™»å½•ï¼ˆåªå…è®¸å¯†é’¥ï¼‰
PasswordAuthentication no
PubkeyAuthentication yes

# ä¿®æ”¹ SSH ç«¯å£ï¼ˆå¯é€‰ï¼Œå¢åŠ å®‰å…¨æ€§ï¼‰
Port 2222

# åªå…è®¸ç‰¹å®šç”¨æˆ·ç™»å½•
AllowUsers hotgo
```

**åº”ç”¨é…ç½®ï¼š**

```bash
# é‡å¯ SSHï¼ˆæ³¨æ„ï¼šå¦‚æœä¿®æ”¹äº†ç«¯å£ï¼Œè®°å¾—æ›´æ–°é˜²ç«å¢™è§„åˆ™ï¼‰
sudo systemctl restart sshd

# å¦‚æœä¿®æ”¹äº†ç«¯å£ï¼š
sudo ufw allow 2222/tcp
sudo ufw delete allow 22/tcp
```

### 8.2 å®‰è£… Fail2banï¼ˆé˜²æ­¢æš´åŠ›ç ´è§£ï¼‰

```bash
# å®‰è£…
sudo apt install -y fail2ban

# åˆ›å»ºé…ç½®
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
sudo vim /etc/fail2ban/jail.local

# ç¡®ä¿ä»¥ä¸‹é…ç½®å¯ç”¨ï¼š
[sshd]
enabled = true
port = ssh  # å¦‚æœä¿®æ”¹äº†SSHç«¯å£ï¼Œæ”¹ä¸º 2222
maxretry = 3
bantime = 3600

[nginx-http-auth]
enabled = true

# å¯åŠ¨æœåŠ¡
sudo systemctl start fail2ban
sudo systemctl enable fail2ban

# æŸ¥çœ‹çŠ¶æ€
sudo fail2ban-client status
```

---

## ç¬¬ä¹æ­¥ï¼šé…ç½®ç›‘æ§å’Œæ—¥å¿— (10åˆ†é’Ÿ)

### 9.1 é…ç½®æ—¥å¿—è½®è½¬

```bash
sudo vim /etc/logrotate.d/hotgo
```

**æ—¥å¿—è½®è½¬é…ç½®ï¼š**

```
/opt/hotgo/hotgo_v2/server/logs/*.log {
    daily
    rotate 7
    compress
    delaycompress
    notifempty
    create 0644 hotgo hotgo
    sharedscripts
    postrotate
        systemctl reload hotgo > /dev/null 2>&1 || true
    endscript
}

/var/log/nginx/hotgo_*.log {
    daily
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 www-data adm
    sharedscripts
    postrotate
        [ -f /var/run/nginx.pid ] && kill -USR1 `cat /var/run/nginx.pid`
    endscript
}
```

### 9.2 åˆ›å»ºç›‘æ§è„šæœ¬

```bash
mkdir -p /opt/hotgo/scripts
vim /opt/hotgo/scripts/monitor.sh
```

**ç›‘æ§è„šæœ¬å†…å®¹ï¼š**

```bash
#!/bin/bash
# å¥åº·æ£€æŸ¥è„šæœ¬

LOG_FILE="/var/log/hotgo-monitor.log"

log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a $LOG_FILE
}

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
if ! systemctl is-active --quiet hotgo; then
    log "ERROR: HotGo service is not running!"
    systemctl start hotgo
    log "INFO: Attempted to restart HotGo service"
fi

# æ£€æŸ¥ API å“åº”
if ! curl -f -s -o /dev/null http://localhost:8000/api/health; then
    log "ERROR: HotGo API is not responding!"
fi

# æ£€æŸ¥ç£ç›˜ç©ºé—´
DISK_USAGE=$(df -h / | awk 'NR==2 {print $5}' | sed 's/%//')
if [ $DISK_USAGE -gt 85 ]; then
    log "WARNING: Disk usage is high: ${DISK_USAGE}%"
fi

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
MEM_USAGE=$(free | grep Mem | awk '{printf "%.0f", $3/$2 * 100.0}')
if [ $MEM_USAGE -gt 85 ]; then
    log "WARNING: Memory usage is high: ${MEM_USAGE}%"
fi

log "INFO: Health check completed"
```

**æ·»åŠ åˆ° Crontabï¼š**

```bash
chmod +x /opt/hotgo/scripts/monitor.sh

# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ ï¼ˆæ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼‰
*/5 * * * * /opt/hotgo/scripts/monitor.sh
```

### 9.3 é…ç½®è‡ªåŠ¨å¤‡ä»½

```bash
vim /opt/hotgo/scripts/backup.sh
```

**å¤‡ä»½è„šæœ¬ï¼š**

```bash
#!/bin/bash
# è‡ªåŠ¨å¤‡ä»½è„šæœ¬

BACKUP_DIR="/opt/hotgo/backups"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
PGPASSWORD="YOUR_STRONG_PASSWORD_HERE"

# å¤‡ä»½æ•°æ®åº“
log_info "Starting database backup..."
PGPASSWORD=$PGPASSWORD pg_dump -h 127.0.0.1 -U hotgo_user hotgo | gzip > "$BACKUP_DIR/db_backup_$TIMESTAMP.sql.gz"

# å¤‡ä»½åº”ç”¨ä»£ç å’Œé…ç½®
tar -czf "$BACKUP_DIR/app_backup_$TIMESTAMP.tar.gz" \
    -C /opt/hotgo/hotgo_v2/server \
    --exclude='logs' \
    --exclude='tmp' \
    .

# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "db_backup_*.sql.gz" -mtime +7 -delete
find $BACKUP_DIR -name "app_backup_*.tar.gz" -mtime +7 -delete

echo "Backup completed: $TIMESTAMP"
```

**æ·»åŠ åˆ° Crontabï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹å¤‡ä»½ï¼‰ï¼š**

```bash
chmod +x /opt/hotgo/scripts/backup.sh

crontab -e

# æ·»åŠ 
0 3 * * * /opt/hotgo/scripts/backup.sh >> /var/log/hotgo-backup.log 2>&1
```

---

## ç¬¬åæ­¥ï¼šéªŒè¯éƒ¨ç½² (5åˆ†é’Ÿ)

### 10.1 æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥ Go åº”ç”¨
sudo systemctl status hotgo

# æ£€æŸ¥ PostgreSQL
sudo systemctl status postgresql

# æ£€æŸ¥ Redis
sudo systemctl status redis-server

# æ£€æŸ¥ Nginx
sudo systemctl status nginx

# æ‰€æœ‰æœåŠ¡éƒ½åº”è¯¥æ˜¯ active (running)
```

### 10.2 æµ‹è¯• API è®¿é—®

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
curl http://localhost:8000/api/health

# æµ‹è¯•é€šè¿‡ Nginx è®¿é—®
curl https://yourdomain.com/admin/health

# éƒ½åº”è¯¥è¿”å›æ­£å¸¸å“åº”
```

### 10.3 è®¿é—® Web ç•Œé¢

```
åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
https://yourdomain.com

åº”è¯¥èƒ½å¤Ÿ:
1. çœ‹åˆ°ç™»å½•é¡µé¢
2. æ­£å¸¸ç™»å½•
3. æŸ¥çœ‹ç³»ç»ŸåŠŸèƒ½
```

---

## å¸¸ç”¨è¿ç»´å‘½ä»¤

### åº”ç”¨ç®¡ç†

```bash
# å¯åŠ¨æœåŠ¡
sudo systemctl start hotgo

# åœæ­¢æœåŠ¡
sudo systemctl stop hotgo

# é‡å¯æœåŠ¡
sudo systemctl restart hotgo

# ä¼˜é›…é‡å¯
sudo systemctl reload-or-restart hotgo

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status hotgo

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u hotgo -f

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
sudo journalctl -u hotgo -n 100 --no-pager
```

### æ•°æ®åº“ç®¡ç†

```bash
# è¿æ¥æ•°æ®åº“
psql -h 127.0.0.1 -U hotgo_user -d hotgo

# å¤‡ä»½æ•°æ®åº“
PGPASSWORD='password' pg_dump -h 127.0.0.1 -U hotgo_user hotgo > backup.sql

# æ¢å¤æ•°æ®åº“
psql -h 127.0.0.1 -U hotgo_user -d hotgo < backup.sql
```

### æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
ss -tulnp

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep hotgo

# æŸ¥çœ‹ Nginx è¿æ¥æ•°
ss -ant | grep :80 | wc -l
```

---

## æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u hotgo -xe

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cd /opt/hotgo/hotgo_v2/server
./main -check

# æ£€æŸ¥ç«¯å£å ç”¨
sudo ss -tulnp | grep 8000

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /opt/hotgo/hotgo_v2/server/
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -h 127.0.0.1 -U hotgo_user -d hotgo

# æ£€æŸ¥ PostgreSQL æ—¥å¿—
sudo tail -f /var/log/postgresql/postgresql-14-main.log

# æ£€æŸ¥è¿æ¥é…ç½®
cat manifest/config/config.yaml | grep -A 10 database
```

### Nginx 502 é”™è¯¯

```bash
# æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
sudo systemctl status hotgo

# æ£€æŸ¥ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/hotgo_error.log

# æµ‹è¯•åç«¯ API
curl http://localhost:8000/api/health

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t
```

---

## å®‰å…¨æ£€æŸ¥æ¸…å•

åœ¨éƒ¨ç½²å®Œæˆåï¼Œç¡®ä¿ï¼š

```
â–¡ SSH å·²é…ç½®å¯†é’¥ç™»å½•ï¼Œç¦æ­¢å¯†ç ç™»å½•
â–¡ é˜²ç«å¢™å·²å¯ç”¨ï¼Œåªå¼€æ”¾å¿…è¦ç«¯å£
â–¡ PostgreSQL å’Œ Redis åªç›‘å¬æœ¬åœ°
â–¡ æ‰€æœ‰é»˜è®¤å¯†ç å·²ä¿®æ”¹ä¸ºå¼ºå¯†ç 
â–¡ SSL è¯ä¹¦å·²é…ç½®å¹¶è‡ªåŠ¨æ›´æ–°
â–¡ Fail2ban å·²å¯ç”¨å¹¶é…ç½®
â–¡ æ—¥å¿—è½®è½¬å·²é…ç½®
â–¡ è‡ªåŠ¨å¤‡ä»½å·²é…ç½®
â–¡ ç›‘æ§è„šæœ¬å·²è¿è¡Œ
â–¡ æ‰€æœ‰æœåŠ¡å·²è®¾ç½®å¼€æœºè‡ªå¯
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æ•°æ®åº“ä¼˜åŒ–

```sql
-- å®šæœŸæ¸…ç†
VACUUM ANALYZE;

-- åˆ›å»ºå¿…è¦ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_robot_user_id ON hg_trading_robot(user_id);
CREATE INDEX IF NOT EXISTS idx_order_created_at ON hg_trading_order(created_at);

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT * FROM pg_stat_statements 
ORDER BY total_exec_time DESC 
LIMIT 10;
```

### åº”ç”¨ä¼˜åŒ–

```bash
# è°ƒæ•´ Go è¿›ç¨‹æ•°ï¼ˆæ ¹æ®CPUæ ¸å¿ƒæ•°ï¼‰
# åœ¨ config.yaml ä¸­ï¼š
server:
  workers: 4  # 4æ ¸CPUå»ºè®®è®¾ä¸º4
```

---

## å¤‡ä»½å’Œæ¢å¤

### å®Œæ•´å¤‡ä»½

```bash
# æ‰‹åŠ¨æ‰§è¡Œå®Œæ•´å¤‡ä»½
/opt/hotgo/scripts/backup.sh

# å¤‡ä»½æ–‡ä»¶ä½ç½®
ls -lh /opt/hotgo/backups/
```

### æ¢å¤ç³»ç»Ÿ

```bash
# 1. åœæ­¢æœåŠ¡
sudo systemctl stop hotgo

# 2. æ¢å¤æ•°æ®åº“
cd /opt/hotgo/backups
gunzip -c db_backup_YYYYMMDD_HHMMSS.sql.gz | psql -h 127.0.0.1 -U hotgo_user -d hotgo

# 3. æ¢å¤åº”ç”¨
tar -xzf app_backup_YYYYMMDD_HHMMSS.tar.gz -C /opt/hotgo/hotgo_v2/server

# 4. é‡å¯æœåŠ¡
sudo systemctl start hotgo
```

---

## å‡çº§å’Œæ›´æ–°

å‚è€ƒä¹‹å‰åˆ›å»ºçš„æ–‡æ¡£ï¼š
- `ç”Ÿäº§ç¯å¢ƒæ›´æ–°éƒ¨ç½²æ–¹æ¡ˆ.md`

å¿«é€Ÿæ›´æ–°å‘½ä»¤ï¼š
```bash
cd /opt/hotgo/hotgo_v2/server
git pull
go build -o main main.go
sudo systemctl reload-or-restart hotgo
```

---

## é™„å½•ï¼šå®Œæ•´éƒ¨ç½²è„šæœ¬

ä¸ºäº†ç®€åŒ–éƒ¨ç½²ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªä¸€é”®éƒ¨ç½²è„šæœ¬ï¼š

```bash
# ä¸‹è½½éƒ¨ç½²è„šæœ¬
wget https://raw.githubusercontent.com/YOUR_REPO/scripts/install.sh
chmod +x install.sh

# è¿è¡Œéƒ¨ç½²è„šæœ¬
./install.sh
```

---

**éƒ¨ç½²å®Œæˆï¼ğŸ‰**

ç°åœ¨ä½ çš„ hotgo_v2 é‡åŒ–äº¤æ˜“ç³»ç»Ÿå·²ç»æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼

**ä¸‹ä¸€æ­¥ï¼š**
1. é…ç½®äº¤æ˜“æ‰€ API
2. è®¾ç½®ä»£ç†ï¼ˆå¦‚éœ€è¦ï¼‰
3. åˆ›å»ºäº¤æ˜“æœºå™¨äºº
4. å¼€å§‹é‡åŒ–äº¤æ˜“

**è·å–å¸®åŠ©ï¼š**
- æŸ¥çœ‹æ—¥å¿—ï¼š`sudo journalctl -u hotgo -f`
- é—®é¢˜æ’æŸ¥ï¼šå‚è€ƒ"æ•…éšœæ’æŸ¥"ç« èŠ‚
- è”ç³»æ”¯æŒï¼šï¼ˆæ·»åŠ ä½ çš„è”ç³»æ–¹å¼ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-12-24  
**ç»´æŠ¤è€…**: HotGo Team

