# 官方策略组管理 - 查看策略404问题修复

## 问题描述
在"量化管理 → 官方策略管理"页面，点击策略组列表中的"查看策略"按钮时，页面报404错误。

## 问题原因分析

### 1. 路由跳转方式问题
原代码使用的是路径跳转：
```typescript
router.push({ path: '/toogo/strategy/list', query: {...} });
```

在某些情况下，路径跳转可能因为权限检查或路由配置问题而失败。

### 2. 父路由权限问题
`/toogo/strategy` 父路由没有明确设置 `permissions: []`，可能导致子路由继承了默认的权限限制。

## 修复方案

### 修复1：使用命名路由跳转

**文件**: `web/src/views/toogo/admin/strategy/index.vue`

**修改前**:
```typescript
function viewStrategies(row: any) {
  router.push({ 
    path: '/toogo/strategy/list', 
    query: { groupId: row.id, groupName: row.groupName } 
  });
}
```

**修改后**:
```typescript
function viewStrategies(row: any) {
  router.push({ 
    name: 'StrategyList',  // 使用命名路由
    query: { groupId: row.id, groupName: row.groupName } 
  });
}
```

**优势**:
- ✅ 命名路由更可靠，不受路径变化影响
- ✅ 绕过某些路径匹配问题
- ✅ 更符合Vue Router最佳实践

### 修复2：父路由添加权限豁免

**文件**: `web/src/router/modules/toogo.ts`

**修改前**:
```typescript
{
  path: 'strategy',
  name: 'ToogoStrategy',
  component: ParentLayout,
  redirect: '/toogo/strategy/my',
  meta: {
    title: '策略管理',
    icon: renderIcon(SettingOutlined),
  },
  children: [...]
}
```

**修改后**:
```typescript
{
  path: 'strategy',
  name: 'ToogoStrategy',
  component: ParentLayout,
  redirect: '/toogo/strategy/my',
  meta: {
    title: '策略管理',
    icon: renderIcon(SettingOutlined),
    permissions: [], // 确保父路由也无权限限制
  },
  children: [...]
}
```

**优势**:
- ✅ 明确标记父路由无需权限验证
- ✅ 子路由可以正常访问
- ✅ 避免权限继承问题

## 修复后的完整流程

```
┌─────────────────────────────────────┐
│ 官方策略组管理页面                   │
│ /toogo-admin/strategy               │
└────────────┬────────────────────────┘
             │
             │ 点击"查看策略"
             ↓
    ┌────────────────────┐
    │ router.push({      │
    │   name: 'StrategyList',
    │   query: {...}     │
    │ })                 │
    └─────────┬──────────┘
              │
              │ 命名路由跳转
              ↓
┌─────────────────────────────────────┐
│ 策略列表页面                         │
│ /toogo/strategy/list                │
│ ?groupId=xxx&groupName=xxx          │
└────────────┬────────────────────────┘
             │
             │ 加载策略数据
             ↓
    ┌────────────────────┐
    │ GET /api/admin/    │
    │ strategy/template/ │
    │ list?groupId=xxx   │
    └────────────────────┘
             │
             ↓
    ✅ 显示12种策略
```

## 测试步骤

1. **刷新浏览器缓存**
   ```
   Ctrl + Shift + R (Windows)
   Cmd + Shift + R (Mac)
   ```

2. **进入官方策略管理**
   - 导航：量化管理 → 官方策略管理

3. **创建测试策略组**（如果没有）
   - 点击"创建官方策略组"
   - 填写基本信息
   - 保存

4. **点击"查看策略"按钮**
   - 应该正常跳转到策略列表页面
   - URL变为：`/toogo/strategy/list?groupId=xxx&groupName=xxx`

5. **验证页面功能**
   - 策略列表正常显示
   - 可以查看策略详情
   - 可以编辑策略（如果有权限）

## 预期结果

### ✅ 成功状态

1. **URL正确**
   ```
   http://192.168.1.2:8010/toogo/strategy/list?groupId=1&groupName=测试策略组
   ```

2. **页面显示**
   - 页面标题：`测试策略组 - 策略管理`
   - 显示策略矩阵视图
   - 可以按市场状态筛选

3. **后端API调用**
   ```
   GET /api/admin/strategy/template/list?groupId=1&pageSize=100
   Status: 200 OK
   ```

4. **控制台无错误**
   - 无404错误
   - 无权限错误
   - 无路由错误

### ❌ 如果仍然失败

#### 检查1：浏览器控制台
打开开发者工具（F12），查看：
- Console 标签：是否有JavaScript错误
- Network 标签：是否有404请求

#### 检查2：路由配置
确认路由已正确注册：
```typescript
// 在浏览器控制台执行
console.log(router.getRoutes().find(r => r.name === 'StrategyList'))
```

应该输出路由配置对象，而不是 `undefined`。

#### 检查3：权限配置
检查用户是否有访问权限：
```typescript
// 在浏览器控制台执行
console.log(router.currentRoute.value.meta)
```

#### 检查4：后端API
直接测试后端API：
```bash
curl -X GET "http://192.168.1.2:8009/api/admin/strategy/template/list?groupId=1" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## 相关文件

- ✅ `web/src/views/toogo/admin/strategy/index.vue` - 官方策略组管理页面
- ✅ `web/src/views/toogo/strategy/list.vue` - 策略列表页面
- ✅ `web/src/router/modules/toogo.ts` - 路由配置
- ✅ `server/api/admin/trading/strategy_group.go` - API定义
- ✅ `server/internal/controller/admin/trading/strategy_template.go` - 控制器

## 补充说明

### 命名路由 vs 路径路由

**命名路由（推荐）**:
```typescript
router.push({ name: 'StrategyList', query: {...} })
```
- ✅ 不受路径变化影响
- ✅ 类型安全（如果使用TypeScript）
- ✅ 更易维护

**路径路由**:
```typescript
router.push({ path: '/toogo/strategy/list', query: {...} })
```
- ⚠️ 路径硬编码
- ⚠️ 路径变化需要全局修改
- ⚠️ 可能受权限检查影响

### 权限配置最佳实践

```typescript
meta: {
  permissions: [],      // 空数组 = 无需权限
  // permissions: ['admin'],  // 需要admin权限
  // 不设置 = 继承父路由权限
}
```

---

**修复时间**: 2025-12-03  
**修复人员**: AI Assistant  
**状态**: ✅ 已修复

















