# 官方策略组管理 - 查看策略404问题排查

## 问题描述
点击"官方策略组管理"列表中的"查看策略"按钮时，页面报404错误。

## 排查步骤

### 1. 前端路由检查 ✅
**文件**: `web/src/router/modules/toogo.ts`

路由定义正确：
```typescript
{
  path: 'list',
  name: 'StrategyList',
  component: () => import('@/views/toogo/strategy/list.vue'),
  meta: {
    title: '策略列表',
    hidden: true,
    activeMenu: '/toogo/strategy/my',
    permissions: [], // 不需要权限验证
  },
}
```

完整路径：`/toogo/strategy/list`

### 2. 页面文件检查 ✅
**文件**: `web/src/views/toogo/strategy/list.vue`

文件存在且正常。

### 3. 跳转代码检查 ✅
**文件**: `web/src/views/toogo/admin/strategy/index.vue`

```typescript
function viewStrategies(row: any) {
  router.push({ 
    path: '/toogo/strategy/list', 
    query: { 
      groupId: row.id, 
      groupName: row.groupName 
    } 
  });
}
```

跳转路径正确。

### 4. 后端API检查 ✅
**API定义**: `server/api/admin/trading/strategy_group.go`

```go
type StrategyTemplateListReq struct {
	g.Meta `path:"/strategy/template/list" method:"get" tags:"策略" summary:"策略列表"`
	// ...
}
```

**控制器**: `server/internal/controller/admin/trading/strategy_template.go`

**路由注册**: `server/internal/router/admin.go`
```go
trading.StrategyTemplate, // Trading 策略
```

### 5. 可能的原因

#### 原因1：前端路由权限问题
虽然设置了 `permissions: []`，但可能还有其他权限检查逻辑。

#### 原因2：父路由权限问题
`/toogo/strategy` 父路由可能有权限限制。

#### 原因3：路由懒加载问题
Vue组件懒加载可能失败。

#### 原因4：后端API权限问题
虽然前端路由可访问，但后端API可能需要特定权限。

## 解决方案

### 方案1：检查完整的路由树权限

检查 `/toogo/strategy` 父路由是否有权限限制：

```typescript
{
  path: 'strategy',
  name: 'ToogoStrategy',
  component: ParentLayout,
  redirect: '/toogo/strategy/my',
  meta: {
    title: '策略管理',
    icon: renderIcon(SettingOutlined),
    // 检查这里是否有 permissions 字段
  },
  children: [...]
}
```

### 方案2：添加明确的路由守卫豁免

在路由配置中明确标记为公开路由：

```typescript
{
  path: 'list',
  name: 'StrategyList',
  component: () => import('@/views/toogo/strategy/list.vue'),
  meta: {
    title: '策略列表',
    hidden: true,
    activeMenu: '/toogo/strategy/my',
    permissions: [],
    ignoreAuth: true,  // 添加此标记
  },
}
```

### 方案3：检查路由守卫逻辑

检查 `web/src/router/router-guards.ts` 中的权限判断逻辑。

### 方案4：直接访问测试

在浏览器中直接访问：
```
http://192.168.1.2:8010/toogo/strategy/list?groupId=1&groupName=测试
```

如果能访问，说明是跳转逻辑问题；如果不能访问，说明是路由配置问题。

### 方案5：检查后端API权限

检查 `server/internal/controller/admin/trading/strategy_template.go` 的 `List` 方法是否需要特定权限。

## 快速修复

### 修复1：确保父路由无权限限制

```typescript
// web/src/router/modules/toogo.ts
{
  path: 'strategy',
  name: 'ToogoStrategy',
  component: ParentLayout,
  redirect: '/toogo/strategy/my',
  meta: {
    title: '策略管理',
    icon: renderIcon(SettingOutlined),
    permissions: [], // 确保父路由也无权限限制
  },
  children: [...]
}
```

### 修复2：使用命名路由跳转

```typescript
// web/src/views/toogo/admin/strategy/index.vue
function viewStrategies(row: any) {
  router.push({ 
    name: 'StrategyList',  // 使用命名路由
    query: { 
      groupId: row.id, 
      groupName: row.groupName 
    } 
  });
}
```

### 修复3：添加错误处理

```typescript
function viewStrategies(row: any) {
  try {
    router.push({ 
      path: '/toogo/strategy/list', 
      query: { 
        groupId: row.id, 
        groupName: row.groupName 
      } 
    });
  } catch (error) {
    console.error('路由跳转失败:', error);
    message.error('页面跳转失败，请刷新后重试');
  }
}
```

## 测试步骤

1. 刷新浏览器
2. 打开开发者工具（F12）
3. 切换到 Network 标签
4. 点击"查看策略"按钮
5. 查看：
   - 是否有404请求（如果有，是哪个URL）
   - Console 是否有错误信息
   - 页面URL是否正确跳转

## 预期结果

点击"查看策略"后：
- URL变为：`http://192.168.1.2:8010/toogo/strategy/list?groupId=xxx&groupName=xxx`
- 页面显示策略列表
- 后端API请求：`GET /api/admin/strategy/template/list?groupId=xxx`

---

**创建时间**: 2025-12-03  
**状态**: 待解决

















