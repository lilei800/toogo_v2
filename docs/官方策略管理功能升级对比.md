# 官方策略管理功能升级对比

## 📊 升级前后对比

### 升级前：单个策略模板管理

```
┌───────────────────────────────────┐
│  策略模板管理                      │
├───────────────────────────────────┤
│  管理对象：单个策略模板             │
│  数据表：hg_trading_strategy       │
│          _template                 │
│                                    │
│  问题：                            │
│  ❌ 用户无法引用和使用              │
│  ❌ 没有策略组概念                 │
│  ❌ 不支持12种策略矩阵              │
│  ❌ 与"我的策略"机制不一致          │
└───────────────────────────────────┘
```

### 升级后：策略组管理

```
┌───────────────────────────────────┐
│  官方策略组管理                    │
├───────────────────────────────────┤
│  管理对象：策略组（Group）          │
│  数据表：hg_trading_strategy       │
│          _group                    │
│          + 12个策略模板             │
│                                    │
│  优势：                            │
│  ✅ 用户可引用完整策略组            │
│  ✅ 支持批量初始化12种策略          │
│  ✅ 与"我的策略"机制一致            │
│  ✅ 完整的策略矩阵                 │
└───────────────────────────────────┘
```

---

## 🎯 核心改进

### 1️⃣ 数据结构变化

#### 升级前
```
hg_trading_strategy_template (策略模板表)
├─ id: 1, strategy_name: "平衡-趋势", isOfficial: 1
├─ id: 2, strategy_name: "保守-震荡", isOfficial: 1
└─ id: 3, strategy_name: "激进-高波动", isOfficial: 1
   ❌ 孤立的单个策略，无法作为完整模板使用
```

#### 升级后
```
hg_trading_strategy_group (策略组表)
└─ id: 1, group_name: "🔥 BTC-USDT 官方策略 V6.0", isOfficial: 1
   └─ hg_trading_strategy_template (策略模板表)
      ├─ id: 1, strategy_name: "保守-趋势", group_id: 1
      ├─ id: 2, strategy_name: "保守-震荡", group_id: 1
      ├─ id: 3, strategy_name: "保守-高波动", group_id: 1
      ├─ id: 4, strategy_name: "保守-低波动", group_id: 1
      ├─ ... (共12种策略)
      └─ ✅ 完整的4×3策略矩阵
```

### 2️⃣ 功能对比

| 功能 | 升级前 | 升级后 |
|------|--------|--------|
| **创建** | 单个策略模板 | 策略组 + 12种策略 |
| **批量初始化** | ❌ 不支持 | ✅ 一键生成12种 |
| **查看详情** | ❌ 无详情页 | ✅ 跳转策略列表 |
| **用户引用** | ❌ 无法引用 | ✅ 可添加到我的策略 |
| **策略矩阵** | ❌ 不完整 | ✅ 4市场×3风险 |
| **删除限制** | ⚠️ 官方不可删 | ✅ 管理员可删 |

### 3️⃣ 操作流程对比

#### 升级前的操作
```
1. 创建单个策略
2. 填写策略参数
3. 保存
   ↓
❌ 用户无法使用（没有策略组）
```

#### 升级后的操作
```
1. 创建官方策略组
   - 策略组名称：🔥 BTC-USDT 官方策略 V6.0
   - 交易所：Bitget
   - 交易对：BTCUSDT
   ↓
2. 批量初始化（可选）
   - 一键生成12种策略
   - 使用默认参数
   ↓
3. 查看策略列表
   - 查看/编辑具体策略
   - 调整参数
   ↓
4. 用户使用
   - 在"官方策略模板"中浏览
   - 添加到"我的策略"
   - 创建机器人使用
   ↓
✅ 完整的策略生命周期
```

---

## 🎨 界面功能详解

### 主页面

```
┌──────────────────────────────────────────────────────┐
│  官方策略组管理                   [创建官方策略组]     │
├──────────────────────────────────────────────────────┤
│  ℹ️ 官方策略组管理说明                                │
│  此页面用于创建和维护官方策略组。每个策略组包含12种   │
│  策略模板（4种市场状态×3种风险偏好）                  │
├──────────────────────────────────────────────────────┤
│  [交易所▼] [交易对] [查询] [重置]                     │
├──────────────────────────────────────────────────────┤
│  ID | 策略组名称 | 交易所 | 策略数 | 状态 | 操作       │
├──────────────────────────────────────────────────────┤
│  1  | 🔥 BTC V6.0 | Bitget | 12/12 | 启用 |            │
│     | BTC-USDT    |        | ✅    |      |            │
│     [查看策略] [初始化] [编辑] [删除]                  │
├──────────────────────────────────────────────────────┤
│  2  | ETH V5.0    | Binance| 8/12  | 启用 |            │
│     | ETH-USDT    |        | ⚠️    |      |            │
│     [查看策略] [初始化] [编辑] [删除]                  │
└──────────────────────────────────────────────────────┘
```

### 创建策略组弹窗

```
┌──────────────────────────────────┐
│  创建官方策略组                   │
├──────────────────────────────────┤
│  ℹ️ 创建后可以批量初始化12种策略   │
├──────────────────────────────────┤
│  策略组名称: [________________]   │
│  策略组标识: [________________]   │
│  交易平台:   [Bitget ▼]          │
│  交易对:     [BTCUSDT ▼]         │
│  订单类型:   [市价单 ▼]          │
│  保证金模式: [逐仓 ▼]            │
│  描述:       [________________]   │
│              [________________]   │
│  排序:       [1         ]         │
├──────────────────────────────────┤
│              [取消] [创建]         │
└──────────────────────────────────┘
```

### 批量初始化弹窗

```
┌──────────────────────────────────┐
│  批量初始化策略                   │
├──────────────────────────────────┤
│  ⚠️ 将为"BTC-USDT V6.0"生成      │
│     12种策略模板                  │
├──────────────────────────────────┤
│  使用默认参数: [✓]               │
│                                   │
│  💡 默认参数包括合理的杠杆范围、   │
│     止损比例、止盈回撤等          │
├──────────────────────────────────┤
│              [取消] [开始初始化]   │
└──────────────────────────────────┘
```

---

## 🔄 完整数据流程

### 管理员创建官方策略组

```
1. 量化管理 → 官方策略组管理
   ↓
2. 点击"创建官方策略组"
   ↓
3. 填写基本信息
   - 名称：🔥 BTC-USDT 官方策略 V6.0
   - 标识：official_btc_usdt_v6
   - 交易所：Bitget
   - 交易对：BTCUSDT
   - 描述：...
   ↓
4. 点击"创建"
   ↓
5. 策略组创建成功（但还没有具体策略）
   ↓
6. 点击"初始化"按钮
   ↓
7. 选择"使用默认参数"
   ↓
8. 点击"开始初始化"
   ↓
9. 系统自动生成12种策略：
   - 保守-趋势（3-5x杠杆）
   - 保守-震荡（2-4x杠杆）
   - 保守-高波动（2-3x杠杆）
   - 保守-低波动（4-6x杠杆）
   - 平衡-趋势（5-10x杠杆）
   - 平衡-震荡（4-8x杠杆）
   - 平衡-高波动（5-10x杠杆）
   - 平衡-低波动（6-12x杠杆）
   - 激进-趋势（10-20x杠杆）
   - 激进-震荡（8-15x杠杆）
   - 激进-高波动（10-25x杠杆）
   - 激进-低波动（12-30x杠杆）
   ↓
10. 点击"查看策略"
   ↓
11. 可以查看和微调每个策略的参数
```

### 用户使用官方策略

```
1. 策略管理 → 官方策略模板
   ↓
2. 浏览官方策略组列表
   - 看到"🔥 BTC-USDT 官方策略 V6.0"
   ↓
3. 点击"查看详情"或"添加到我的策略"
   ↓
4. 策略组+12种策略全部复制到"我的策略"
   ↓
5. 在"我的策略"中可以自定义修改
   ↓
6. 创建机器人时选择此策略组
   ↓
7. 机器人根据市场状态自动匹配最优策略
   - 当前市场：震荡
   - 风险偏好：平衡
   - 使用策略：平衡-震荡（4-8x杠杆）
   ↓
✅ 机器人开始自动交易
```

---

## 📋 12种策略矩阵

### 市场状态 × 风险偏好

|  | 🛡️ 保守型 | ⚖️ 平衡型 | 🚀 激进型 |
|--|---------|---------|---------|
| **📈 趋势** | conservative_trend<br>3-5x杠杆 | balanced_trend<br>5-10x杠杆 | aggressive_trend<br>10-20x杠杆 |
| **📊 震荡** | conservative_range<br>2-4x杠杆 | balanced_range<br>4-8x杠杆 | aggressive_range<br>8-15x杠杆 |
| **⚡ 高波动** | conservative_high_vol<br>2-3x杠杆 | balanced_high_vol<br>5-10x杠杆 | aggressive_high_vol<br>10-25x杠杆 |
| **😴 低波动** | conservative_low_vol<br>4-6x杠杆 | balanced_low_vol<br>6-12x杠杆 | aggressive_low_vol<br>12-30x杠杆 |

---

## 🔧 技术实现

### API接口

#### 策略组管理
- `POST /trading/strategy/group/create` - 创建策略组
- `POST /trading/strategy/group/update` - 更新策略组
- `POST /trading/strategy/group/delete` - 删除策略组
- `GET  /trading/strategy/group/list` - 查询策略组列表
- `POST /trading/strategy/group/init` - 批量初始化12种策略

#### 策略模板管理
- 通过"查看策略"按钮跳转到 `/toogo/strategy/list`
- 在策略列表页面可以查看和编辑具体策略

### 后端代码

**文件**: `server/internal/logic/toogo/strategy_group.go`

**关键方法**:
```go
// Init 初始化12种策略
func (s *StrategyGroupService) Init(ctx context.Context, in *toogoin.StrategyGroupInitInp) error {
    // 定义4种市场状态
    marketStates := []struct{
        Key  string
        Name string
        Window int
        Threshold float64
    }{
        {Key: "trend", Name: "趋势", Window: 240, Threshold: 100.00},
        {Key: "range", Name: "震荡", Window: 180, Threshold: 50.00},
        {Key: "high_vol", Name: "高波动", Window: 120, Threshold: 150.00},
        {Key: "low_vol", Name: "低波动", Window: 600, Threshold: 30.00},
    }
    
    // 定义3种风险偏好
    riskPreferences := []struct{
        Key  string
        Name string
        // ... 杠杆、保证金等参数
    }{
        {Key: "conservative", Name: "保守", ...},
        {Key: "balanced", Name: "平衡", ...},
        {Key: "aggressive", Name: "激进", ...},
    }
    
    // 4×3=12种策略
    for _, market := range marketStates {
        for _, risk := range riskPreferences {
            // 插入策略模板
        }
    }
}
```

---

## 🎨 页面功能详解

### 1. 创建官方策略组

**步骤**:
1. 点击"创建官方策略组"
2. 填写基本信息：
   - 策略组名称：`🔥 BTC-USDT 官方策略 V6.0`
   - 策略组标识：`official_btc_usdt_v6`（唯一）
   - 交易平台：`Bitget`
   - 交易对：`BTCUSDT`
   - 订单类型：`市价单`
   - 保证金模式：`逐仓`
   - 描述：详细说明
   - 排序：1（数字越小越靠前）
3. 点击"创建"
4. ✅ 策略组创建成功

**特点**:
- `isOfficial` 自动设置为 `1`
- `userId` 设置为 `0`（不属于任何用户）

### 2. 批量初始化策略

**步骤**:
1. 在策略组列表找到策略数 `< 12` 的组
2. 点击"初始化"按钮
3. 选择"使用默认参数"（推荐）
4. 点击"开始初始化"
5. ✅ 自动生成12种策略模板

**生成的策略**:
- ✅ 包含完整的参数配置
- ✅ 杠杆范围合理
- ✅ 止损/止盈比例科学
- ✅ 适合实战使用

### 3. 查看和编辑策略

**步骤**:
1. 点击"查看策略"按钮
2. 跳转到 `/toogo/strategy/list?groupId=xxx`
3. 查看12种策略的详细参数
4. 可以编辑每个策略的参数

### 4. 编辑策略组

**步骤**:
1. 点击"编辑"按钮
2. 修改策略组基本信息
3. 点击"保存"
4. ✅ 策略组更新成功

### 5. 删除策略组

**步骤**:
1. 点击"删除"按钮
2. 确认删除
3. ✅ 策略组及其所有策略被删除

---

## 💡 使用场景

### 场景1：创建新版本官方策略

**需求**: Toogo团队开发了V6.0版本的策略，需要发布给用户

**操作**:
1. 量化管理 → 官方策略组管理
2. 创建官方策略组
   - 名称：`🔥 BTC-USDT 官方策略 V6.0`
   - 标识：`official_btc_usdt_v6`
3. 批量初始化12种策略
4. 查看策略列表，微调参数
5. ✅ 发布完成，用户可见

### 场景2：为新交易所创建官方策略

**需求**: 系统新增支持 Gate.io，需要创建官方策略

**操作**:
1. 创建官方策略组
   - 名称：`🔥 BTC-USDT Gate.io 官方策略`
   - 交易所：`Gate`
   - 交易对：`BTCUSDT`
2. 批量初始化
3. ✅ Gate.io 用户可以使用

### 场景3：维护和优化策略

**需求**: 根据市场反馈，优化激进型策略的杠杆

**操作**:
1. 找到对应的策略组
2. 点击"查看策略"
3. 找到激进型策略，调整杠杆范围
4. 保存
5. ✅ 已使用此策略的用户可以重新同步

---

## ✅ 升级完成清单

- [x] 重写页面为策略组管理模式
- [x] 支持创建官方策略组
- [x] 支持批量初始化12种策略
- [x] 支持查看策略列表
- [x] 支持编辑策略组
- [x] 支持删除策略组
- [x] 添加筛选功能（交易所、交易对）
- [x] 添加分页功能
- [x] 强制官方标识（isOfficial = 1）
- [x] 与"我的策略"机制保持一致

---

## 🚀 后续建议

1. **添加策略组版本管理**
   - V5.0 → V6.0 版本升级
   - 版本对比功能

2. **添加策略同步功能**
   - 官方策略更新时，通知已使用的用户
   - 一键同步最新参数

3. **添加策略测试功能**
   - 回测工具
   - 参数优化建议

4. **添加策略发布审核**
   - 策略上线前审核
   - 性能指标验证

---

**升级完成时间**: 2025-12-03  
**升级人员**: AI Assistant  
**状态**: ✅ 完成

