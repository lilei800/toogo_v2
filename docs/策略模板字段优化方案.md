# ç­–ç•¥æ¨¡æ¿å­—æ®µä¼˜åŒ–æ–¹æ¡ˆ

## é—®é¢˜æè¿°

å½“å‰ç­–ç•¥æ¨¡æ¿ä½¿ç”¨**åŒºé—´å€¼**è¡¨ç¤ºæ æ†å’Œä¿è¯é‡‘ï¼š
- `leverage_min` ~ `leverage_max`ï¼ˆå¦‚ï¼š5-10xï¼‰
- `margin_percent_min` ~ `margin_percent_max`ï¼ˆå¦‚ï¼š5-15%ï¼‰

**é—®é¢˜**ï¼šç­–ç•¥æ¨¡æ¿åº”è¯¥æœ‰æ˜ç¡®çš„å‚æ•°å€¼ï¼Œè€Œä¸æ˜¯èŒƒå›´ã€‚åŒºé—´å€¼ä¼šå¯¼è‡´ï¼š
1. ç­–ç•¥ä¸å¤Ÿæ˜ç¡®
2. åº”ç”¨æ—¶éœ€è¦é¢å¤–é€‰æ‹©
3. æ•°æ®ç†è§£å›°éš¾

## ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šåªä¿ç•™å•ä¸€å€¼ï¼ˆæ¨èï¼‰

**æ•°æ®åº“æ”¹åŠ¨**ï¼š
```sql
-- åˆ é™¤åŒºé—´å­—æ®µï¼Œåªä¿ç•™å•ä¸€å€¼
ALTER TABLE `hg_trading_strategy_template` 
  ADD COLUMN `leverage` int(11) DEFAULT '5' COMMENT 'æ æ†å€æ•°' AFTER `volatility_threshold`,
  ADD COLUMN `margin_percent` decimal(5,2) DEFAULT '10.00' COMMENT 'ä¿è¯é‡‘æ¯”ä¾‹(%)' AFTER `leverage`,
  DROP COLUMN `leverage_min`,
  DROP COLUMN `leverage_max`,
  DROP COLUMN `margin_percent_min`,
  DROP COLUMN `margin_percent_max`;
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç­–ç•¥å‚æ•°æ˜ç¡®
- âœ… ç®€åŒ–æ•°æ®ç»“æ„
- âœ… æ˜“äºç†è§£å’Œä½¿ç”¨

**åŠ£åŠ¿**ï¼š
- âš ï¸ éœ€è¦æ•°æ®è¿ç§»
- âš ï¸ ç ´åæ€§æ”¹åŠ¨

### æ–¹æ¡ˆBï¼šä¿ç•™åŒºé—´å­—æ®µï¼Œåªç”¨å•ä¸€å€¼ï¼ˆå…¼å®¹ï¼‰

**æ•°æ®åº“æ”¹åŠ¨**ï¼š
```sql
-- æ–°å¢æ¨èå€¼å­—æ®µï¼Œä¿ç•™åŒºé—´å­—æ®µï¼ˆå‘åå…¼å®¹ï¼‰
ALTER TABLE `hg_trading_strategy_template` 
  ADD COLUMN `leverage` int(11) DEFAULT NULL COMMENT 'æ¨èæ æ†å€æ•°' AFTER `volatility_threshold`,
  ADD COLUMN `margin_percent` decimal(5,2) DEFAULT NULL COMMENT 'æ¨èä¿è¯é‡‘æ¯”ä¾‹(%)' AFTER `leverage`;

-- å°†ç°æœ‰åŒºé—´å­—æ®µæ ‡è®°ä¸ºåºŸå¼ƒï¼ˆä½†ä¿ç•™ï¼‰
ALTER TABLE `hg_trading_strategy_template` 
  MODIFY COLUMN `leverage_min` int(11) DEFAULT NULL COMMENT '[åºŸå¼ƒ]æ æ†æœ€å°å€¼',
  MODIFY COLUMN `leverage_max` int(11) DEFAULT NULL COMMENT '[åºŸå¼ƒ]æ æ†æœ€å¤§å€¼',
  MODIFY COLUMN `margin_percent_min` decimal(5,2) DEFAULT NULL COMMENT '[åºŸå¼ƒ]ä¿è¯é‡‘æœ€å°å€¼',
  MODIFY COLUMN `margin_percent_max` decimal(5,2) DEFAULT NULL COMMENT '[åºŸå¼ƒ]ä¿è¯é‡‘æœ€å¤§å€¼';
```

**ä¼˜åŠ¿**ï¼š
- âœ… å‘åå…¼å®¹
- âœ… é€æ­¥è¿ç§»
- âœ… ä¸ç ´åç°æœ‰æ•°æ®

**åŠ£åŠ¿**ï¼š
- âš ï¸ å­—æ®µå†—ä½™
- âš ï¸ éœ€è¦ç»´æŠ¤åŒé‡é€»è¾‘

---

## æ¨èæ–¹æ¡ˆï¼šæ–¹æ¡ˆAï¼ˆå½»åº•æ”¹é€ ï¼‰

### 1. æ•°æ®åº“è¿ç§»SQL

```sql
-- ====================================
-- ç­–ç•¥æ¨¡æ¿å­—æ®µä¼˜åŒ–
-- ====================================

-- å¤‡ä»½æ—§æ•°æ®
CREATE TABLE `hg_trading_strategy_template_backup` AS 
SELECT * FROM `hg_trading_strategy_template`;

-- æ·»åŠ æ–°å­—æ®µ
ALTER TABLE `hg_trading_strategy_template` 
  ADD COLUMN `leverage` int(11) DEFAULT '5' COMMENT 'æ æ†å€æ•°' AFTER `volatility_threshold`,
  ADD COLUMN `margin_percent` decimal(5,2) DEFAULT '10.00' COMMENT 'ä¿è¯é‡‘æ¯”ä¾‹(%)' AFTER `leverage`;

-- è¿ç§»æ•°æ®ï¼šä½¿ç”¨åŒºé—´çš„å¹³å‡å€¼æˆ–æœ€å°å€¼
UPDATE `hg_trading_strategy_template` 
SET 
  `leverage` = COALESCE(`leverage_min`, 5),
  `margin_percent` = COALESCE(`margin_percent_min`, 10.00);

-- åˆ é™¤æ—§å­—æ®µ
ALTER TABLE `hg_trading_strategy_template` 
  DROP COLUMN `leverage_min`,
  DROP COLUMN `leverage_max`,
  DROP COLUMN `margin_percent_min`,
  DROP COLUMN `margin_percent_max`;

-- éªŒè¯æ•°æ®
SELECT id, strategy_name, leverage, margin_percent 
FROM `hg_trading_strategy_template` 
LIMIT 10;
```

### 2. Go Entityæ›´æ–°

**æ–‡ä»¶**: `server/internal/model/entity/trading_strategy_template.go`

```go
type TradingStrategyTemplate struct {
	Id                       int64       `json:"id"`
	GroupId                  int64       `json:"groupId"`
	StrategyKey              string      `json:"strategyKey"`
	StrategyName             string      `json:"strategyName"`
	RiskPreference           string      `json:"riskPreference"`
	MarketState              string      `json:"marketState"`
	MonitorWindow            int         `json:"monitorWindow"`
	VolatilityThreshold      float64     `json:"volatilityThreshold"`
	Leverage                 int         `json:"leverage"`              // æ–°å¢
	MarginPercent            float64     `json:"marginPercent"`         // æ–°å¢
	StopLossPercent          float64     `json:"stopLossPercent"`
	ProfitRetreatPercent     float64     `json:"profitRetreatPercent"`
	AutoStartRetreatPercent  float64     `json:"autoStartRetreatPercent"`
	ConfigJson               string      `json:"configJson"`
	Description              string      `json:"description"`
	IsActive                 int         `json:"isActive"`
	Sort                     int         `json:"sort"`
	CreatedAt                *gtime.Time `json:"createdAt"`
	UpdatedAt                *gtime.Time `json:"updatedAt"`
}
```

### 3. å‰ç«¯è¡¨å•æ›´æ–°

**æ–‡ä»¶**: `web/src/views/toogo/strategy/list.vue`

**ä¿®æ”¹è¡¨å•æ•°æ®**ï¼š
```typescript
const formData = ref({
  strategyName: '',
  marketState: 'trend',
  riskPreference: 'balanced',
  monitorWindow: 300,
  volatilityThreshold: 100,
  leverage: 8,           // å›ºå®šæ æ†å€¼
  marginPercent: 12,     // å›ºå®šä¿è¯é‡‘æ¯”ä¾‹
  stopLossPercent: 5,
  autoStartRetreatPercent: 3,
  profitRetreatPercent: 25,
  description: '',
});
```

**ä¿®æ”¹æ˜¾ç¤ºé€»è¾‘**ï¼š
```vue
<!-- ç­–ç•¥å¡ç‰‡æ˜¾ç¤º -->
<n-descriptions-item label="æ æ†">
  <n-text type="info">{{ strategy.leverage || 0 }}x</n-text>
</n-descriptions-item>
<n-descriptions-item label="ä¿è¯é‡‘">
  <n-text type="info">{{ strategy.marginPercent || 0 }}%</n-text>
</n-descriptions-item>
```

**ä¿®æ”¹è¡¨å•è¾“å…¥**ï¼š
```vue
<n-form-item label="æ æ†å€æ•°" path="leverage">
  <n-input-number v-model:value="formData.leverage" :min="1" :max="125" style="width: 100%">
    <template #suffix>x</template>
  </n-input-number>
</n-form-item>

<n-form-item label="ä¿è¯é‡‘æ¯”ä¾‹" path="marginPercent">
  <n-input-number v-model:value="formData.marginPercent" :min="1" :max="100" :precision="2" style="width: 100%">
    <template #suffix>%</template>
  </n-input-number>
</n-form-item>
```

### 4. æ‰¹é‡åˆå§‹åŒ–é€»è¾‘æ›´æ–°

**æ–‡ä»¶**: `server/internal/logic/toogo/strategy_group.go`

```go
// Init æ‰¹é‡åˆå§‹åŒ–12ç§ç­–ç•¥
func (s *StrategyGroupService) Init(ctx context.Context, in *toogoin.StrategyGroupInitInp) error {
    // å®šä¹‰æ¨èå‚æ•°
    strategyParams := map[string]map[string]struct{
        Leverage      int
        MarginPercent float64
    }{
        "conservative": {
            "trend":    {Leverage: 3, MarginPercent: 8.00},
            "range":    {Leverage: 2, MarginPercent: 5.00},
            "high_vol": {Leverage: 2, MarginPercent: 5.00},
            "low_vol":  {Leverage: 5, MarginPercent: 10.00},
        },
        "balanced": {
            "trend":    {Leverage: 5, MarginPercent: 12.00},
            "range":    {Leverage: 4, MarginPercent: 10.00},
            "high_vol": {Leverage: 5, MarginPercent: 12.00},
            "low_vol":  {Leverage: 8, MarginPercent: 15.00},
        },
        "aggressive": {
            "trend":    {Leverage: 10, MarginPercent: 20.00},
            "range":    {Leverage: 8, MarginPercent: 15.00},
            "high_vol": {Leverage: 10, MarginPercent: 20.00},
            "low_vol":  {Leverage: 15, MarginPercent: 25.00},
        },
    }
    
    // ç”Ÿæˆ12ç§ç­–ç•¥...
}
```

---

## æ¨èå‚æ•°å€¼

### ä¿å®ˆå‹ï¼ˆConservativeï¼‰
| å¸‚åœºçŠ¶æ€ | æ æ† | ä¿è¯é‡‘% | è¯´æ˜ |
|---------|------|---------|------|
| ğŸ“ˆ è¶‹åŠ¿ | 3x | 8% | ç¨³å¥è·Ÿè¶‹åŠ¿ |
| ğŸ“Š éœ‡è¡ | 2x | 5% | è°¨æ…å°ä»“ä½ |
| âš¡ é«˜æ³¢åŠ¨ | 2x | 5% | æ§åˆ¶é£é™© |
| ğŸ˜´ ä½æ³¢åŠ¨ | 5x | 10% | é€‚å½“åŠ æ æ† |

### å¹³è¡¡å‹ï¼ˆBalancedï¼‰â­æ¨è
| å¸‚åœºçŠ¶æ€ | æ æ† | ä¿è¯é‡‘% | è¯´æ˜ |
|---------|------|---------|------|
| ğŸ“ˆ è¶‹åŠ¿ | 5x | 12% | æ ‡å‡†é…ç½® |
| ğŸ“Š éœ‡è¡ | 4x | 10% | é€‚ä¸­é…ç½® |
| âš¡ é«˜æ³¢åŠ¨ | 5x | 12% | çµæ´»åº”å¯¹ |
| ğŸ˜´ ä½æ³¢åŠ¨ | 8x | 15% | åŠ å¤§ä»“ä½ |

### æ¿€è¿›å‹ï¼ˆAggressiveï¼‰
| å¸‚åœºçŠ¶æ€ | æ æ† | ä¿è¯é‡‘% | è¯´æ˜ |
|---------|------|---------|------|
| ğŸ“ˆ è¶‹åŠ¿ | 10x | 20% | æœ€å¤§åŒ–æ”¶ç›Š |
| ğŸ“Š éœ‡è¡ | 8x | 15% | ç§¯ææ“ä½œ |
| âš¡ é«˜æ³¢åŠ¨ | 10x | 20% | é«˜é£é™©é«˜æ”¶ç›Š |
| ğŸ˜´ ä½æ³¢åŠ¨ | 15x | 25% | æé™æ“ä½œ |

---

## å®æ–½æ­¥éª¤

### æ­¥éª¤1ï¼šæ•°æ®åº“å¤‡ä»½
```bash
mysqldump -u root -p hotgo_v2 hg_trading_strategy_template > strategy_template_backup.sql
```

### æ­¥éª¤2ï¼šæ‰§è¡Œè¿ç§»SQL
```bash
mysql -u root -p hotgo_v2 < strategy_template_migration.sql
```

### æ­¥éª¤3ï¼šé‡æ–°ç”ŸæˆGoä»£ç 
```bash
cd server
gf gen dao
```

### æ­¥éª¤4ï¼šæ›´æ–°å‰ç«¯ä»£ç 
- ä¿®æ”¹ `list.vue` æ˜¾ç¤ºå’Œè¡¨å•
- ä¿®æ”¹ `my.vue` æ˜¾ç¤ºå’Œè¡¨å•
- ä¿®æ”¹ `official.vue` æ˜¾ç¤ºå’Œè¡¨å•

### æ­¥éª¤5ï¼šæ›´æ–°åç«¯é€»è¾‘
- ä¿®æ”¹ç­–ç•¥åˆå§‹åŒ–é€»è¾‘
- ä¿®æ”¹ç­–ç•¥åº”ç”¨é€»è¾‘
- ä¿®æ”¹æœºå™¨äººåˆ›å»ºé€»è¾‘

### æ­¥éª¤6ï¼šæµ‹è¯•
- åˆ›å»ºæ–°ç­–ç•¥æ¨¡æ¿
- åº”ç”¨ç­–ç•¥åˆ°æœºå™¨äºº
- éªŒè¯æœºå™¨äººä½¿ç”¨çš„å‚æ•°

---

## å½±å“èŒƒå›´

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

**åç«¯**:
- `server/storage/data/migrations/optimize_strategy_template.sql` (æ–°å»º)
- `server/internal/model/entity/trading_strategy_template.go`
- `server/internal/logic/toogo/strategy_group.go`
- `server/internal/logic/toogo/strategy_template.go`

**å‰ç«¯**:
- `web/src/views/toogo/strategy/list.vue`
- `web/src/views/toogo/strategy/my.vue`
- `web/src/views/toogo/strategy/official.vue`

**æ–‡æ¡£**:
- `docs/ç­–ç•¥æ¨¡æ¿æ•°æ®ç»“æ„.md`
- `storage/data/å®˜æ–¹ç­–ç•¥æ¨¡æ¿ç”Ÿæˆè¯´æ˜.md`

---

## å…¼å®¹æ€§è€ƒè™‘

### ç°æœ‰æ•°æ®è¿ç§»
ä½¿ç”¨ `leverage_min` ä½œä¸ºæ–°çš„ `leverage` å€¼ï¼ˆæœ€ä¿å®ˆï¼‰

### APIå…¼å®¹æ€§
å‰ç«¯è°ƒç”¨åç«¯APIæ—¶ï¼Œå­—æ®µåç§°æ”¹å˜ï¼Œéœ€è¦åŒæ­¥æ›´æ–°

### å›æ»šæ–¹æ¡ˆ
ä¿ç•™å¤‡ä»½è¡¨ï¼Œå¦‚éœ€å›æ»šï¼š
```sql
DROP TABLE `hg_trading_strategy_template`;
RENAME TABLE `hg_trading_strategy_template_backup` TO `hg_trading_strategy_template`;
```

---

**åˆ›å»ºæ—¶é—´**: 2025-12-03  
**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜  
**å½±å“èŒƒå›´**: âš ï¸ å¤§ï¼ˆéœ€è¦æ•°æ®åº“è¿ç§»ï¼‰

















