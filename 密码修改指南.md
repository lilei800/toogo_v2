# HotGo_v2 å¯†ç å’Œå¯†é’¥ä¿®æ”¹æŒ‡å—

## ğŸ” éœ€è¦ä¿®æ”¹çš„å¯†ç å’Œå¯†é’¥æ¸…å•

### âš ï¸ é‡è¦ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ä»¥ä¸‹æ‰€æœ‰å¯†ç å’Œå¯†é’¥ï¼

| åºå· | å¯†ç /å¯†é’¥åç§° | ç”¨é€” | å¿…é¡»ä¿®æ”¹ | ä½ç½® |
|------|--------------|------|----------|------|
| 1 | **PostgreSQLå¯†ç ** | æ•°æ®åº“è®¿é—®å¯†ç  | âœ… å¿…é¡» | PostgreSQLé…ç½® + config.yaml |
| 2 | **Rediså¯†ç ** | ç¼“å­˜è®¿é—®å¯†ç  | âœ… å¿…é¡» | Redisé…ç½® + config.yaml |
| 3 | **TOKEN_SECRET_KEY** | ç™»å½•ä»¤ç‰Œç­¾åå¯†é’¥ | âœ… å¿…é¡» | config.yaml æˆ–ç¯å¢ƒå˜é‡ |
| 4 | **TCP_CRON_SECRET_KEY** | TCPå®šæ—¶ä»»åŠ¡å¯†é’¥ | âš ï¸ å»ºè®® | config.yaml æˆ–ç¯å¢ƒå˜é‡ |
| 5 | **TCP_AUTH_SECRET_KEY** | TCPè®¤è¯å¯†é’¥ | âš ï¸ å»ºè®® | config.yaml æˆ–ç¯å¢ƒå˜é‡ |

---

## ğŸ“ è¯¦ç»†ä¿®æ”¹æ­¥éª¤

### 1. PostgreSQL æ•°æ®åº“å¯†ç 

#### 1.1 ä¿®æ”¹PostgreSQLç”¨æˆ·å¯†ç 

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨psqlå‘½ä»¤è¡Œï¼ˆæ¨èï¼‰
sudo -u postgres psql

# åœ¨PostgreSQLå‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š
ALTER USER hotgo_user WITH PASSWORD 'ä½ çš„æ–°å¼ºå¯†ç ';
\q

# æ–¹æ³•2ï¼šä½¿ç”¨psqlå‘½ä»¤ç›´æ¥ä¿®æ”¹
sudo -u postgres psql -c "ALTER USER hotgo_user WITH PASSWORD 'ä½ çš„æ–°å¼ºå¯†ç ';"
```

**å¯†ç è¦æ±‚ï¼š**
- è‡³å°‘12ä¸ªå­—ç¬¦
- åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
- ç¤ºä¾‹ï¼š`HotGo2024!@#$Secure`

#### 1.2 æ›´æ–°é…ç½®æ–‡ä»¶

ç¼–è¾‘ `manifest/config/config.yaml`ï¼š

```yaml
database:
  default:
    link: "pgsql:hotgo_user:ä½ çš„æ–°å¯†ç @tcp(127.0.0.1:5432)/hotgo"
    # æˆ–è€…ä½¿ç”¨åˆ†ç¦»æ ¼å¼ï¼š
    host: "127.0.0.1"
    port: "5432"
    user: "hotgo_user"
    pass: "ä½ çš„æ–°å¯†ç "
    name: "hotgo"
    type: "pgsql"
```

#### 1.3 éªŒè¯ä¿®æ”¹

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -h 127.0.0.1 -U hotgo_user -d hotgo
# è¾“å…¥æ–°å¯†ç ï¼Œåº”è¯¥èƒ½æˆåŠŸè¿æ¥
```

---

### 2. Redis å¯†ç 

#### 2.1 ä¿®æ”¹Rediså¯†ç 

ç¼–è¾‘Redisé…ç½®æ–‡ä»¶ï¼š

```bash
sudo vim /etc/redis/redis.conf
```

æ‰¾åˆ° `requirepass` è¡Œï¼Œä¿®æ”¹ä¸ºï¼š

```ini
requirepass ä½ çš„æ–°Rediså¯†ç 
```

ä¿å­˜å¹¶é‡å¯Redisï¼š

```bash
sudo systemctl restart redis-server
```

#### 2.2 æ›´æ–°é…ç½®æ–‡ä»¶

ç¼–è¾‘ `manifest/config/config.yaml`ï¼š

```yaml
redis:
  default:
    address: "127.0.0.1:6379"
    db: "2"
    pass: "ä½ çš„æ–°Rediså¯†ç "
```

#### 2.3 éªŒè¯ä¿®æ”¹

```bash
redis-cli
AUTH ä½ çš„æ–°Rediså¯†ç 
PING
# åº”è¯¥è¿”å›: PONG
exit
```

---

### 3. TOKEN_SECRET_KEYï¼ˆç™»å½•ä»¤ç‰Œå¯†é’¥ï¼‰

**âš ï¸ è¿™æ˜¯æœ€é‡è¦çš„å¯†é’¥ï¼ç”¨äºç­¾åJWTä»¤ç‰Œï¼Œå¿…é¡»ä¿®æ”¹ï¼**

#### 3.1 ç”Ÿæˆå¼ºå¯†é’¥

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨opensslç”Ÿæˆ64å­—ç¬¦éšæœºå¯†é’¥
openssl rand -hex 32

# æ–¹æ³•2ï¼šä½¿ç”¨Pythonç”Ÿæˆ
python3 -c "import secrets; print(secrets.token_hex(32))"

# æ–¹æ³•3ï¼šä½¿ç”¨åœ¨çº¿å·¥å…·ç”Ÿæˆï¼ˆä¸æ¨èï¼Œå®‰å…¨æ€§è¾ƒä½ï¼‰
# è®¿é—®: https://www.random.org/strings/
```

**å¯†é’¥è¦æ±‚ï¼š**
- è‡³å°‘64ä¸ªå­—ç¬¦
- éšæœºç”Ÿæˆï¼Œä¸è¦ä½¿ç”¨å¯é¢„æµ‹çš„å€¼
- ç¤ºä¾‹è¾“å‡ºï¼š`a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6a7b8c9d0e1f2`

#### 3.2 æ›´æ–°é…ç½®æ–‡ä»¶

**æ–¹æ³•1ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼Œæ›´å®‰å…¨ï¼‰**

```bash
# ç¼–è¾‘ç³»ç»Ÿç¯å¢ƒå˜é‡æˆ–åˆ›å»º.envæ–‡ä»¶
sudo vim /etc/environment

# æ·»åŠ ï¼š
TOKEN_SECRET_KEY=ä½ ç”Ÿæˆçš„64å­—ç¬¦å¯†é’¥
```

æˆ–è€…åœ¨åº”ç”¨å¯åŠ¨è„šæœ¬ä¸­è®¾ç½®ï¼š

```bash
# ç¼–è¾‘systemdæœåŠ¡æ–‡ä»¶
sudo vim /etc/systemd/system/hotgo.service

# åœ¨[Service]éƒ¨åˆ†æ·»åŠ ï¼š
Environment="TOKEN_SECRET_KEY=ä½ ç”Ÿæˆçš„64å­—ç¬¦å¯†é’¥"
```

**æ–¹æ³•2ï¼šç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼ˆä¸æ¨èï¼Œå®‰å…¨æ€§è¾ƒä½ï¼‰**

ç¼–è¾‘ `manifest/config/config.yaml`ï¼š

```yaml
token:
  secretKey: "ä½ ç”Ÿæˆçš„64å­—ç¬¦å¯†é’¥"  # ç›´æ¥å†™å¯†é’¥ï¼ˆä¸æ¨èï¼‰
  # æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰ï¼š
  # secretKey: "${TOKEN_SECRET_KEY:é»˜è®¤å¯†é’¥}"  # å¦‚æœç¯å¢ƒå˜é‡ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤å€¼
```

#### 3.3 é‡å¯æœåŠ¡

```bash
sudo systemctl restart hotgo
```

---

### 4. TCP_CRON_SECRET_KEYï¼ˆTCPå®šæ—¶ä»»åŠ¡å¯†é’¥ï¼‰

#### 4.1 ç”Ÿæˆå¯†é’¥

```bash
# ç”Ÿæˆ32å­—ç¬¦å¯†é’¥
openssl rand -hex 16
```

#### 4.2 æ›´æ–°é…ç½®

**ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰ï¼š**

```bash
# åœ¨ç¯å¢ƒå˜é‡æˆ–systemdæœåŠ¡æ–‡ä»¶ä¸­æ·»åŠ 
TCP_CRON_SECRET_KEY=ä½ ç”Ÿæˆçš„å¯†é’¥
```

**æˆ–åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼š**

```yaml
tcp:
  client:
    cron:
      secretKey: "${TCP_CRON_SECRET_KEY:ä½ ç”Ÿæˆçš„å¯†é’¥}"
```

---

### 5. TCP_AUTH_SECRET_KEYï¼ˆTCPè®¤è¯å¯†é’¥ï¼‰

#### 5.1 ç”Ÿæˆå¯†é’¥

```bash
# ç”Ÿæˆ32å­—ç¬¦å¯†é’¥
openssl rand -hex 16
```

#### 5.2 æ›´æ–°é…ç½®

**ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰ï¼š**

```bash
# åœ¨ç¯å¢ƒå˜é‡æˆ–systemdæœåŠ¡æ–‡ä»¶ä¸­æ·»åŠ 
TCP_AUTH_SECRET_KEY=ä½ ç”Ÿæˆçš„å¯†é’¥
```

**æˆ–åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼š**

```yaml
tcp:
  client:
    auth:
      secretKey: "${TCP_AUTH_SECRET_KEY:ä½ ç”Ÿæˆçš„å¯†é’¥}"
```

---

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

### 1. å¯†ç å¼ºåº¦è¦æ±‚

æ‰€æœ‰å¯†ç åº”æ»¡è¶³ï¼š
- âœ… è‡³å°‘12ä¸ªå­—ç¬¦ï¼ˆå¯†é’¥è‡³å°‘32å­—ç¬¦ï¼‰
- âœ… åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
- âœ… ä¸ä½¿ç”¨å­—å…¸è¯æ±‡ã€ä¸ªäººä¿¡æ¯
- âœ… å®šæœŸæ›´æ¢ï¼ˆå»ºè®®æ¯3-6ä¸ªæœˆï¼‰

### 2. å¯†ç å­˜å‚¨æ–¹å¼

**æ¨èé¡ºåºï¼š**

1. **ç¯å¢ƒå˜é‡**ï¼ˆæœ€å®‰å…¨ï¼‰
   - ä¸å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­
   - å¯ä»¥é€šè¿‡systemdã€Dockerç­‰ç®¡ç†

2. **é…ç½®æ–‡ä»¶**ï¼ˆæ¬¡å®‰å…¨ï¼‰
   - ç¡®ä¿é…ç½®æ–‡ä»¶æƒé™ï¼š`chmod 600 config.yaml`
   - ä¸è¦æäº¤åˆ°Gitä»“åº“

3. **.envæ–‡ä»¶**ï¼ˆä¸­ç­‰å®‰å…¨ï¼‰
   - ç¡®ä¿`.env`æ–‡ä»¶æƒé™ï¼š`chmod 600 .env`
   - æ·»åŠ åˆ°`.gitignore`

### 3. é…ç½®æ–‡ä»¶æƒé™è®¾ç½®

```bash
# è®¾ç½®é…ç½®æ–‡ä»¶æƒé™ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰
chmod 600 /opt/hotgo/hotgo_v2/server/manifest/config/config.yaml

# ç¡®ä¿æ—¥å¿—ç›®å½•æƒé™æ­£ç¡®
chmod 755 /opt/hotgo/hotgo_v2/server/logs
```

---

## ğŸ“‹ å¿«é€Ÿä¿®æ”¹æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰è¯·ç¡®è®¤ï¼š

- [ ] PostgreSQLå¯†ç å·²ä¿®æ”¹ï¼ˆæ•°æ®åº“ + config.yamlï¼‰
- [ ] Rediså¯†ç å·²ä¿®æ”¹ï¼ˆredis.conf + config.yamlï¼‰
- [ ] TOKEN_SECRET_KEYå·²ç”Ÿæˆå¹¶é…ç½®ï¼ˆ64å­—ç¬¦éšæœºå¯†é’¥ï¼‰
- [ ] TCP_CRON_SECRET_KEYå·²ç”Ÿæˆå¹¶é…ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] TCP_AUTH_SECRET_KEYå·²ç”Ÿæˆå¹¶é…ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] é…ç½®æ–‡ä»¶æƒé™å·²è®¾ç½®ï¼ˆchmod 600ï¼‰
- [ ] æ‰€æœ‰å¯†ç å·²è®°å½•åœ¨å®‰å…¨çš„åœ°æ–¹ï¼ˆå¯†ç ç®¡ç†å™¨ï¼‰
- [ ] æµ‹è¯•æ‰€æœ‰æœåŠ¡è¿æ¥æ­£å¸¸

---

## ğŸ› ï¸ ä¸€é”®ä¿®æ”¹è„šæœ¬

åˆ›å»ºå¯†ç ä¿®æ”¹è„šæœ¬ `change_passwords.sh`ï¼š

```bash
#!/bin/bash
# HotGo å¯†ç ä¿®æ”¹è„šæœ¬

set -e

echo "=========================================="
echo "  HotGo å¯†ç ä¿®æ”¹å·¥å…·"
echo "=========================================="
echo ""

# 1. PostgreSQLå¯†ç 
read -sp "è¯·è¾“å…¥æ–°çš„PostgreSQLå¯†ç : " PG_PASSWORD
echo ""
sudo -u postgres psql -c "ALTER USER hotgo_user WITH PASSWORD '$PG_PASSWORD';"

# 2. Rediså¯†ç 
read -sp "è¯·è¾“å…¥æ–°çš„Rediså¯†ç : " REDIS_PASSWORD
echo ""
sudo sed -i "s/^requirepass.*/requirepass $REDIS_PASSWORD/" /etc/redis/redis.conf
sudo systemctl restart redis-server

# 3. ç”ŸæˆTOKENå¯†é’¥
echo "æ­£åœ¨ç”ŸæˆTOKEN_SECRET_KEY..."
TOKEN_KEY=$(openssl rand -hex 32)
echo "ç”Ÿæˆçš„TOKENå¯†é’¥: $TOKEN_KEY"
echo "è¯·å°†æ­¤å¯†é’¥æ·»åŠ åˆ°ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶ä¸­"

# 4. æ›´æ–°é…ç½®æ–‡ä»¶
CONFIG_FILE="/opt/hotgo/hotgo_v2/server/manifest/config/config.yaml"
if [ -f "$CONFIG_FILE" ]; then
    read -p "æ˜¯å¦æ›´æ–°é…ç½®æ–‡ä»¶? (y/n): " UPDATE_CONFIG
    if [ "$UPDATE_CONFIG" = "y" ]; then
        # å¤‡ä»½åŸé…ç½®
        cp "$CONFIG_FILE" "${CONFIG_FILE}.backup.$(date +%Y%m%d_%H%M%S)"
        
        # æ›´æ–°å¯†ç ï¼ˆéœ€è¦æ ¹æ®å®é™…é…ç½®æ–‡ä»¶æ ¼å¼è°ƒæ•´ï¼‰
        # sed -i "s/pass:.*/pass: \"$REDIS_PASSWORD\"/" "$CONFIG_FILE"
        echo "é…ç½®æ–‡ä»¶å·²å¤‡ä»½ï¼Œè¯·æ‰‹åŠ¨æ›´æ–°å¯†ç "
    fi
fi

echo ""
echo "âœ… å¯†ç ä¿®æ”¹å®Œæˆï¼"
echo "âš ï¸  è¯·è®°å¾—ï¼š"
echo "   1. æ›´æ–° config.yaml ä¸­çš„å¯†ç "
echo "   2. è®¾ç½® TOKEN_SECRET_KEY ç¯å¢ƒå˜é‡"
echo "   3. é‡å¯æœåŠ¡: sudo systemctl restart hotgo"
```

---

## ğŸ” éªŒè¯æ‰€æœ‰å¯†ç é…ç½®

### æ£€æŸ¥è„šæœ¬

```bash
#!/bin/bash
# éªŒè¯å¯†ç é…ç½®è„šæœ¬

echo "æ£€æŸ¥å¯†ç é…ç½®..."

# 1. æ£€æŸ¥PostgreSQLè¿æ¥
echo -n "PostgreSQLè¿æ¥: "
psql -h 127.0.0.1 -U hotgo_user -d hotgo -c "SELECT 1;" > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "âœ… æ­£å¸¸"
else
    echo "âŒ å¤±è´¥"
fi

# 2. æ£€æŸ¥Redisè¿æ¥
echo -n "Redisè¿æ¥: "
redis-cli PING > /dev/null 2>&1
if [ $? -eq 0 ]; then
    echo "âœ… æ­£å¸¸"
else
    echo "âŒ å¤±è´¥"
fi

# 3. æ£€æŸ¥é…ç½®æ–‡ä»¶æƒé™
CONFIG_FILE="/opt/hotgo/hotgo_v2/server/manifest/config/config.yaml"
if [ -f "$CONFIG_FILE" ]; then
    PERM=$(stat -c "%a" "$CONFIG_FILE")
    if [ "$PERM" = "600" ]; then
        echo "âœ… é…ç½®æ–‡ä»¶æƒé™æ­£ç¡®: $PERM"
    else
        echo "âš ï¸  é…ç½®æ–‡ä»¶æƒé™: $PERM (å»ºè®®600)"
    fi
fi

# 4. æ£€æŸ¥ç¯å¢ƒå˜é‡
if [ -n "$TOKEN_SECRET_KEY" ]; then
    echo "âœ… TOKEN_SECRET_KEYå·²è®¾ç½®"
else
    echo "âš ï¸  TOKEN_SECRET_KEYæœªè®¾ç½®ï¼ˆæ£€æŸ¥é…ç½®æ–‡ä»¶ï¼‰"
fi

echo ""
echo "æ£€æŸ¥å®Œæˆï¼"
```

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: å¿˜è®°å¯†ç æ€ä¹ˆåŠï¼Ÿ

**PostgreSQLå¯†ç é‡ç½®ï¼š**
```bash
# ä½¿ç”¨postgresè¶…çº§ç”¨æˆ·é‡ç½®
sudo -u postgres psql
ALTER USER hotgo_user WITH PASSWORD 'æ–°å¯†ç ';
\q
```

**Rediså¯†ç é‡ç½®ï¼š**
```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo vim /etc/redis/redis.conf
# ä¿®æ”¹requirepassè¡Œ
sudo systemctl restart redis-server
```

### Q2: ä¿®æ”¹å¯†ç åæœåŠ¡æ— æ³•å¯åŠ¨ï¼Ÿ

1. æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„å¯†ç æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®
3. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼š`sudo journalctl -u hotgo -f`

### Q3: å¦‚ä½•å®‰å…¨åœ°å¤‡ä»½å¯†ç ï¼Ÿ

- ä½¿ç”¨å¯†ç ç®¡ç†å™¨ï¼ˆå¦‚1Passwordã€LastPassï¼‰
- åŠ å¯†å­˜å‚¨
- ä¸è¦å­˜å‚¨åœ¨ä»£ç ä»“åº“ä¸­
- é™åˆ¶è®¿é—®æƒé™

---

## ğŸ” å¯†ç ç”Ÿæˆå·¥å…·æ¨è

### å‘½ä»¤è¡Œå·¥å…·

```bash
# OpenSSLï¼ˆæ¨èï¼‰
openssl rand -hex 32

# Python
python3 -c "import secrets; print(secrets.token_hex(32))"

# /dev/urandom
cat /dev/urandom | tr -dc 'a-zA-Z0-9!@#$%^&*' | fold -w 32 | head -n 1
```

### åœ¨çº¿å·¥å…·ï¼ˆä¸æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

- https://www.random.org/strings/
- https://passwordsgenerator.net/

---

**æœ€åæ›´æ–°**: 2025-01-XX  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
