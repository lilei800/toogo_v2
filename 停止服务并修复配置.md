# åœæ­¢æœåŠ¡å¹¶ä¿®å¤é…ç½®

## ğŸ›‘ ç«‹å³åœæ­¢æœåŠ¡

æœåŠ¡ä¸€ç›´åœ¨é‡å¯ï¼Œéœ€è¦å…ˆåœæ­¢ï¼š

```bash
# åœæ­¢æœåŠ¡ï¼ˆé˜²æ­¢ä¸€ç›´é‡å¯ï¼‰
sudo systemctl stop toogo

# ç¦ç”¨è‡ªåŠ¨é‡å¯ï¼ˆä¸´æ—¶ï¼‰
sudo systemctl disable toogo

# ç¡®è®¤æœåŠ¡å·²åœæ­¢
sudo systemctl status toogo
```

---

## ğŸ” æ£€æŸ¥é…ç½®æ–‡ä»¶

```bash
# æŸ¥çœ‹ç¬¬116è¡Œå’Œç¬¬123è¡Œé™„è¿‘
cd /opt/toogo/toogo_v2/server/manifest/config
sed -n '115,125p' config.yaml

# æ£€æŸ¥ç¬¬116è¡Œæ˜¯å¦æœ‰ç»“æŸå¼•å·
sed -n '116p' config.yaml | cat -A
# åº”è¯¥ä»¥ " ç»“å°¾

# æ£€æŸ¥ç¬¬123è¡Œ
sed -n '123p' config.yaml | cat -A
```

---

## âœ… ä¿®å¤é…ç½®æ–‡ä»¶

### æ–¹æ³•1ï¼šç›´æ¥ä¿®å¤ç¬¬116è¡Œ

```bash
sudo systemctl stop toogo
cd /opt/toogo/toogo_v2/server/manifest/config

# ä¿®å¤ç¬¬116è¡Œï¼ˆæ·»åŠ ç»“æŸå¼•å·ï¼‰
sed -i '116s/$/"/' config.yaml

# æˆ–æ›¿æ¢æ•´è¡Œ
sed -i '116s/.*/  description: "Toogo.Ai å…¨è‡ªåŠ¨è™šæ‹Ÿè´§å¸é‡åŒ–äº¤æ˜“å¹³å°"/' config.yaml

# éªŒè¯
sed -n '115,118p' config.yaml
```

### æ–¹æ³•2ï¼šä»GitHubæ‹‰å–æœ€æ–°ä»£ç å¹¶é‡æ–°åˆ›å»ºé…ç½®

```bash
sudo systemctl stop toogo

# æ‹‰å–æœ€æ–°ä»£ç 
cd /opt/toogo/toogo_v2
git pull origin main

# é‡æ–°åˆ›å»ºé…ç½®æ–‡ä»¶
cd server
cp manifest/config/config.example.yaml manifest/config/config.yaml

# ä¿®æ”¹å…³é”®é…ç½®
sed -i 's|pgsql:postgres:postgres@tcp(127.0.0.1:5432)/hotgo|pgsql:hotgo_user:Toogo2027!@#$888@tcp(127.0.0.1:5432)/hotgo|g' manifest/config/config.yaml
sed -i 's|pass: "${REDIS_PASSWORD:}"|pass: "Redis2027!@#$888"|g' manifest/config/config.yaml
sed -i 's|address: ":8000"|address: "127.0.0.1:8000"|g' manifest/config/config.yaml

# éªŒè¯YAMLè¯­æ³•ï¼ˆå¦‚æœå®‰è£…äº†Python3ï¼‰
python3 -c "import yaml; yaml.safe_load(open('manifest/config/config.yaml'))" && echo "âœ… YAMLæ­£ç¡®" || echo "âŒ YAMLé”™è¯¯"
```

---

## ğŸš€ ä¸€é”®ä¿®å¤è„šæœ¬

```bash
cat > /tmp/fix_config_final.sh << 'EOF'
#!/bin/bash
set -e

echo "åœæ­¢æœåŠ¡..."
sudo systemctl stop toogo
sudo systemctl disable toogo 2>/dev/null || true

echo "æ‹‰å–æœ€æ–°ä»£ç ..."
cd /opt/toogo/toogo_v2
git pull origin main

echo "é‡æ–°åˆ›å»ºé…ç½®æ–‡ä»¶..."
cd server
cp manifest/config/config.example.yaml manifest/config/config.yaml

echo "ä¿®æ”¹å…³é”®é…ç½®..."
sed -i 's|pgsql:postgres:postgres@tcp(127.0.0.1:5432)/hotgo|pgsql:hotgo_user:Toogo2027!@#$888@tcp(127.0.0.1:5432)/hotgo|g' manifest/config/config.yaml
sed -i 's|pass: "${REDIS_PASSWORD:}"|pass: "Redis2027!@#$888"|g' manifest/config/config.yaml
sed -i 's|address: ":8000"|address: "127.0.0.1:8000"|g' manifest/config/config.yaml

echo "éªŒè¯é…ç½®æ–‡ä»¶..."
if command -v python3 &> /dev/null; then
    if python3 -c "import yaml; yaml.safe_load(open('manifest/config/config.yaml'))" 2>/dev/null; then
        echo "âœ… YAMLè¯­æ³•æ­£ç¡®"
    else
        echo "âŒ YAMLè¯­æ³•é”™è¯¯ï¼š"
        python3 -c "import yaml; yaml.safe_load(open('manifest/config/config.yaml'))" 2>&1 | head -5
        exit 1
    fi
else
    echo "âš ï¸  Python3æœªå®‰è£…ï¼Œè·³è¿‡YAMLéªŒè¯"
fi

echo "å¯ç”¨æœåŠ¡..."
sudo systemctl enable toogo

echo "å¯åŠ¨æœåŠ¡..."
sudo systemctl start toogo

echo "æŸ¥çœ‹æœåŠ¡çŠ¶æ€..."
sleep 2
sudo systemctl status toogo --no-pager -l

echo ""
echo "âœ… ä¿®å¤å®Œæˆï¼"
echo "æŸ¥çœ‹æ—¥å¿—: sudo journalctl -u toogo -f"
EOF

chmod +x /tmp/fix_config_final.sh
bash /tmp/fix_config_final.sh
```

---

## ğŸ“‹ æ‰‹åŠ¨æ£€æŸ¥æ­¥éª¤

å¦‚æœè‡ªåŠ¨ä¿®å¤ä¸è¡Œï¼Œæ‰‹åŠ¨æ£€æŸ¥ï¼š

```bash
# 1. åœæ­¢æœåŠ¡
sudo systemctl stop toogo

# 2. æŸ¥çœ‹ç¬¬116è¡Œ
sed -n '116p' /opt/toogo/toogo_v2/server/manifest/config/config.yaml

# 3. æŸ¥çœ‹ç¬¬123è¡Œ
sed -n '123p' /opt/toogo/toogo_v2/server/manifest/config/config.yaml

# 4. æŸ¥çœ‹ç¬¬116-125è¡Œ
sed -n '116,125p' /opt/toogo/toogo_v2/server/manifest/config/config.yaml

# 5. æ‰‹åŠ¨ç¼–è¾‘
vim /opt/toogo/toogo_v2/server/manifest/config/config.yaml
```

---

**å…ˆåœæ­¢æœåŠ¡ï¼Œç„¶åä¿®å¤é…ç½®æ–‡ä»¶ï¼** ğŸ›‘
