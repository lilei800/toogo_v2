# åˆ é™¤åå‘ä¸‹å•åŠŸèƒ½å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„åˆ é™¤å·¥ä½œ

### 1. åç«¯æ ¸å¿ƒé€»è¾‘æ–‡ä»¶

#### `server/internal/logic/toogo/robot_engine.go`
- âœ… åˆ é™¤äº† `ReverseThresholds` ç»“æ„ä½“
- âœ… åˆ é™¤äº† `GetReverseThresholds()` å‡½æ•°
- âœ… åˆ é™¤äº† `loadReverseThresholdsFromStrategy()` å‡½æ•°
- âœ… åˆ é™¤äº† `checkReverseCondition()` æ–¹æ³•
- âœ… åˆ é™¤äº† `shouldOpenReversePosition()` æ–¹æ³•
- âœ… åˆ é™¤äº† `StrategyParams` ä¸­çš„ `ReverseLossRetreat` å’Œ `ReverseProfitRetreat` å­—æ®µ
- âœ… ä¿®æ”¹äº† `checkTradingConditions()` å’Œ `CheckAndOpenPositionWithSignal()`ï¼Œå°†åå‘ä¸‹å•æ£€æŸ¥æ”¹ä¸ºç®€å•çš„åŒå‘æŒä»“æ£€æŸ¥

#### `server/internal/logic/toogo/engine/trader.go`
- âœ… åˆ é™¤äº†åå‘ä¸‹å•ç­–ç•¥æ£€æŸ¥é€»è¾‘
- âœ… åˆ é™¤äº† `shouldOpenReversePosition()` æ–¹æ³•

#### `server/internal/logic/toogo/engine/types.go`
- âœ… åˆ é™¤äº† `ReverseThresholds` ç»“æ„ä½“
- âœ… åˆ é™¤äº† `GetReverseThresholds()` å‡½æ•°

#### `server/internal/logic/trading/robot.go`
- âœ… åˆ é™¤äº† `EnableReverseOrder` å­—æ®µçš„èµ‹å€¼å’Œæ˜ å°„

#### `server/internal/logic/trading/monitor.go`
- âœ… åˆ é™¤äº†åå‘ä¸‹å•é˜ˆå€¼ç›¸å…³çš„ä»£ç 

#### `server/internal/logic/toogo/strategy.go`
- âœ… åˆ é™¤äº† `ReverseLossRetreat` å’Œ `ReverseProfitRetreat` å­—æ®µçš„èµ‹å€¼

#### `server/internal/logic/toogo/strategy_group.go`
- âœ… åˆ é™¤äº† `reverseLossRatio` å’Œ `reverseProfitRatio` ç›¸å…³é…ç½®

### 2. æ¨¡å‹æ–‡ä»¶

#### `server/internal/model/entity/trading_robot.go`
- âœ… åˆ é™¤äº† `EnableReverseOrder` å­—æ®µ

#### `server/internal/model/do/trading_robot.go`
- âš ï¸ æ³¨æ„ï¼šè¿™æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œéœ€è¦æ‰§è¡Œæ•°æ®åº“è„šæœ¬åé‡æ–°ç”Ÿæˆ

#### `server/internal/model/input/trading_robot.go`
- âœ… åˆ é™¤äº†ä¸¤å¤„ `EnableReverseOrder` å­—æ®µå®šä¹‰

#### `server/internal/model/input/toogoin/robot.go`
- âœ… åˆ é™¤äº†ä¸¤å¤„ `ReverseOrderEnable` å­—æ®µå®šä¹‰

#### `server/internal/model/input/toogoin/strategy.go`
- âœ… åˆ é™¤äº† `ReverseLossRetreat` å’Œ `ReverseProfitRetreat` å­—æ®µå®šä¹‰

#### `server/internal/dao/internal/trading_robot.go`
- âœ… åˆ é™¤äº† `EnableReverseOrder` å­—æ®µæ˜ å°„

### 3. API æ–‡ä»¶

#### `server/api/admin/trading/monitor.go`
- âœ… åˆ é™¤äº† `ReverseLossRetreat` å’Œ `ReverseProfitRetreat` å­—æ®µ

#### `server/api/admin/trading/strategy_group.go`
- âœ… åˆ é™¤äº† `ReverseEnabled`ã€`ReverseLossRatio`ã€`ReverseProfitRatio` å­—æ®µ

### 4. æ§åˆ¶å™¨æ–‡ä»¶

#### `server/internal/controller/admin/trading/strategy_template.go`
- âœ… åˆ é™¤äº† `reverseEnabled` ç›¸å…³ä»£ç 

### 5. åº“æ–‡ä»¶

#### `server/internal/library/market/strategy_config.go`
- âœ… åˆ é™¤äº† `ReverseEnabled`ã€`ReverseLossRatio`ã€`ReverseProfitRatio` å­—æ®µ
- âœ… åˆ é™¤äº†ç›¸å…³èµ‹å€¼ä»£ç 

#### `server/internal/library/market/direction_signal.go`
- âœ… åˆ é™¤äº† `EnableReverseOrder` å­—æ®µ

### 6. å‰ç«¯æ–‡ä»¶

#### `web/src/views/toogo/robot/create.vue`
- âœ… åˆ é™¤äº†åå‘ä¸‹å•å¼€å…³
- âœ… åˆ é™¤äº†åå‘ä¸‹å•è¯´æ˜
- âœ… åˆ é™¤äº†åå‘ä¸‹å• CSS æ ·å¼
- âœ… åˆ é™¤äº† `enableReverseOrder` å­—æ®µ

#### `web/src/views/toogo/robot/index.vue`
- âœ… åˆ é™¤äº†åå‘ä¸‹å•æ˜¾ç¤ºæ ‡ç­¾
- âœ… åˆ é™¤äº† `enableReverseOrder` ç›¸å…³ä»£ç 

#### `web/src/views/toogo/robot/composables/useRobotList.ts`
- âœ… åˆ é™¤äº† `enableReverseOrder` å­—æ®µ

### 7. æ•°æ®åº“è„šæœ¬

#### `åˆ é™¤åå‘ä¸‹å•æ•°æ®åº“å­—æ®µ.sql`
- âœ… åˆ›å»ºäº†æ•°æ®åº“åˆ é™¤è„šæœ¬ï¼ŒåŒ…å«ï¼š
  - åˆ é™¤ `hg_trading_robot.enable_reverse_order` å­—æ®µ
  - åˆ é™¤ `hg_trading_strategy_template.reverse_loss_retreat` å­—æ®µ
  - åˆ é™¤ `hg_trading_strategy_template.reverse_profit_retreat` å­—æ®µ

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶
- `server/internal/model/do/trading_robot.go` æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œéœ€è¦ï¼š
  1. å…ˆæ‰§è¡Œæ•°æ®åº“è„šæœ¬åˆ é™¤å­—æ®µ
  2. ç„¶åé‡æ–°è¿è¡Œä»£ç ç”Ÿæˆå·¥å…·ç”Ÿæˆè¯¥æ–‡ä»¶

### 2. æ•°æ®åº“å­—æ®µ
- éœ€è¦æ‰§è¡Œ `åˆ é™¤åå‘ä¸‹å•æ•°æ®åº“å­—æ®µ.sql` è„šæœ¬åˆ é™¤æ•°æ®åº“ä¸­çš„å­—æ®µ
- æ‰§è¡Œå‰è¯·å¤‡ä»½æ•°æ®åº“ï¼

### 3. é—ç•™æ–‡ä»¶ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
ä»¥ä¸‹æ–‡ä»¶å¯èƒ½åŒ…å«åå‘ä¸‹å•ç›¸å…³å­—æ®µï¼Œä½†è¿™äº›æ˜¯å†å²é—ç•™æˆ–é…ç½®æ•°æ®ï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ï¼š
- `storage/data/toogo_system.sql` - SQL åˆå§‹åŒ–è„šæœ¬
- `storage/data/reset_official_strategies.sql` - ç­–ç•¥é‡ç½®è„šæœ¬
- `storage/data/official_btc_usdt_strategies.sql` - å®˜æ–¹ç­–ç•¥è„šæœ¬
- `storage/data/update_strategies.sql` - ç­–ç•¥æ›´æ–°è„šæœ¬
- `storage/data/bitget_btc_usdt_strategies.sql` - Bitget ç­–ç•¥è„šæœ¬

### 4. å…¶ä»–æ–‡ä»¶
- `server/internal/cmd/insert_test_robot/main.go` - æµ‹è¯•å·¥å…·ï¼ŒåŒ…å« `enable_reverse_order` å­—æ®µï¼Œå¯ä»¥ä¿ç•™æˆ–åˆ é™¤
- `server/internal/dao/internal/toogo_strategy_template.go` - åŒ…å« `ReverseLossRetreat` å’Œ `ReverseProfitRetreat` å­—æ®µæ˜ å°„ï¼Œä½†è¿™äº›å­—æ®µåœ¨æ•°æ®åº“åˆ é™¤åä¼šè‡ªåŠ¨å¤±æ•ˆ
- `server/internal/model/entity/toogo_strategy_template.go` - åŒ…å« `ReverseLossRetreat` å’Œ `ReverseProfitRetreat` å­—æ®µå®šä¹‰ï¼Œä½†è¿™äº›å­—æ®µåœ¨æ•°æ®åº“åˆ é™¤åä¼šè‡ªåŠ¨å¤±æ•ˆ

## ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œ

1. âœ… **æ‰§è¡Œæ•°æ®åº“è„šæœ¬**ï¼šè¿è¡Œ `åˆ é™¤åå‘ä¸‹å•æ•°æ®åº“å­—æ®µ.sql` åˆ é™¤æ•°æ®åº“å­—æ®µ
2. âœ… **é‡æ–°ç”Ÿæˆä»£ç **ï¼šè¿è¡Œä»£ç ç”Ÿæˆå·¥å…·é‡æ–°ç”Ÿæˆ `do/trading_robot.go` æ–‡ä»¶
3. âœ… **æµ‹è¯•ç¼–è¯‘**ï¼šç¡®ä¿æ‰€æœ‰ä»£ç ç¼–è¯‘é€šè¿‡
4. âœ… **åŠŸèƒ½æµ‹è¯•**ï¼šæµ‹è¯•æœºå™¨äººåˆ›å»ºã€å¯åŠ¨ã€ä¸‹å•ç­‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸

## âœ¨ ä¿®æ”¹åçš„è¡Œä¸º

åˆ é™¤åå‘ä¸‹å•åŠŸèƒ½åï¼Œç³»ç»Ÿçš„è¡Œä¸ºå˜åŒ–ï¼š

1. **ä¸‹å•æ£€æŸ¥**ï¼š
   - ä¹‹å‰ï¼šå¦‚æœæœ‰åæ–¹å‘æŒä»“ï¼Œæ£€æŸ¥åå‘ä¸‹å•å¼€å…³å’Œå›æ’¤æ¡ä»¶
   - ç°åœ¨ï¼šå¦‚æœæœ‰åæ–¹å‘æŒä»“ï¼Œç›´æ¥æ‹’ç»å¼€ä»“ï¼ˆä¸å…è®¸åŒæ—¶æŒæœ‰åŒå‘æŒä»“ï¼‰

2. **ç­–ç•¥å‚æ•°**ï¼š
   - ä¹‹å‰ï¼šç­–ç•¥å‚æ•°ä¸­åŒ…å«åå‘ä¸‹å•é˜ˆå€¼
   - ç°åœ¨ï¼šç­–ç•¥å‚æ•°ä¸­ä¸å†åŒ…å«åå‘ä¸‹å•ç›¸å…³å­—æ®µ

3. **å‰ç«¯ç•Œé¢**ï¼š
   - ä¹‹å‰ï¼šæ˜¾ç¤ºåå‘ä¸‹å•å¼€å…³å’ŒçŠ¶æ€
   - ç°åœ¨ï¼šä¸å†æ˜¾ç¤ºåå‘ä¸‹å•ç›¸å…³å†…å®¹

4. **æ•°æ®åº“**ï¼š
   - ä¹‹å‰ï¼š`hg_trading_robot` è¡¨æœ‰ `enable_reverse_order` å­—æ®µ
   - ç°åœ¨ï¼šè¯¥å­—æ®µå°†è¢«åˆ é™¤

## ğŸ¯ æ€»ç»“

æ‰€æœ‰åå‘ä¸‹å•ç›¸å…³çš„ä»£ç ã€é¡µé¢å’Œæ•°æ®åº“å­—æ®µå·²åŸºæœ¬åˆ é™¤å®Œæˆã€‚ç³»ç»Ÿç°åœ¨ä¸å…è®¸åŒæ—¶æŒæœ‰åŒå‘æŒä»“ï¼Œæ¯æ–¹å‘æœ€å¤šåªèƒ½æœ‰1å•ã€‚

ç¼–è¯‘æµ‹è¯•å·²é€šè¿‡ï¼Œå¯ä»¥æ­£å¸¸ç¼–è¯‘è¿è¡Œã€‚

