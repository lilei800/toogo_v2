# HotGo 热更新启动指南

> **重要提示**: HotGo 框架基于 GoFrame，**自带热更新功能**，无需安装额外工具！

## 一、使用 GoFrame 内置热更新（推荐，框架自带）

HotGo 框架基于 GoFrame，GoFrame 提供了内置的热更新功能，**无需安装任何额外工具**。

### 1.1 安装 Air

```bash
# 方式1：使用 go install（推荐）
go install github.com/cosmtrek/air@latest

# 方式2：使用 go get（旧版本）
go get -u github.com/cosmtrek/air

# 方式3：使用包管理器（Windows）
# 使用 Chocolatey
choco install air

# 使用 Scoop
scoop install air
```

### 1.2 验证安装

```bash
air -v
```

### 1.3 使用 Air 启动

```bash
# 在项目根目录执行
cd D:\go\src\hotgo_v2
air

# 或者指定配置文件
air -c .air.toml
```

---

### 1.1 使用 gf run 命令（最简单）

```bash
# 进入 server 目录
cd D:\go\src\hotgo_v2\server

# 启动所有服务（热更新）
gf run main.go

# 只启动 HTTP 服务（热更新）
gf run main.go --args "http"

# 只启动消息队列（热更新）
gf run main.go --args "queue"

# 只启动定时任务（热更新）
gf run main.go --args "cron"
```

### 1.2 使用 Makefile（快捷方式）

```bash
# 进入 server 目录
cd D:\go\src\hotgo_v2\server

# 启动所有服务（热更新）
make all

# 启动 HTTP 服务（热更新）
make http

# 启动消息队列（热更新）
make queue

# 启动定时任务（热更新）
make cron
```

### 1.3 使用批处理脚本（Windows）

```bash
# 双击运行或在命令行执行
启动热更新-GoFrame.bat
```

---

## 二、使用 Air 热更新工具（可选，第三方工具）

---

## 三、使用 Air 配置文件（已创建）

### 3.1 配置文件位置

项目根目录已创建 `.air.toml` 配置文件，包含以下配置：

- **编译命令**: `go build -o ./tmp/main ./server/main.go`
- **排除目录**: `web`, `web_backup_old`, `docs`, `scripts` 等
- **监听文件类型**: `.go`, `.tpl`, `.tmpl`, `.html`
- **输出目录**: `./tmp/main`

### 3.2 自定义配置

如果需要修改配置，编辑 `.air.toml` 文件：

```toml
[build]
  # 修改编译命令
  cmd = "go build -o ./tmp/main ./server/main.go"
  
  # 修改排除目录
  exclude_dir = ["assets", "tmp", "vendor", "testdata", "web"]
  
  # 修改监听文件类型
  include_ext = ["go", "tpl", "tmpl", "html"]
```

---

## 四、启动方式对比

### 4.1 Air vs GoFrame

| 特性 | Air | GoFrame (gf run) |
|------|-----|------------------|
| **安装** | 需要单独安装 | ✅ **框架自带，无需安装** |
| **配置** | 需要配置文件 | ✅ **无需配置，开箱即用** |
| **功能** | 功能丰富 | 简单易用，满足日常开发 |
| **推荐** | 需要更多控制时 | ✅ **推荐：HotGo 官方推荐** |

### 4.2 推荐使用场景

- **GoFrame (gf run)**: ✅ **推荐** - HotGo 框架自带，开箱即用，满足大部分开发需求
- **Air**: 可选 - 需要自定义编译参数、排除规则等复杂场景

---

## 五、快速启动命令

### 5.1 使用 GoFrame（推荐，框架自带）

```bash
# 1. 进入 server 目录
cd D:\go\src\hotgo_v2\server

# 2. 启动热更新（所有服务）
gf run main.go

# 3. 或只启动 HTTP 服务
gf run main.go --args "http"
```

### 5.2 使用 Air（可选，第三方工具）

```bash
# 1. 安装 Air（如果未安装）
go install github.com/cosmtrek/air@latest

# 2. 进入项目目录
cd D:\go\src\hotgo_v2

# 3. 启动热更新
air
```

---

## 六、常见问题

### 6.1 Air 未找到命令

**问题**: `air: command not found`

**解决**:
```bash
# 检查 GOPATH/bin 是否在 PATH 中
echo $GOPATH/bin  # Linux/Mac
echo %GOPATH%\bin  # Windows

# 添加到 PATH（Windows PowerShell）
$env:Path += ";$env:GOPATH\bin"

# 添加到 PATH（Windows CMD）
set PATH=%PATH%;%GOPATH%\bin
```

### 6.2 端口被占用

**问题**: `bind: address already in use`

**解决**:
```bash
# Windows: 查找占用端口的进程
netstat -ano | findstr :8000

# 杀死进程
taskkill /PID <进程ID> /F
```

### 6.3 编译错误

**问题**: Air 检测到代码变化但编译失败

**解决**:
- 检查代码语法错误
- 查看 `build-errors.log` 文件
- 确保所有依赖已安装：`go mod download`

---

## 七、开发建议

### 7.1 推荐工作流程

1. **启动热更新**: 使用 `air` 或 `gf run main.go`
2. **修改代码**: 保存文件后自动重新编译运行
3. **查看日志**: 观察控制台输出，确认代码已更新
4. **测试功能**: 验证修改是否生效

### 7.2 注意事项

- ✅ **保存文件**: 修改代码后保存文件，Air 会自动检测
- ✅ **编译时间**: 首次编译可能需要几秒钟
- ✅ **日志输出**: 关注控制台输出，确认编译成功
- ✅ **端口占用**: 确保端口未被占用

---

## 八、总结

### 8.1 推荐方式

**开发环境**: ✅ **使用 GoFrame (gf run)** - HotGo 框架自带，无需安装额外工具

**快速启动**:
```bash
# ✅ 推荐：使用 GoFrame（框架自带）
cd D:\go\src\hotgo_v2\server
gf run main.go

# 或使用批处理脚本（Windows）
启动热更新-GoFrame.bat
```

### 8.2 为什么推荐 GoFrame？

- ✅ **框架自带**: HotGo 基于 GoFrame，`gf run` 是框架内置功能
- ✅ **无需安装**: 不需要安装 Air 等第三方工具
- ✅ **开箱即用**: 无需配置文件，直接使用
- ✅ **官方推荐**: HotGo 官方文档推荐使用 `gf run`
- ✅ **简单高效**: 满足日常开发需求，代码修改后自动重新编译运行

### 8.2 配置文件

- ✅ `.air.toml`: 已创建，包含项目配置
- ✅ 可根据需要修改配置

### 8.3 优势

- ✅ **自动检测**: 代码变化自动重新编译
- ✅ **快速开发**: 无需手动重启服务
- ✅ **提高效率**: 节省开发时间

