# åˆ›å»ºæœºå™¨äººæµç¨‹é—®é¢˜åˆ†æ

## ç”¨æˆ·æå‡ºçš„5ä¸ªé—®é¢˜åˆ†æ

### 1. âœ… åŠ è½½BTCä»·æ ¼ï¼ˆç”¨äºè®¡ç®—é¢„ä¼°ä¸‹å•é‡ï¼‰ï¼Œè¿™ä¸ªæ²¡æœ‰æ„ä¹‰

**åˆ†æç»“æœï¼šæ­£ç¡®**

**é—®é¢˜æè¿°ï¼š**
- å‰ç«¯ä»£ç ä¸­å®šä¹‰äº† `btcPrice`ã€`estimatedQuantity`ã€`minOrderValue`
- ä½†å®é™…ä¸Šè¿™äº›å˜é‡åœ¨æ¨¡æ¿ä¸­**æ²¡æœ‰è¢«ä½¿ç”¨**

**ä»£ç è¯æ®ï¼š**
```javascript
// create.vue ç¬¬522-537è¡Œ
const btcPrice = ref(96000);
const minOrderValue = computed(() => 0.001 * btcPrice.value);
const estimatedQuantity = computed(() => {
  // ... è®¡ç®—é€»è¾‘
});

// ä½†åœ¨æ¨¡æ¿ä¸­æ²¡æœ‰æ‰¾åˆ°ä½¿ç”¨è¿™äº›å˜é‡çš„åœ°æ–¹
```

**ç»“è®ºï¼š**
- `loadBtcPrice()` å‡½æ•°ç¡®å®æ²¡æœ‰æ„ä¹‰
- `estimatedQuantity` å’Œ `minOrderValue` ä¹Ÿæ²¡æœ‰è¢«ä½¿ç”¨
- **å¯ä»¥åˆ é™¤è¿™äº›ä»£ç **

---

### 2. âœ… æ„å»ºè¯·æ±‚æ•°æ®åº”è¯¥ä¸éœ€è¦ï¼Œå› ä¸ºåˆ›å»ºæœºå™¨äººæ—¶å€™ä¸éœ€è¦é»˜è®¤å€¼ï¼Œå› ä¸ºè¿è¡Œæ—¶å€™ç›´æ¥ç”¨çš„å®æ—¶å€¼

**åˆ†æç»“æœï¼šéƒ¨åˆ†æ­£ç¡®**

**é—®é¢˜æè¿°ï¼š**
- å‰ç«¯åœ¨æ„å»ºè¯·æ±‚æ•°æ®æ—¶ï¼Œä¼ é€’äº†å¾ˆå¤šäº¤æ˜“å‚æ•°çš„é»˜è®¤å€¼
- ä½†è¿è¡Œæ—¶å¼•æ“ä¼šä»ç­–ç•¥æ¨¡æ¿åŠ è½½å‚æ•°ï¼Œè¿™äº›é»˜è®¤å€¼ä¼šè¢«è¦†ç›–

**ä»£ç è¯æ®ï¼š**
```javascript
// create.vue ç¬¬773-789è¡Œ
const data = {
  // ... å…¶ä»–å­—æ®µ
  // äº¤æ˜“å‚æ•°é…ç½®ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼Œè¿è¡Œæ—¶ä¼šè¢«ç­–ç•¥æ¨¡æ¿è¦†ç›–ï¼‰
  leverage: formData.value.leverage || 10,
  marginPercent: formData.value.marginPercent || 10,
  stopLossPercent: formData.value.stopLossPercent || 10,
  // ...
};
```

**è¿è¡Œæ—¶åŠ è½½é€»è¾‘ï¼š**
```go
// robot_engine.go
// è¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½å‚æ•°
strategyParams, err := e.loadFullStrategyParams(ctx, currentMarketState, riskPreference)
e.CurrentStrategyParams = strategyParams
```

**ç»“è®ºï¼š**
- **å‰ç«¯ä¸éœ€è¦ä¼ é€’è¿™äº›äº¤æ˜“å‚æ•°çš„é»˜è®¤å€¼**
- åªéœ€è¦ä¼ é€’ï¼š
  - `strategyGroupId`ï¼ˆå¿…éœ€ï¼‰
  - `marketRiskMapping`ï¼ˆå¿…éœ€ï¼‰
  - `exchange`ã€`symbol`ï¼ˆå¿…éœ€ï¼Œä½†å¯ä»¥ä»APIé…ç½®è·å–ï¼‰
  - `autoTradeEnabled`ã€`autoCloseEnabled`ï¼ˆå¼€å…³ï¼‰
  - `autoMarketState`ã€`useMonitorSignal`ï¼ˆå¼€å…³ï¼‰
  - `scheduleStart`ã€`scheduleStop`ï¼ˆå¯é€‰ï¼‰

**ä½†æ˜¯ï¼š**
- å¦‚æœæ•°æ®åº“å­—æ®µä¸å…è®¸NULLï¼Œåç«¯éœ€è¦è®¾ç½®é»˜è®¤å€¼
- éœ€è¦æ£€æŸ¥æ•°æ®åº“å­—æ®µå®šä¹‰

---

### 3. â“ åç«¯æ‰§è¡Œ--è®¾ç½®é»˜è®¤å€¼ï¼Œè¿™é‡Œä¸è®¾ç½®ä¸è¡Œå—ï¼Ÿ

**åˆ†æç»“æœï¼šéœ€è¦æ£€æŸ¥æ•°æ®åº“å­—æ®µå®šä¹‰**

**é—®é¢˜æè¿°ï¼š**
- åç«¯ä»£ç ä¸­è®¾ç½®äº†å¾ˆå¤šé»˜è®¤å€¼
- å¦‚æœæ•°æ®åº“å­—æ®µå…è®¸NULLï¼Œå¯ä»¥ä¸è®¾ç½®

**ä»£ç è¯æ®ï¼š**
```go
// robot.go ç¬¬130-163è¡Œ
if in.RiskPreference == "" {
    in.RiskPreference = "balanced"
}
if in.MarketState == "" {
    in.MarketState = "trend"
}
// ... æ›´å¤šé»˜è®¤å€¼è®¾ç½®
```

**éœ€è¦æ£€æŸ¥ï¼š**
1. æ•°æ®åº“å­—æ®µæ˜¯å¦å…è®¸NULL
2. å¦‚æœå…è®¸NULLï¼Œå¯ä»¥ä¸è®¾ç½®é»˜è®¤å€¼
3. å¦‚æœä¸å…è®¸NULLï¼Œå¿…é¡»è®¾ç½®é»˜è®¤å€¼

**å»ºè®®ï¼š**
- æ£€æŸ¥ `hg_trading_robot` è¡¨çš„å­—æ®µå®šä¹‰
- å¦‚æœå­—æ®µå…è®¸NULLï¼Œå¯ä»¥ç§»é™¤è¿™äº›é»˜è®¤å€¼è®¾ç½®
- è¿è¡Œæ—¶å¼•æ“ä¼šä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼Œä¸éœ€è¦é»˜è®¤å€¼

---

### 4. âœ… äº¤æ˜“å‚æ•°ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œåˆ›å»ºæ—¶ä¿å­˜é»˜è®¤å€¼æˆ‘è®¤ä¸ºæ²¡æœ‰å¿…è¦

**åˆ†æç»“æœï¼šæ­£ç¡®**

**é—®é¢˜æè¿°ï¼š**
- åˆ›å»ºæœºå™¨äººæ—¶ä¿å­˜çš„äº¤æ˜“å‚æ•°ï¼ˆæ æ†ã€ä¿è¯é‡‘ã€æ­¢æŸã€æ­¢ç›ˆç­‰ï¼‰åªæ˜¯é»˜è®¤å€¼
- è¿è¡Œæ—¶å¼•æ“ä¼šä»ç­–ç•¥æ¨¡æ¿é‡æ–°åŠ è½½ï¼Œè¿™äº›é»˜è®¤å€¼ä¼šè¢«è¦†ç›–

**ä»£ç è¯æ®ï¼š**
```go
// robot.go ç¬¬165-195è¡Œ
data := &do.TradingRobot{
    Leverage:                in.Leverage,        // é»˜è®¤å€¼
    MarginPercent:           in.MarginPercent,   // é»˜è®¤å€¼
    StopLossPercent:         in.StopLossPercent, // é»˜è®¤å€¼
    // ...
}

// è¿è¡Œæ—¶åŠ è½½
// robot_engine.go
strategyParams, err := e.loadFullStrategyParams(ctx, marketState, riskPreference)
e.CurrentStrategyParams = strategyParams
```

**ç»“è®ºï¼š**
- **ç¡®å®æ²¡æœ‰å¿…è¦ä¿å­˜è¿™äº›é»˜è®¤å€¼**
- è¿è¡Œæ—¶å¼•æ“ä¼šä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼Œæ•°æ®åº“ä¸­çš„å€¼ä¸ä¼šè¢«ä½¿ç”¨
- **ä½†æ˜¯**ï¼šå¦‚æœæ•°æ®åº“å­—æ®µä¸å…è®¸NULLï¼Œå¿…é¡»è®¾ç½®ä¸€ä¸ªå€¼

**å»ºè®®ï¼š**
- å¦‚æœæ•°æ®åº“å­—æ®µå…è®¸NULLï¼Œå¯ä»¥ä¸ä¿å­˜è¿™äº›å€¼
- å¦‚æœæ•°æ®åº“å­—æ®µä¸å…è®¸NULLï¼Œå¯ä»¥è®¾ç½®ä¸º0æˆ–NULLï¼ˆå¦‚æœå…è®¸ï¼‰ï¼Œè¿è¡Œæ—¶ä¼šè¢«è¦†ç›–

---

### 5. âœ… å¸‚åœºçŠ¶æ€æ˜ å°„ï¼ˆåŠ¨æ€åˆ‡æ¢ï¼‰é€»è¾‘ä¸å¯¹ï¼Œæ˜¯æ ¹æ®åˆ›å»ºæœºå™¨äººæ—¶å€™é…ç½®çš„æ˜ å°„å…³ç³»åŒ¹é…çš„

**åˆ†æç»“æœï¼šæ­£ç¡®**

**é—®é¢˜æè¿°ï¼š**
- æ–‡æ¡£ä¸­æè¿°"å¸‚åœºçŠ¶æ€æ˜ å°„ï¼ˆåŠ¨æ€åˆ‡æ¢ï¼‰"å®¹æ˜“è¯¯è§£
- å®é™…ä¸Šï¼šæ˜ å°„å…³ç³»æ˜¯åœ¨åˆ›å»ºæ—¶é…ç½®çš„ï¼Œè¿è¡Œæ—¶æ˜¯æ ¹æ®è¿™ä¸ªæ˜ å°„å…³ç³»æ¥åŒ¹é…ç­–ç•¥æ¨¡æ¿

**æ­£ç¡®çš„é€»è¾‘ï¼š**
1. **åˆ›å»ºæ—¶**ï¼šç”¨æˆ·é…ç½®å¸‚åœºçŠ¶æ€æ˜ å°„å…³ç³»
   ```json
   {
     "trend": "balanced",
     "volatile": "balanced",
     "high_vol": "aggressive",
     "low_vol": "conservative"
   }
   ```

2. **è¿è¡Œæ—¶**ï¼š
   - å®æ—¶åˆ†æå¸‚åœºçŠ¶æ€ï¼ˆä¾‹å¦‚ï¼šæ£€æµ‹åˆ° `trend`ï¼‰
   - æ ¹æ®åˆ›å»ºæ—¶é…ç½®çš„æ˜ å°„å…³ç³»ï¼Œè·å–å¯¹åº”çš„é£é™©åå¥½ï¼ˆä¾‹å¦‚ï¼š`trend` â†’ `balanced`ï¼‰
   - æ ¹æ® `groupId` + å¸‚åœºçŠ¶æ€ï¼ˆ`trend`ï¼‰+ é£é™©åå¥½ï¼ˆ`balanced`ï¼‰ï¼ŒæŸ¥è¯¢ç­–ç•¥æ¨¡æ¿
   - åŠ è½½ç­–ç•¥æ¨¡æ¿å‚æ•°

**ä»£ç è¯æ®ï¼š**
```go
// robot_engine.go ç¬¬71è¡Œ
MarketRiskMapping map[string]string // å¸‚åœºçŠ¶æ€ â†’ é£é™©åå¥½æ˜ å°„ï¼ˆä»æœºå™¨äººCurrentStrategyåŠ è½½ï¼‰

// è¿è¡Œæ—¶ä½¿ç”¨æ˜ å°„å…³ç³»
riskPreference := e.MarketRiskMapping[currentMarketState]
strategyParams, err := e.loadFullStrategyParams(ctx, currentMarketState, riskPreference)
```

**ç»“è®ºï¼š**
- **æ˜ å°„å…³ç³»æ˜¯é™æ€çš„**ï¼ˆåˆ›å»ºæ—¶é…ç½®ï¼‰
- **å¸‚åœºçŠ¶æ€æ˜¯åŠ¨æ€çš„**ï¼ˆè¿è¡Œæ—¶å®æ—¶åˆ†æï¼‰
- **æ ¹æ®æ˜ å°„å…³ç³»åŒ¹é…ç­–ç•¥æ¨¡æ¿**ï¼ˆè¿è¡Œæ—¶æ ¹æ®æ˜ å°„å…³ç³»æŸ¥è¯¢ï¼‰

**æ–‡æ¡£åº”è¯¥ä¿®æ­£ä¸ºï¼š**
- "å¸‚åœºçŠ¶æ€æ˜ å°„ï¼ˆé™æ€é…ç½®ï¼Œè¿è¡Œæ—¶æ ¹æ®æ˜ å°„å…³ç³»åŒ¹é…ç­–ç•¥æ¨¡æ¿ï¼‰"

---

## ğŸ“Š æ€»ç»“

| é—®é¢˜ | åˆ†æç»“æœ | å»ºè®® |
|------|---------|------|
| 1. åŠ è½½BTCä»·æ ¼ | âœ… æ­£ç¡®ï¼Œæ²¡æœ‰æ„ä¹‰ | åˆ é™¤ `loadBtcPrice()`ã€`estimatedQuantity`ã€`minOrderValue` |
| 2. æ„å»ºè¯·æ±‚æ•°æ®ä¸éœ€è¦é»˜è®¤å€¼ | âœ… éƒ¨åˆ†æ­£ç¡® | å‰ç«¯åªä¼ é€’å¿…éœ€å­—æ®µï¼Œä¸ä¼ é€’äº¤æ˜“å‚æ•°é»˜è®¤å€¼ |
| 3. åç«¯è®¾ç½®é»˜è®¤å€¼ | â“ éœ€è¦æ£€æŸ¥ | æ£€æŸ¥æ•°æ®åº“å­—æ®µæ˜¯å¦å…è®¸NULLï¼Œå¦‚æœå…è®¸å¯ä»¥ä¸è®¾ç½® |
| 4. äº¤æ˜“å‚æ•°é»˜è®¤å€¼æ²¡å¿…è¦ | âœ… æ­£ç¡® | å¦‚æœæ•°æ®åº“å­—æ®µå…è®¸NULLï¼Œå¯ä»¥ä¸ä¿å­˜ |
| 5. å¸‚åœºçŠ¶æ€æ˜ å°„é€»è¾‘ | âœ… æ­£ç¡® | ä¿®æ­£æ–‡æ¡£æè¿°ï¼šæ˜ å°„å…³ç³»æ˜¯é™æ€çš„ï¼Œè¿è¡Œæ—¶æ ¹æ®æ˜ å°„å…³ç³»åŒ¹é… |

---

## ğŸ”§ å»ºè®®çš„ä¼˜åŒ–æ–¹æ¡ˆ

### 1. å‰ç«¯ä¼˜åŒ–

**åˆ é™¤ä¸å¿…è¦çš„ä»£ç ï¼š**
```javascript
// åˆ é™¤è¿™äº›
const btcPrice = ref(96000);
const minOrderValue = computed(...);
const estimatedQuantity = computed(...);
const loadBtcPrice = async () => {...};
```

**ç®€åŒ–è¯·æ±‚æ•°æ®ï¼š**
```javascript
const data = {
  robotName: formData.value.robotName,
  apiConfigId: formData.value.apiConfigId,
  maxProfitTarget: formData.value.maxProfitTarget,
  maxLossAmount: formData.value.maxLossAmount,
  strategyGroupId: strategyGroupId,  // â­ å¿…éœ€
  marketRiskMapping: formData.value.marketRiskMapping,  // â­ å¿…éœ€
  exchange: formData.value.exchange,  // â­ å¿…éœ€ï¼ˆå¯ä»¥ä»APIé…ç½®è·å–ï¼‰
  symbol: formData.value.symbol,  // â­ å¿…éœ€
  autoTradeEnabled: formData.value.autoTradeEnabled ? 1 : 0,
  autoCloseEnabled: formData.value.autoCloseEnabled ? 1 : 0,
  autoMarketState: formData.value.autoMarketState ? 1 : 0,
  useMonitorSignal: formData.value.useMonitorSignal ? 1 : 0,
  scheduleStart: formData.value.scheduleStart ? ... : '',
  scheduleStop: formData.value.scheduleStop ? ... : '',
  // âŒ ä¸éœ€è¦ä¼ é€’è¿™äº›ï¼ˆè¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼‰
  // leverage, marginPercent, stopLossPercent, etc.
};
```

### 2. åç«¯ä¼˜åŒ–

**æ£€æŸ¥æ•°æ®åº“å­—æ®µå®šä¹‰ï¼š**
- å¦‚æœå­—æ®µå…è®¸NULLï¼Œå¯ä»¥ä¸è®¾ç½®é»˜è®¤å€¼
- å¦‚æœå­—æ®µä¸å…è®¸NULLï¼Œå¿…é¡»è®¾ç½®é»˜è®¤å€¼ï¼ˆä½†è¿è¡Œæ—¶ä¼šè¢«è¦†ç›–ï¼‰

**ç®€åŒ–é»˜è®¤å€¼è®¾ç½®ï¼š**
```go
// åªè®¾ç½®å¿…éœ€çš„å­—æ®µï¼ˆå¦‚æœæ•°æ®åº“ä¸å…è®¸NULLï¼‰
if in.Exchange == "" {
    in.Exchange = "bitget"  // å¿…éœ€å­—æ®µ
}
if in.Symbol == "" {
    in.Symbol = "BTCUSDT"  // å¿…éœ€å­—æ®µ
}

// âŒ ä¸éœ€è¦è®¾ç½®è¿™äº›ï¼ˆè¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼‰
// Leverage, MarginPercent, StopLossPercent, etc.
```

### 3. æ•°æ®åº“ä¼˜åŒ–

**å»ºè®®ï¼š**
- äº¤æ˜“å‚æ•°å­—æ®µå…è®¸NULLï¼ˆ`leverage`ã€`margin_percent`ã€`stop_loss_percent`ç­‰ï¼‰
- è¿è¡Œæ—¶å¼•æ“ä¼šä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼Œä¸éœ€è¦é»˜è®¤å€¼
- å¦‚æœå­—æ®µä¸å…è®¸NULLï¼Œå¯ä»¥è®¾ç½®ä¸º0ï¼Œè¿è¡Œæ—¶ä¼šè¢«è¦†ç›–

---

## ğŸ“ ä¿®æ­£åçš„æ–‡æ¡£æè¿°

### å¸‚åœºçŠ¶æ€æ˜ å°„é€»è¾‘ï¼ˆä¿®æ­£ç‰ˆï¼‰

**åˆ›å»ºæ—¶ï¼š**
- ç”¨æˆ·é…ç½®å¸‚åœºçŠ¶æ€æ˜ å°„å…³ç³»ï¼ˆé™æ€é…ç½®ï¼‰
- ä¿å­˜åˆ° `current_strategy` JSON çš„ `riskConfig.marketRiskMapping`

**è¿è¡Œæ—¶ï¼š**
1. å®æ—¶åˆ†æå¸‚åœºçŠ¶æ€ï¼ˆåŠ¨æ€ï¼‰
2. æ ¹æ®åˆ›å»ºæ—¶é…ç½®çš„æ˜ å°„å…³ç³»ï¼Œè·å–å¯¹åº”çš„é£é™©åå¥½ï¼ˆé™æ€æ˜ å°„ï¼‰
3. æ ¹æ® `groupId` + å¸‚åœºçŠ¶æ€ + é£é™©åå¥½ï¼ŒæŸ¥è¯¢ç­–ç•¥æ¨¡æ¿
4. åŠ è½½ç­–ç•¥æ¨¡æ¿å‚æ•°

**å…³é”®ç‚¹ï¼š**
- **æ˜ å°„å…³ç³»æ˜¯é™æ€çš„**ï¼ˆåˆ›å»ºæ—¶é…ç½®ï¼Œè¿è¡Œæ—¶ä¸å˜ï¼‰
- **å¸‚åœºçŠ¶æ€æ˜¯åŠ¨æ€çš„**ï¼ˆè¿è¡Œæ—¶å®æ—¶åˆ†æï¼‰
- **ç­–ç•¥æ¨¡æ¿æ˜¯åŠ¨æ€åŒ¹é…çš„**ï¼ˆæ ¹æ®å¸‚åœºçŠ¶æ€å’Œæ˜ å°„å…³ç³»æŸ¥è¯¢ï¼‰

