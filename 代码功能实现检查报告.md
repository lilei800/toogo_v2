# ä»£ç åŠŸèƒ½å®ç°æ£€æŸ¥æŠ¥å‘Š

## ğŸ“‹ æ£€æŸ¥æ—¶é—´
2025-01-XX

## âœ… æ£€æŸ¥ç»“æœ

### 1. âœ… åŠ è½½BTCä»·æ ¼ï¼ˆç”¨äºè®¡ç®—é¢„ä¼°ä¸‹å•é‡ï¼‰ï¼Œè¿™ä¸ªæ²¡æœ‰æ„ä¹‰

**æ£€æŸ¥çŠ¶æ€ï¼šâœ… å·²å®ç°**

**ä»£ç æ£€æŸ¥ï¼š**
- âœ… `loadBtcPrice()` å‡½æ•°å·²åˆ é™¤
- âœ… `btcPrice` å˜é‡å·²åˆ é™¤
- âœ… `estimatedQuantity` å˜é‡å·²åˆ é™¤
- âœ… `minOrderValue` å˜é‡å·²åˆ é™¤
- âœ… `loadAccountBalance()` å‡½æ•°å·²åˆ é™¤
- âœ… `watch` ç›‘å¬å™¨ä¸­å¯¹è¿™äº›å‡½æ•°çš„è°ƒç”¨å·²åˆ é™¤
- âœ… `onMounted` ä¸­åªä¿ç•™äº†æ³¨é‡Šï¼š"å·²åˆ é™¤ï¼šloadBtcPrice() - ä¸å†éœ€è¦"

**ç»“è®ºï¼š** âœ… å®Œå…¨å®ç°ï¼Œæ‰€æœ‰ç›¸å…³ä»£ç å·²åˆ é™¤

---

### 2. âœ… æ„å»ºè¯·æ±‚æ•°æ®åº”è¯¥ä¸éœ€è¦ï¼Œå› ä¸ºåˆ›å»ºæœºå™¨äººæ—¶å€™ä¸éœ€è¦é»˜è®¤å€¼ï¼Œå› ä¸ºè¿è¡Œæ—¶å€™ç›´æ¥ç”¨çš„å®æ—¶å€¼

**æ£€æŸ¥çŠ¶æ€ï¼šâœ… å·²å®ç°**

**ä»£ç æ£€æŸ¥ï¼š**
```javascript
// create.vue ç¬¬740-765è¡Œ
const data: Record<string, any> = {
  // åŸºç¡€ä¿¡æ¯ï¼ˆå¿…éœ€ï¼‰
  robotName: formData.value.robotName,
  apiConfigId: formData.value.apiConfigId,
  maxProfitTarget: formData.value.maxProfitTarget,
  maxLossAmount: formData.value.maxLossAmount,
  maxRuntime: 0,
  
  // â­ ç­–ç•¥é…ç½®ï¼ˆå¿…éœ€ï¼‰
  strategyGroupId: strategyGroupId,
  marketRiskMapping: formData.value.marketRiskMapping,
  
  // äº¤æ˜“åŸºç¡€é…ç½®ï¼ˆå¿…éœ€ï¼‰
  exchange: formData.value.exchange,
  symbol: formData.value.symbol,
  
  // è‡ªåŠ¨åŒ–å¼€å…³ï¼ˆå¿…éœ€ï¼‰
  autoTradeEnabled: formData.value.autoTradeEnabled ? 1 : 0,
  autoCloseEnabled: formData.value.autoCloseEnabled ? 1 : 0,
  autoMarketState: formData.value.autoMarketState ? 1 : 0,
  useMonitorSignal: formData.value.useMonitorSignal ? 1 : 0,
  
  // å®šæ—¶å¼€å…³è®¾ç½®ï¼ˆå¯é€‰ï¼‰
  scheduleStart: formData.value.scheduleStart ? ... : '',
  scheduleStop: formData.value.scheduleStop ? ... : '',
  
  remark: `ç­–ç•¥ç»„ID: ${strategyGroupId}`,
  
  // âŒ ä»¥ä¸‹å­—æ®µä¸å†ä¼ é€’ï¼Œè¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼š
  // - leverage, marginPercent, stopLossPercent, profitRetreatPercent, autoStartRetreatPercent
  // - orderType, marginMode, marketState, riskPreference
};
```

**æ£€æŸ¥ç»“æœï¼š**
- âœ… ä¸å†ä¼ é€’ `leverage`ã€`marginPercent`ã€`stopLossPercent` ç­‰äº¤æ˜“å‚æ•°
- âœ… ä¸å†ä¼ é€’ `orderType`ã€`marginMode`ã€`marketState`ã€`riskPreference`
- âœ… åªä¼ é€’å¿…éœ€å­—æ®µï¼š`strategyGroupId`ã€`marketRiskMapping`ã€`exchange`ã€`symbol`ã€å¼€å…³ç­‰

**ç»“è®ºï¼š** âœ… å®Œå…¨å®ç°ï¼Œå‰ç«¯ä¸å†ä¼ é€’äº¤æ˜“å‚æ•°é»˜è®¤å€¼

---

### 3. âœ… åç«¯æ‰§è¡Œ--è®¾ç½®é»˜è®¤å€¼ï¼Œè¿™é‡Œä¸è®¾ç½®ä¸è¡Œå—ï¼Ÿ

**æ£€æŸ¥çŠ¶æ€ï¼šâœ… å·²å®ç°**

**ä»£ç æ£€æŸ¥ï¼š**
```go
// robot.go ç¬¬130-140è¡Œ
// è®¾ç½®å¿…éœ€å­—æ®µçš„é»˜è®¤å€¼ï¼ˆä»…ç”¨äºæ•°æ®åº“çº¦æŸï¼Œè¿è¡Œæ—¶ä¼šè¢«ç­–ç•¥æ¨¡æ¿è¦†ç›–ï¼‰
// æ³¨æ„ï¼šäº¤æ˜“å‚æ•°ï¼ˆæ æ†ã€ä¿è¯é‡‘ã€æ­¢æŸã€æ­¢ç›ˆç­‰ï¼‰è¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼Œè¿™é‡Œåªè®¾ç½®å¿…éœ€çš„åŸºç¡€å­—æ®µ
if in.Exchange == "" {
    in.Exchange = "bitget" // å¿…éœ€å­—æ®µï¼šäº¤æ˜“æ‰€
}
if in.Symbol == "" {
    in.Symbol = "BTCUSDT" // å¿…éœ€å­—æ®µï¼šäº¤æ˜“å¯¹
}
// ä»¥ä¸‹å­—æ®µè¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼Œä¸éœ€è¦è®¾ç½®é»˜è®¤å€¼
// - Leverage, MarginPercent, StopLossPercent, ProfitRetreatPercent, AutoStartRetreatPercent
// - OrderType, MarginMode, MarketState, RiskPreference
```

**æ£€æŸ¥ç»“æœï¼š**
- âœ… åªè®¾ç½®äº† `Exchange` å’Œ `Symbol` çš„é»˜è®¤å€¼ï¼ˆå¿…éœ€å­—æ®µï¼‰
- âœ… ç§»é™¤äº†æ‰€æœ‰äº¤æ˜“å‚æ•°çš„é»˜è®¤å€¼è®¾ç½®
- âœ… ç§»é™¤äº† `RiskPreference`ã€`MarketState`ã€`OrderType`ã€`MarginMode` ç­‰çš„é»˜è®¤å€¼è®¾ç½®

**ç»“è®ºï¼š** âœ… å®Œå…¨å®ç°ï¼Œåªè®¾ç½®å¿…éœ€å­—æ®µçš„é»˜è®¤å€¼

---

### 4. âœ… äº¤æ˜“å‚æ•°ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œåˆ›å»ºæ—¶ä¿å­˜é»˜è®¤å€¼æˆ‘è®¤ä¸ºæ²¡æœ‰å¿…è¦

**æ£€æŸ¥çŠ¶æ€ï¼šâœ… å·²å®ç°**

**ä»£ç æ£€æŸ¥ï¼š**
```go
// robot.go ç¬¬144-169è¡Œ
data := &do.TradingRobot{
    UserId:           memberId,
    RobotName:        in.RobotName,
    ApiConfigId:      in.ApiConfigId,
    MaxProfitTarget:  in.MaxProfitTarget,
    MaxLossAmount:    in.MaxLossAmount,
    MaxRuntime:       in.MaxRuntime,
    AutoMarketState:  in.AutoMarketState,
    Exchange:         in.Exchange, // å¿…éœ€å­—æ®µ
    Symbol:           in.Symbol,   // å¿…éœ€å­—æ®µ
    UseMonitorSignal: in.UseMonitorSignal,
    CurrentStrategy:  string(strategyJSON), // â­ åŒ…å«groupIdå’ŒmarketRiskMapping
    Status:           1, // æœªå¯åŠ¨
    LongCount:        0,
    ShortCount:       0,
    TotalProfit:      0,
    RuntimeSeconds:   0,
    AutoTradeEnabled: in.AutoTradeEnabled,
    AutoCloseEnabled: in.AutoCloseEnabled,
    Remark:           in.Remark,
    // âŒ ä»¥ä¸‹å­—æ®µè¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼Œä¸éœ€è¦ä¿å­˜ï¼š
    // - RiskPreference, MarketState (è¿è¡Œæ—¶æ ¹æ®æ˜ å°„å…³ç³»åŠ¨æ€è·å–)
    // - OrderType, MarginMode (è¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½)
    // - Leverage, MarginPercent (è¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½)
    // - StopLossPercent, ProfitRetreatPercent, AutoStartRetreatPercent (è¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½)
}
```

**æ£€æŸ¥ç»“æœï¼š**
- âœ… `data` ç»“æ„ä¸­æ²¡æœ‰ä¿å­˜ `RiskPreference`ã€`MarketState`
- âœ… `data` ç»“æ„ä¸­æ²¡æœ‰ä¿å­˜ `OrderType`ã€`MarginMode`
- âœ… `data` ç»“æ„ä¸­æ²¡æœ‰ä¿å­˜ `Leverage`ã€`MarginPercent`
- âœ… `data` ç»“æ„ä¸­æ²¡æœ‰ä¿å­˜ `StopLossPercent`ã€`ProfitRetreatPercent`ã€`AutoStartRetreatPercent`

**insertData æ£€æŸ¥ï¼š**
```go
// robot.go ç¬¬198-223è¡Œ
insertData := g.Map{
    "user_id":             data.UserId,
    "robot_name":          data.RobotName,
    // ... å…¶ä»–å¿…éœ€å­—æ®µ
    "exchange":           data.Exchange,
    "symbol":             data.Symbol,
    "current_strategy":   data.CurrentStrategy,
    // ... å…¶ä»–å¿…éœ€å­—æ®µ
    // âŒ ä»¥ä¸‹å­—æ®µè¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½ï¼Œä¸éœ€è¦ä¿å­˜ï¼š
    // - risk_preference, market_state (è¿è¡Œæ—¶æ ¹æ®æ˜ å°„å…³ç³»åŠ¨æ€è·å–)
    // - order_type, margin_mode (è¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½)
    // - leverage, margin_percent (è¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½)
    // - stop_loss_percent, profit_retreat_percent, auto_start_retreat_percent (è¿è¡Œæ—¶ä»ç­–ç•¥æ¨¡æ¿åŠ è½½)
}
```

**æ£€æŸ¥ç»“æœï¼š**
- âœ… `insertData` ä¸­æ²¡æœ‰ä¿å­˜ `risk_preference`ã€`market_state`
- âœ… `insertData` ä¸­æ²¡æœ‰ä¿å­˜ `order_type`ã€`margin_mode`
- âœ… `insertData` ä¸­æ²¡æœ‰ä¿å­˜ `leverage`ã€`margin_percent`
- âœ… `insertData` ä¸­æ²¡æœ‰ä¿å­˜ `stop_loss_percent`ã€`profit_retreat_percent`ã€`auto_start_retreat_percent`

**ç»“è®ºï¼š** âœ… å®Œå…¨å®ç°ï¼Œä¸ä¿å­˜äº¤æ˜“å‚æ•°é»˜è®¤å€¼

---

### 5. âš ï¸ å¸‚åœºçŠ¶æ€æ˜ å°„ï¼ˆåŠ¨æ€åˆ‡æ¢ï¼‰é€»è¾‘ä¸å¯¹ï¼Œæ˜¯æ ¹æ®åˆ›å»ºæœºå™¨äººæ—¶å€™é…ç½®çš„æ˜ å°„å…³ç³»åŒ¹é…çš„

**æ£€æŸ¥çŠ¶æ€ï¼šâš ï¸ éƒ¨åˆ†å®ç°ï¼ˆä»£ç æ­£ç¡®ï¼Œæ–‡æ¡£éœ€è¦ä¿®æ­£ï¼‰**

**ä»£ç æ£€æŸ¥ï¼š**
```go
// robot_engine.go
MarketRiskMapping map[string]string // å¸‚åœºçŠ¶æ€ â†’ é£é™©åå¥½æ˜ å°„ï¼ˆä»æœºå™¨äººCurrentStrategyåŠ è½½ï¼‰

// è¿è¡Œæ—¶ä½¿ç”¨æ˜ å°„å…³ç³»
riskPreference := e.MarketRiskMapping[currentMarketState]  // æ ¹æ®æ˜ å°„å…³ç³»è·å–é£é™©åå¥½
strategyParams, err := e.loadFullStrategyParams(ctx, currentMarketState, riskPreference)
```

**ä»£ç é€»è¾‘ï¼š**
1. âœ… åˆ›å»ºæ—¶ï¼šç”¨æˆ·é…ç½®æ˜ å°„å…³ç³»ï¼ˆé™æ€é…ç½®ï¼‰ï¼Œä¿å­˜åˆ° `current_strategy` JSON
2. âœ… è¿è¡Œæ—¶ï¼šä» `current_strategy` JSON åŠ è½½æ˜ å°„å…³ç³»ï¼ˆé™æ€ï¼‰
3. âœ… è¿è¡Œæ—¶ï¼šå®æ—¶åˆ†æå¸‚åœºçŠ¶æ€ï¼ˆåŠ¨æ€ï¼‰
4. âœ… è¿è¡Œæ—¶ï¼šæ ¹æ®æ˜ å°„å…³ç³»è·å–é£é™©åå¥½ï¼ˆé™æ€æ˜ å°„ï¼‰
5. âœ… è¿è¡Œæ—¶ï¼šæ ¹æ® `groupId` + å¸‚åœºçŠ¶æ€ + é£é™©åå¥½ï¼ŒæŸ¥è¯¢ç­–ç•¥æ¨¡æ¿

**æ–‡æ¡£æ£€æŸ¥ï¼š**
- âŒ `åˆ›å»ºæœºå™¨äººæ‰§è¡Œæµç¨‹åˆ†æ.md` ç¬¬171è¡Œï¼šæè¿°ä¸º"ç”¨äºè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢é£é™©åå¥½"
- âŒ `åˆ›å»ºæœºå™¨äººæ‰§è¡Œæµç¨‹åˆ†æ.md` ç¬¬559è¡Œï¼šæè¿°ä¸º"å¸‚åœºçŠ¶æ€æ˜ å°„æ˜¯åŠ¨æ€çš„"
- âœ… `åˆ›å»ºæœºå™¨äººæµç¨‹é—®é¢˜åˆ†æ.md`ï¼šå·²æ­£ç¡®æè¿°ä¸º"æ˜ å°„å…³ç³»æ˜¯é™æ€çš„"

**ç»“è®ºï¼š** 
- âœ… **ä»£ç é€»è¾‘æ­£ç¡®**ï¼šæ˜ å°„å…³ç³»æ˜¯é™æ€çš„ï¼Œè¿è¡Œæ—¶æ ¹æ®æ˜ å°„å…³ç³»åŒ¹é…
- âš ï¸ **æ–‡æ¡£éœ€è¦ä¿®æ­£**ï¼š`åˆ›å»ºæœºå™¨äººæ‰§è¡Œæµç¨‹åˆ†æ.md` ä¸­çš„æè¿°éœ€è¦æ›´æ–°

---

## ğŸ“Š æ€»ç»“

| é—®é¢˜ | ä»£ç å®ç° | æ–‡æ¡£æè¿° | çŠ¶æ€ |
|------|---------|---------|------|
| 1. åŠ è½½BTCä»·æ ¼ | âœ… å·²åˆ é™¤ | âœ… æ­£ç¡® | âœ… å®Œå…¨å®ç° |
| 2. æ„å»ºè¯·æ±‚æ•°æ®ä¸éœ€è¦é»˜è®¤å€¼ | âœ… å·²ç®€åŒ– | âœ… æ­£ç¡® | âœ… å®Œå…¨å®ç° |
| 3. åç«¯è®¾ç½®é»˜è®¤å€¼ | âœ… å·²ä¼˜åŒ– | âœ… æ­£ç¡® | âœ… å®Œå…¨å®ç° |
| 4. äº¤æ˜“å‚æ•°é»˜è®¤å€¼æ²¡å¿…è¦ | âœ… å·²ç§»é™¤ | âœ… æ­£ç¡® | âœ… å®Œå…¨å®ç° |
| 5. å¸‚åœºçŠ¶æ€æ˜ å°„é€»è¾‘ | âœ… ä»£ç æ­£ç¡® | âš ï¸ æ–‡æ¡£éœ€ä¿®æ­£ | âš ï¸ éƒ¨åˆ†å®ç° |

---

## ğŸ”§ éœ€è¦ä¿®æ­£çš„å†…å®¹

### æ–‡æ¡£ä¿®æ­£ï¼š`åˆ›å»ºæœºå™¨äººæ‰§è¡Œæµç¨‹åˆ†æ.md`

**éœ€è¦ä¿®æ­£çš„ä½ç½®ï¼š**

1. **ç¬¬171è¡Œ**ï¼š
   ```markdown
   // âŒ é”™è¯¯æè¿°
   // â­ å…³é”®ï¼šå¸‚åœºçŠ¶æ€ä¸é£é™©åå¥½æ˜ å°„ï¼ˆç”¨äºè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢é£é™©åå¥½ï¼‰
   
   // âœ… æ­£ç¡®æè¿°
   // â­ å…³é”®ï¼šå¸‚åœºçŠ¶æ€ä¸é£é™©åå¥½æ˜ å°„ï¼ˆåˆ›å»ºæ—¶é™æ€é…ç½®ï¼Œè¿è¡Œæ—¶æ ¹æ®æ˜ å°„å…³ç³»åŒ¹é…ç­–ç•¥æ¨¡æ¿ï¼‰
   ```

2. **ç¬¬559è¡Œ**ï¼š
   ```markdown
   // âŒ é”™è¯¯æè¿°
   5. **å¸‚åœºçŠ¶æ€æ˜ å°„æ˜¯åŠ¨æ€çš„**ï¼šè¿è¡Œæ—¶æ ¹æ®å®æ—¶å¸‚åœºçŠ¶æ€è‡ªåŠ¨åˆ‡æ¢é£é™©åå¥½
   
   // âœ… æ­£ç¡®æè¿°
   5. **æ˜ å°„å…³ç³»æ˜¯é™æ€çš„**ï¼šåˆ›å»ºæ—¶é…ç½®ï¼Œè¿è¡Œæ—¶æ ¹æ®æ˜ å°„å…³ç³»åŒ¹é…ç­–ç•¥æ¨¡æ¿
   ```

---

## âœ… æœ€ç»ˆç»“è®º

**ä»£ç å®ç°ï¼š** âœ… **100% å®Œæˆ**
- æ‰€æœ‰5ä¸ªé—®é¢˜éƒ½å·²æ­£ç¡®å®ç°
- ä»£ç é€»è¾‘å®Œå…¨ç¬¦åˆè¦æ±‚

**æ–‡æ¡£å®Œå–„ï¼š** âš ï¸ **éœ€è¦ä¿®æ­£**
- ä»£ç é€»è¾‘æ­£ç¡®
- æ–‡æ¡£ä¸­æœ‰ä¸€å¤„æè¿°éœ€è¦ä¿®æ­£ï¼ˆé—®é¢˜5ï¼‰

**å»ºè®®ï¼š**
1. âœ… ä»£ç æ— éœ€ä¿®æ”¹
2. âš ï¸ ä¿®æ­£ `åˆ›å»ºæœºå™¨äººæ‰§è¡Œæµç¨‹åˆ†æ.md` ä¸­çš„æè¿°

